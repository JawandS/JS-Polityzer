(function(){function r(e,n,t){function o(i,f){if(!n[i]){if(!e[i]){var c="function"==typeof require&&require;if(!f&&c)return c(i,!0);if(u)return u(i,!0);var a=new Error("Cannot find module '"+i+"'");throw a.code="MODULE_NOT_FOUND",a}var p=n[i]={exports:{}};e[i][0].call(p.exports,function(r){var n=e[i][1][r];return o(n||r)},p,p.exports,r,e,n,t)}return n[i].exports}for(var u="function"==typeof require&&require,i=0;i<t.length;i++)o(t[i]);return o}return r})()({1:[function(require,module,exports){"use strict"},{}],2:[function(require,module,exports){"use strict";var GetIntrinsic=require("get-intrinsic");var callBind=require("./");var $indexOf=callBind(GetIntrinsic("String.prototype.indexOf"));module.exports=function callBoundIntrinsic(name,allowMissing){var intrinsic=GetIntrinsic(name,!!allowMissing);if(typeof intrinsic==="function"&&$indexOf(name,".prototype.")>-1){return callBind(intrinsic)}return intrinsic}},{"./":3,"get-intrinsic":6}],3:[function(require,module,exports){"use strict";var bind=require("function-bind");var GetIntrinsic=require("get-intrinsic");var $apply=GetIntrinsic("%Function.prototype.apply%");var $call=GetIntrinsic("%Function.prototype.call%");var $reflectApply=GetIntrinsic("%Reflect.apply%",true)||bind.call($call,$apply);var $gOPD=GetIntrinsic("%Object.getOwnPropertyDescriptor%",true);var $defineProperty=GetIntrinsic("%Object.defineProperty%",true);var $max=GetIntrinsic("%Math.max%");if($defineProperty){try{$defineProperty({},"a",{value:1})}catch(e){$defineProperty=null}}module.exports=function callBind(originalFunction){var func=$reflectApply(bind,$call,arguments);if($gOPD&&$defineProperty){var desc=$gOPD(func,"length");if(desc.configurable){$defineProperty(func,"length",{value:1+$max(0,originalFunction.length-(arguments.length-1))})}}return func};var applyBind=function applyBind(){return $reflectApply(bind,$apply,arguments)};if($defineProperty){$defineProperty(module.exports,"apply",{value:applyBind})}else{module.exports.apply=applyBind}},{"function-bind":5,"get-intrinsic":6}],4:[function(require,module,exports){"use strict";var ERROR_MESSAGE="Function.prototype.bind called on incompatible ";var toStr=Object.prototype.toString;var max=Math.max;var funcType="[object Function]";var concatty=function concatty(a,b){var arr=[];for(var i=0;i<a.length;i+=1){arr[i]=a[i]}for(var j=0;j<b.length;j+=1){arr[j+a.length]=b[j]}return arr};var slicy=function slicy(arrLike,offset){var arr=[];for(var i=offset||0,j=0;i<arrLike.length;i+=1,j+=1){arr[j]=arrLike[i]}return arr};var joiny=function joiny(arr,joiner){var str="";for(var i=0;i<arr.length;i+=1){str+=arr[i];if(i+1<arr.length){str+=joiner}}return str};module.exports=function bind(that){var target=this;if(typeof target!=="function"||toStr.apply(target)!==funcType){throw new TypeError(ERROR_MESSAGE+target)}var args=slicy(arguments,1);var bound;var binder=function binder(){if(this instanceof bound){var result=target.apply(this,concatty(args,arguments));if(Object(result)===result){return result}return this}return target.apply(that,concatty(args,arguments))};var boundLength=max(0,target.length-args.length);var boundArgs=[];for(var i=0;i<boundLength;i++){boundArgs[i]="$"+i}bound=Function("binder","return function ("+joiny(boundArgs,",")+"){ return binder.apply(this,arguments); }")(binder);if(target.prototype){var Empty=function Empty(){};Empty.prototype=target.prototype;bound.prototype=new Empty;Empty.prototype=null}return bound}},{}],5:[function(require,module,exports){"use strict";var implementation=require("./implementation");module.exports=Function.prototype.bind||implementation},{"./implementation":4}],6:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var undefined;var $SyntaxError=SyntaxError;var $Function=Function;var $TypeError=TypeError;var getEvalledConstructor=function getEvalledConstructor(expressionSyntax){try{return $Function('"use strict"; return ('+expressionSyntax+").constructor;")()}catch(e){}};var $gOPD=Object.getOwnPropertyDescriptor;if($gOPD){try{$gOPD({},"")}catch(e){$gOPD=null}}var throwTypeError=function throwTypeError(){throw new $TypeError};var ThrowTypeError=$gOPD?function(){try{arguments.callee;return throwTypeError}catch(calleeThrows){try{return $gOPD(arguments,"callee").get}catch(gOPDthrows){return throwTypeError}}}():throwTypeError;var hasSymbols=require("has-symbols")();var hasProto=require("has-proto")();var getProto=Object.getPrototypeOf||(hasProto?function(x){return x.__proto__}:null);var needsEval={};var TypedArray=typeof Uint8Array==="undefined"||!getProto?undefined:getProto(Uint8Array);var INTRINSICS={"%AggregateError%":typeof AggregateError==="undefined"?undefined:AggregateError,"%Array%":Array,"%ArrayBuffer%":typeof ArrayBuffer==="undefined"?undefined:ArrayBuffer,"%ArrayIteratorPrototype%":hasSymbols&&getProto?getProto([][Symbol.iterator]()):undefined,"%AsyncFromSyncIteratorPrototype%":undefined,"%AsyncFunction%":needsEval,"%AsyncGenerator%":needsEval,"%AsyncGeneratorFunction%":needsEval,"%AsyncIteratorPrototype%":needsEval,"%Atomics%":typeof Atomics==="undefined"?undefined:Atomics,"%BigInt%":typeof BigInt==="undefined"?undefined:BigInt,"%BigInt64Array%":typeof BigInt64Array==="undefined"?undefined:BigInt64Array,"%BigUint64Array%":typeof BigUint64Array==="undefined"?undefined:BigUint64Array,"%Boolean%":Boolean,"%DataView%":typeof DataView==="undefined"?undefined:DataView,"%Date%":Date,"%decodeURI%":decodeURI,"%decodeURIComponent%":decodeURIComponent,"%encodeURI%":encodeURI,"%encodeURIComponent%":encodeURIComponent,"%Error%":Error,"%eval%":eval,"%EvalError%":EvalError,"%Float32Array%":typeof Float32Array==="undefined"?undefined:Float32Array,"%Float64Array%":typeof Float64Array==="undefined"?undefined:Float64Array,"%FinalizationRegistry%":typeof FinalizationRegistry==="undefined"?undefined:FinalizationRegistry,"%Function%":$Function,"%GeneratorFunction%":needsEval,"%Int8Array%":typeof Int8Array==="undefined"?undefined:Int8Array,"%Int16Array%":typeof Int16Array==="undefined"?undefined:Int16Array,"%Int32Array%":typeof Int32Array==="undefined"?undefined:Int32Array,"%isFinite%":isFinite,"%isNaN%":isNaN,"%IteratorPrototype%":hasSymbols&&getProto?getProto(getProto([][Symbol.iterator]())):undefined,"%JSON%":(typeof JSON==="undefined"?"undefined":_typeof(JSON))==="object"?JSON:undefined,"%Map%":typeof Map==="undefined"?undefined:Map,"%MapIteratorPrototype%":typeof Map==="undefined"||!hasSymbols||!getProto?undefined:getProto((new Map)[Symbol.iterator]()),"%Math%":Math,"%Number%":Number,"%Object%":Object,"%parseFloat%":parseFloat,"%parseInt%":parseInt,"%Promise%":typeof Promise==="undefined"?undefined:Promise,"%Proxy%":typeof Proxy==="undefined"?undefined:Proxy,"%RangeError%":RangeError,"%ReferenceError%":ReferenceError,"%Reflect%":typeof Reflect==="undefined"?undefined:Reflect,"%RegExp%":RegExp,"%Set%":typeof Set==="undefined"?undefined:Set,"%SetIteratorPrototype%":typeof Set==="undefined"||!hasSymbols||!getProto?undefined:getProto((new Set)[Symbol.iterator]()),"%SharedArrayBuffer%":typeof SharedArrayBuffer==="undefined"?undefined:SharedArrayBuffer,"%String%":String,"%StringIteratorPrototype%":hasSymbols&&getProto?getProto(""[Symbol.iterator]()):undefined,"%Symbol%":hasSymbols?Symbol:undefined,"%SyntaxError%":$SyntaxError,"%ThrowTypeError%":ThrowTypeError,"%TypedArray%":TypedArray,"%TypeError%":$TypeError,"%Uint8Array%":typeof Uint8Array==="undefined"?undefined:Uint8Array,"%Uint8ClampedArray%":typeof Uint8ClampedArray==="undefined"?undefined:Uint8ClampedArray,"%Uint16Array%":typeof Uint16Array==="undefined"?undefined:Uint16Array,"%Uint32Array%":typeof Uint32Array==="undefined"?undefined:Uint32Array,"%URIError%":URIError,"%WeakMap%":typeof WeakMap==="undefined"?undefined:WeakMap,"%WeakRef%":typeof WeakRef==="undefined"?undefined:WeakRef,"%WeakSet%":typeof WeakSet==="undefined"?undefined:WeakSet};if(getProto){try{null.error}catch(e){var errorProto=getProto(getProto(e));INTRINSICS["%Error.prototype%"]=errorProto}}var doEval=function doEval(name){var value;if(name==="%AsyncFunction%"){value=getEvalledConstructor("async function () {}")}else if(name==="%GeneratorFunction%"){value=getEvalledConstructor("function* () {}")}else if(name==="%AsyncGeneratorFunction%"){value=getEvalledConstructor("async function* () {}")}else if(name==="%AsyncGenerator%"){var fn=doEval("%AsyncGeneratorFunction%");if(fn){value=fn.prototype}}else if(name==="%AsyncIteratorPrototype%"){var gen=doEval("%AsyncGenerator%");if(gen&&getProto){value=getProto(gen.prototype)}}INTRINSICS[name]=value;return value};var LEGACY_ALIASES={"%ArrayBufferPrototype%":["ArrayBuffer","prototype"],"%ArrayPrototype%":["Array","prototype"],"%ArrayProto_entries%":["Array","prototype","entries"],"%ArrayProto_forEach%":["Array","prototype","forEach"],"%ArrayProto_keys%":["Array","prototype","keys"],"%ArrayProto_values%":["Array","prototype","values"],"%AsyncFunctionPrototype%":["AsyncFunction","prototype"],"%AsyncGenerator%":["AsyncGeneratorFunction","prototype"],"%AsyncGeneratorPrototype%":["AsyncGeneratorFunction","prototype","prototype"],"%BooleanPrototype%":["Boolean","prototype"],"%DataViewPrototype%":["DataView","prototype"],"%DatePrototype%":["Date","prototype"],"%ErrorPrototype%":["Error","prototype"],"%EvalErrorPrototype%":["EvalError","prototype"],"%Float32ArrayPrototype%":["Float32Array","prototype"],"%Float64ArrayPrototype%":["Float64Array","prototype"],"%FunctionPrototype%":["Function","prototype"],"%Generator%":["GeneratorFunction","prototype"],"%GeneratorPrototype%":["GeneratorFunction","prototype","prototype"],"%Int8ArrayPrototype%":["Int8Array","prototype"],"%Int16ArrayPrototype%":["Int16Array","prototype"],"%Int32ArrayPrototype%":["Int32Array","prototype"],"%JSONParse%":["JSON","parse"],"%JSONStringify%":["JSON","stringify"],"%MapPrototype%":["Map","prototype"],"%NumberPrototype%":["Number","prototype"],"%ObjectPrototype%":["Object","prototype"],"%ObjProto_toString%":["Object","prototype","toString"],"%ObjProto_valueOf%":["Object","prototype","valueOf"],"%PromisePrototype%":["Promise","prototype"],"%PromiseProto_then%":["Promise","prototype","then"],"%Promise_all%":["Promise","all"],"%Promise_reject%":["Promise","reject"],"%Promise_resolve%":["Promise","resolve"],"%RangeErrorPrototype%":["RangeError","prototype"],"%ReferenceErrorPrototype%":["ReferenceError","prototype"],"%RegExpPrototype%":["RegExp","prototype"],"%SetPrototype%":["Set","prototype"],"%SharedArrayBufferPrototype%":["SharedArrayBuffer","prototype"],"%StringPrototype%":["String","prototype"],"%SymbolPrototype%":["Symbol","prototype"],"%SyntaxErrorPrototype%":["SyntaxError","prototype"],"%TypedArrayPrototype%":["TypedArray","prototype"],"%TypeErrorPrototype%":["TypeError","prototype"],"%Uint8ArrayPrototype%":["Uint8Array","prototype"],"%Uint8ClampedArrayPrototype%":["Uint8ClampedArray","prototype"],"%Uint16ArrayPrototype%":["Uint16Array","prototype"],"%Uint32ArrayPrototype%":["Uint32Array","prototype"],"%URIErrorPrototype%":["URIError","prototype"],"%WeakMapPrototype%":["WeakMap","prototype"],"%WeakSetPrototype%":["WeakSet","prototype"]};var bind=require("function-bind");var hasOwn=require("has");var $concat=bind.call(Function.call,Array.prototype.concat);var $spliceApply=bind.call(Function.apply,Array.prototype.splice);var $replace=bind.call(Function.call,String.prototype.replace);var $strSlice=bind.call(Function.call,String.prototype.slice);var $exec=bind.call(Function.call,RegExp.prototype.exec);var rePropName=/[^%.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|%$))/g;var reEscapeChar=/\\(\\)?/g;var stringToPath=function stringToPath(string){var first=$strSlice(string,0,1);var last=$strSlice(string,-1);if(first==="%"&&last!=="%"){throw new $SyntaxError("invalid intrinsic syntax, expected closing `%`")}else if(last==="%"&&first!=="%"){throw new $SyntaxError("invalid intrinsic syntax, expected opening `%`")}var result=[];$replace(string,rePropName,function(match,number,quote,subString){result[result.length]=quote?$replace(subString,reEscapeChar,"$1"):number||match});return result};var getBaseIntrinsic=function getBaseIntrinsic(name,allowMissing){var intrinsicName=name;var alias;if(hasOwn(LEGACY_ALIASES,intrinsicName)){alias=LEGACY_ALIASES[intrinsicName];intrinsicName="%"+alias[0]+"%"}if(hasOwn(INTRINSICS,intrinsicName)){var value=INTRINSICS[intrinsicName];if(value===needsEval){value=doEval(intrinsicName)}if(typeof value==="undefined"&&!allowMissing){throw new $TypeError("intrinsic "+name+" exists, but is not available. Please file an issue!")}return{alias:alias,name:intrinsicName,value:value}}throw new $SyntaxError("intrinsic "+name+" does not exist!")};module.exports=function GetIntrinsic(name,allowMissing){if(typeof name!=="string"||name.length===0){throw new $TypeError("intrinsic name must be a non-empty string")}if(arguments.length>1&&typeof allowMissing!=="boolean"){throw new $TypeError('"allowMissing" argument must be a boolean')}if($exec(/^%?[^%]*%?$/,name)===null){throw new $SyntaxError("`%` may not be present anywhere but at the beginning and end of the intrinsic name")}var parts=stringToPath(name);var intrinsicBaseName=parts.length>0?parts[0]:"";var intrinsic=getBaseIntrinsic("%"+intrinsicBaseName+"%",allowMissing);var intrinsicRealName=intrinsic.name;var value=intrinsic.value;var skipFurtherCaching=false;var alias=intrinsic.alias;if(alias){intrinsicBaseName=alias[0];$spliceApply(parts,$concat([0,1],alias))}for(var i=1,isOwn=true;i<parts.length;i+=1){var part=parts[i];var first=$strSlice(part,0,1);var last=$strSlice(part,-1);if((first==='"'||first==="'"||first==="`"||last==='"'||last==="'"||last==="`")&&first!==last){throw new $SyntaxError("property names with quotes must have matching quotes")}if(part==="constructor"||!isOwn){skipFurtherCaching=true}intrinsicBaseName+="."+part;intrinsicRealName="%"+intrinsicBaseName+"%";if(hasOwn(INTRINSICS,intrinsicRealName)){value=INTRINSICS[intrinsicRealName]}else if(value!=null){if(!(part in value)){if(!allowMissing){throw new $TypeError("base intrinsic for "+name+" exists, but the property is not available.")}return void undefined}if($gOPD&&i+1>=parts.length){var desc=$gOPD(value,part);isOwn=!!desc;if(isOwn&&"get"in desc&&!("originalValue"in desc.get)){value=desc.get}else{value=value[part]}}else{isOwn=hasOwn(value,part);value=value[part]}if(isOwn&&!skipFurtherCaching){INTRINSICS[intrinsicRealName]=value}}}return value}},{"function-bind":5,has:10,"has-proto":7,"has-symbols":8}],7:[function(require,module,exports){"use strict";var test={foo:{}};var $Object=Object;module.exports=function hasProto(){return{__proto__:test}.foo===test.foo&&!({__proto__:null}instanceof $Object)}},{}],8:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var origSymbol=typeof Symbol!=="undefined"&&Symbol;var hasSymbolSham=require("./shams");module.exports=function hasNativeSymbols(){if(typeof origSymbol!=="function"){return false}if(typeof Symbol!=="function"){return false}if(_typeof(origSymbol("foo"))!=="symbol"){return false}if(_typeof(Symbol("bar"))!=="symbol"){return false}return hasSymbolSham()}},{"./shams":9}],9:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}module.exports=function hasSymbols(){if(typeof Symbol!=="function"||typeof Object.getOwnPropertySymbols!=="function"){return false}if(_typeof(Symbol.iterator)==="symbol"){return true}var obj={};var sym=Symbol("test");var symObj=Object(sym);if(typeof sym==="string"){return false}if(Object.prototype.toString.call(sym)!=="[object Symbol]"){return false}if(Object.prototype.toString.call(symObj)!=="[object Symbol]"){return false}var symVal=42;obj[sym]=symVal;for(sym in obj){return false}if(typeof Object.keys==="function"&&Object.keys(obj).length!==0){return false}if(typeof Object.getOwnPropertyNames==="function"&&Object.getOwnPropertyNames(obj).length!==0){return false}var syms=Object.getOwnPropertySymbols(obj);if(syms.length!==1||syms[0]!==sym){return false}if(!Object.prototype.propertyIsEnumerable.call(obj,sym)){return false}if(typeof Object.getOwnPropertyDescriptor==="function"){var descriptor=Object.getOwnPropertyDescriptor(obj,sym);if(descriptor.value!==symVal||descriptor.enumerable!==true){return false}}return true}},{}],10:[function(require,module,exports){"use strict";var hasOwnProperty={}.hasOwnProperty;var call=Function.prototype.call;module.exports=call.bind?call.bind(hasOwnProperty):function(O,P){return call.call(hasOwnProperty,O,P)}},{}],11:[function(require,module,exports){"use strict";function e(e){this.message=e}e.prototype=new Error,e.prototype.name="InvalidCharacterError";var r="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(r){var t=String(r).replace(/=+$/,"");if(t.length%4==1)throw new e("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,o,a=0,i=0,c="";o=t.charAt(i++);~o&&(n=a%4?64*n+o:o,a++%4)?c+=String.fromCharCode(255&n>>(-2*a&6)):0)o="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(o);return c};function t(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(r(e).replace(/(.)/g,function(e,r){var t=r.charCodeAt(0).toString(16).toUpperCase();return t.length<2&&(t="0"+t),"%"+t}))}(t)}catch(e){return r(t)}}function n(e){this.message=e}function o(e,r){if("string"!=typeof e)throw new n("Invalid token specified");var o=!0===(r=r||{}).header?0:1;try{return JSON.parse(t(e.split(".")[o]))}catch(e){throw new n("Invalid token specified: "+e.message)}}n.prototype=new Error,n.prototype.name="InvalidTokenError";var a=o;a["default"]=o,a.InvalidTokenError=n,module.exports=a},{}],12:[function(require,module,exports){module.exports={"cardOnFile.termsAndConditions":"Terms & Conditions","cardOnFile.accept":"ACCEPT","cardOnFile.decline":"DECLINE"}},{}],13:[function(require,module,exports){arguments[4][12][0].apply(exports,arguments)},{dup:12}],14:[function(require,module,exports){module.exports={"cardOnFile.termsAndConditions":"Conditions dâ€™utilisation","cardOnFile.accept":"ACCEPTER","cardOnFile.decline":"REFUSER"}},{}],15:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var Config={DEBUG:false,LIB_VERSION:"2.47.0"};var window$1;if(typeof window==="undefined"){var loc={hostname:""};window$1={navigator:{userAgent:""},document:{location:loc,referrer:""},screen:{width:0,height:0},location:loc}}else{window$1=window}var ArrayProto=Array.prototype;var FuncProto=Function.prototype;var ObjProto=Object.prototype;var slice=ArrayProto.slice;var toString=ObjProto.toString;var hasOwnProperty=ObjProto.hasOwnProperty;var windowConsole=window$1.console;var navigator=window$1.navigator;var document$1=window$1.document;var windowOpera=window$1.opera;var screen=window$1.screen;var userAgent=navigator.userAgent;var nativeBind=FuncProto.bind;var nativeForEach=ArrayProto.forEach;var nativeIndexOf=ArrayProto.indexOf;var nativeMap=ArrayProto.map;var nativeIsArray=Array.isArray;var breaker={};var _={trim:function trim(str){return str.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"")}};var console={log:function log(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){try{windowConsole.log.apply(windowConsole,arguments)}catch(err){_.each(arguments,function(arg){windowConsole.log(arg)})}}},warn:function warn(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){var args=["Mixpanel warning:"].concat(_.toArray(arguments));try{windowConsole.warn.apply(windowConsole,args)}catch(err){_.each(args,function(arg){windowConsole.warn(arg)})}}},error:function error(){if(Config.DEBUG&&!_.isUndefined(windowConsole)&&windowConsole){var args=["Mixpanel error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,args)}catch(err){_.each(args,function(arg){windowConsole.error(arg)})}}},critical:function critical(){if(!_.isUndefined(windowConsole)&&windowConsole){var args=["Mixpanel error:"].concat(_.toArray(arguments));try{windowConsole.error.apply(windowConsole,args)}catch(err){_.each(args,function(arg){windowConsole.error(arg)})}}}};var log_func_with_prefix=function log_func_with_prefix(func,prefix){return function(){arguments[0]="["+prefix+"] "+arguments[0];return func.apply(console,arguments)}};var console_with_prefix=function console_with_prefix(prefix){return{log:log_func_with_prefix(console.log,prefix),error:log_func_with_prefix(console.error,prefix),critical:log_func_with_prefix(console.critical,prefix)}};_.bind=function(func,context){var args,_bound;if(nativeBind&&func.bind===nativeBind){return nativeBind.apply(func,slice.call(arguments,1))}if(!_.isFunction(func)){throw new TypeError}args=slice.call(arguments,2);_bound=function bound(){if(!(this instanceof _bound)){return func.apply(context,args.concat(slice.call(arguments)))}var ctor={};ctor.prototype=func.prototype;var self=new ctor;ctor.prototype=null;var result=func.apply(self,args.concat(slice.call(arguments)));if(Object(result)===result){return result}return self};return _bound};_.each=function(obj,iterator,context){if(obj===null||obj===undefined){return}if(nativeForEach&&obj.forEach===nativeForEach){obj.forEach(iterator,context)}else if(obj.length===+obj.length){for(var i=0,l=obj.length;i<l;i++){if(i in obj&&iterator.call(context,obj[i],i,obj)===breaker){return}}}else{for(var key in obj){if(hasOwnProperty.call(obj,key)){if(iterator.call(context,obj[key],key,obj)===breaker){return}}}}};_.extend=function(obj){_.each(slice.call(arguments,1),function(source){for(var prop in source){if(source[prop]!==void 0){obj[prop]=source[prop]}}});return obj};_.isArray=nativeIsArray||function(obj){return toString.call(obj)==="[object Array]"};_.isFunction=function(f){try{return/^\s*\bfunction\b/.test(f)}catch(x){return false}};_.isArguments=function(obj){return!!(obj&&hasOwnProperty.call(obj,"callee"))};_.toArray=function(iterable){if(!iterable){return[]}if(iterable.toArray){return iterable.toArray()}if(_.isArray(iterable)){return slice.call(iterable)}if(_.isArguments(iterable)){return slice.call(iterable)}return _.values(iterable)};_.map=function(arr,callback,context){if(nativeMap&&arr.map===nativeMap){return arr.map(callback,context)}else{var results=[];_.each(arr,function(item){results.push(callback.call(context,item))});return results}};_.keys=function(obj){var results=[];if(obj===null){return results}_.each(obj,function(value,key){results[results.length]=key});return results};_.values=function(obj){var results=[];if(obj===null){return results}_.each(obj,function(value){results[results.length]=value});return results};_.include=function(obj,target){var found=false;if(obj===null){return found}if(nativeIndexOf&&obj.indexOf===nativeIndexOf){return obj.indexOf(target)!=-1}_.each(obj,function(value){if(found||(found=value===target)){return breaker}});return found};_.includes=function(str,needle){return str.indexOf(needle)!==-1};_.inherit=function(subclass,superclass){subclass.prototype=new superclass;subclass.prototype.constructor=subclass;subclass.superclass=superclass.prototype;return subclass};_.isObject=function(obj){return obj===Object(obj)&&!_.isArray(obj)};_.isEmptyObject=function(obj){if(_.isObject(obj)){for(var key in obj){if(hasOwnProperty.call(obj,key)){return false}}return true}return false};_.isUndefined=function(obj){return obj===void 0};_.isString=function(obj){return toString.call(obj)=="[object String]"};_.isDate=function(obj){return toString.call(obj)=="[object Date]"};_.isNumber=function(obj){return toString.call(obj)=="[object Number]"};_.isElement=function(obj){return!!(obj&&obj.nodeType===1)};_.encodeDates=function(obj){_.each(obj,function(v,k){if(_.isDate(v)){obj[k]=_.formatDate(v)}else if(_.isObject(v)){obj[k]=_.encodeDates(v)}});return obj};_.timestamp=function(){Date.now=Date.now||function(){return+new Date};return Date.now()};_.formatDate=function(d){function pad(n){return n<10?"0"+n:n}return d.getUTCFullYear()+"-"+pad(d.getUTCMonth()+1)+"-"+pad(d.getUTCDate())+"T"+pad(d.getUTCHours())+":"+pad(d.getUTCMinutes())+":"+pad(d.getUTCSeconds())};_.strip_empty_properties=function(p){var ret={};_.each(p,function(v,k){if(_.isString(v)&&v.length>0){ret[k]=v}});return ret};_.truncate=function(obj,length){var ret;if(typeof obj==="string"){ret=obj.slice(0,length)}else if(_.isArray(obj)){ret=[];_.each(obj,function(val){ret.push(_.truncate(val,length))})}else if(_.isObject(obj)){ret={};_.each(obj,function(val,key){ret[key]=_.truncate(val,length)})}else{ret=obj}return ret};_.JSONEncode=function(){return function(mixed_val){var value=mixed_val;var quote=function quote(string){var escapable=/[\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g;var meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"};escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'};var str=function str(key,holder){var gap="";var indent="    ";var i=0;var k="";var v="";var length=0;var mind=gap;var partial=[];var value=holder[key];if(value&&_typeof(value)==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}switch(_typeof(value)){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}for(k in value){if(hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}v=partial.length===0?"{}":gap?"{"+partial.join(",")+""+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}};return str("",{"":value})}}();_.JSONDecode=function(){var at,ch,escapee={'"':'"',"\\":"\\","/":"/",b:"\b",f:"\f",n:"\n",r:"\r",t:"\t"},text,error=function error(m){var e=new SyntaxError(m);e.at=at;e.text=text;throw e},next=function next(c){if(c&&c!==ch){error("Expected '"+c+"' instead of '"+ch+"'")}ch=text.charAt(at);at+=1;return ch},number=function number(){var number,string="";if(ch==="-"){string="-";next("-")}while(ch>="0"&&ch<="9"){string+=ch;next()}if(ch==="."){string+=".";while(next()&&ch>="0"&&ch<="9"){string+=ch}}if(ch==="e"||ch==="E"){string+=ch;next();if(ch==="-"||ch==="+"){string+=ch;next()}while(ch>="0"&&ch<="9"){string+=ch;next()}}number=+string;if(!isFinite(number)){error("Bad number")}else{return number}},string=function string(){var hex,i,string="",uffff;if(ch==='"'){while(next()){if(ch==='"'){next();return string}if(ch==="\\"){next();if(ch==="u"){uffff=0;for(i=0;i<4;i+=1){hex=parseInt(next(),16);if(!isFinite(hex)){break}uffff=uffff*16+hex}string+=String.fromCharCode(uffff)}else if(typeof escapee[ch]==="string"){string+=escapee[ch]}else{break}}else{string+=ch}}}error("Bad string")},white=function white(){while(ch&&ch<=" "){next()}},word=function word(){switch(ch){case"t":next("t");next("r");next("u");next("e");return true;case"f":next("f");next("a");next("l");next("s");next("e");return false;case"n":next("n");next("u");next("l");next("l");return null}error('Unexpected "'+ch+'"')},value,array=function array(){var array=[];if(ch==="["){next("[");white();if(ch==="]"){next("]");return array}while(ch){array.push(value());white();if(ch==="]"){next("]");return array}next(",");white()}}error("Bad array")},object=function object(){var key,object={};if(ch==="{"){next("{");white();if(ch==="}"){next("}");return object}while(ch){key=string();white();next(":");if(Object.hasOwnProperty.call(object,key)){error('Duplicate key "'+key+'"')}object[key]=value();white();if(ch==="}"){next("}");return object}next(",");white()}}error("Bad object")};value=function value(){white();switch(ch){case"{":return object();case"[":return array();case'"':return string();case"-":return number();default:return ch>="0"&&ch<="9"?number():word()}};return function(source){var result;text=source;at=0;ch=" ";result=value();white();if(ch){error("Syntax error")}return result}}();_.base64Encode=function(data){var b64="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc="",tmp_arr=[];if(!data){return data}data=_.utf8Encode(data);do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join("");switch(data.length%3){case 1:enc=enc.slice(0,-2)+"==";break;case 2:enc=enc.slice(0,-1)+"=";break}return enc};_.utf8Encode=function(string){string=(string+"").replace(/\r\n/g,"\n").replace(/\r/g,"\n");var utftext="",start,end;var stringl=0,n;start=end=0;stringl=string.length;for(n=0;n<stringl;n++){var c1=string.charCodeAt(n);var enc=null;if(c1<128){end++}else if(c1>127&&c1<2048){enc=String.fromCharCode(c1>>6|192,c1&63|128)}else{enc=String.fromCharCode(c1>>12|224,c1>>6&63|128,c1&63|128)}if(enc!==null){if(end>start){utftext+=string.substring(start,end)}utftext+=enc;start=end=n+1}}if(end>start){utftext+=string.substring(start,string.length)}return utftext};_.UUID=function(){var T=function T(){var time=1*new Date;var ticks;if(window$1.performance&&window$1.performance.now){ticks=window$1.performance.now()}else{ticks=0;while(time==1*new Date){ticks++}}return time.toString(16)+Math.floor(ticks).toString(16)};var R=function R(){return Math.random().toString(16).replace(".","")};var UA=function UA(){var ua=userAgent,i,ch,buffer=[],ret=0;function xor(result,byte_array){var j,tmp=0;for(j=0;j<byte_array.length;j++){tmp|=buffer[j]<<j*8}return result^tmp}for(i=0;i<ua.length;i++){ch=ua.charCodeAt(i);buffer.unshift(ch&255);if(buffer.length>=4){ret=xor(ret,buffer);buffer=[]}}if(buffer.length>0){ret=xor(ret,buffer)}return ret.toString(16)};return function(){var se=(screen.height*screen.width).toString(16);return T()+"-"+R()+"-"+UA()+"-"+se+"-"+T()}}();var BLOCKED_UA_STRS=["ahrefsbot","baiduspider","bingbot","bingpreview","facebookexternal","petalbot","pinterest","screaming frog","yahoo! slurp","yandexbot","adsbot-google","apis-google","duplexweb-google","feedfetcher-google","google favicon","google web preview","google-read-aloud","googlebot","googleweblight","mediapartners-google","storebot-google"];_.isBlockedUA=function(ua){var i;ua=ua.toLowerCase();for(i=0;i<BLOCKED_UA_STRS.length;i++){if(ua.indexOf(BLOCKED_UA_STRS[i])!==-1){return true}}return false};_.HTTPBuildQuery=function(formdata,arg_separator){var use_val,use_key,tmp_arr=[];if(_.isUndefined(arg_separator)){arg_separator="&"}_.each(formdata,function(val,key){use_val=encodeURIComponent(val.toString());use_key=encodeURIComponent(key);tmp_arr[tmp_arr.length]=use_key+"="+use_val});return tmp_arr.join(arg_separator)};_.getQueryParam=function(url,param){param=param.replace(/[[]/,"\\[").replace(/[\]]/,"\\]");var regexS="[\\?&]"+param+"=([^&#]*)",regex=new RegExp(regexS),results=regex.exec(url);if(results===null||results&&typeof results[1]!=="string"&&results[1].length){return""}else{var result=results[1];try{result=decodeURIComponent(result)}catch(err){console.error("Skipping decoding for malformed query param: "+result)}return result.replace(/\+/g," ")}};_.cookie={get:function get(name){var nameEQ=name+"=";var ca=document$1.cookie.split(";");for(var i=0;i<ca.length;i++){var c=ca[i];while(c.charAt(0)==" "){c=c.substring(1,c.length)}if(c.indexOf(nameEQ)===0){return decodeURIComponent(c.substring(nameEQ.length,c.length))}}return null},parse:function parse(name){var cookie;try{cookie=_.JSONDecode(_.cookie.get(name))||{}}catch(err){}return cookie},set_seconds:function set_seconds(name,value,seconds,is_cross_subdomain,is_secure,is_cross_site,domain_override){var cdomain="",expires="",secure="";if(domain_override){cdomain="; domain="+domain_override}else if(is_cross_subdomain){var domain=extract_domain(document$1.location.hostname);cdomain=domain?"; domain=."+domain:""}if(seconds){var date=new Date;date.setTime(date.getTime()+seconds*1e3);expires="; expires="+date.toGMTString()}if(is_cross_site){is_secure=true;secure="; SameSite=None"}if(is_secure){secure+="; secure"}document$1.cookie=name+"="+encodeURIComponent(value)+expires+"; path=/"+cdomain+secure},set:function set(name,value,days,is_cross_subdomain,is_secure,is_cross_site,domain_override){var cdomain="",expires="",secure="";if(domain_override){cdomain="; domain="+domain_override}else if(is_cross_subdomain){var domain=extract_domain(document$1.location.hostname);cdomain=domain?"; domain=."+domain:""}if(days){var date=new Date;date.setTime(date.getTime()+days*24*60*60*1e3);expires="; expires="+date.toGMTString()}if(is_cross_site){is_secure=true;secure="; SameSite=None"}if(is_secure){secure+="; secure"}var new_cookie_val=name+"="+encodeURIComponent(value)+expires+"; path=/"+cdomain+secure;document$1.cookie=new_cookie_val;return new_cookie_val},remove:function remove(name,is_cross_subdomain,domain_override){_.cookie.set(name,"",-1,is_cross_subdomain,false,false,domain_override)}};var _localStorageSupported=null;var localStorageSupported=function localStorageSupported(storage,forceCheck){if(_localStorageSupported!==null&&!forceCheck){return _localStorageSupported}var supported=true;try{storage=storage||window.localStorage;var key="__mplss_"+cheap_guid(8),val="xyz";storage.setItem(key,val);if(storage.getItem(key)!==val){supported=false}storage.removeItem(key)}catch(err){supported=false}_localStorageSupported=supported;return supported};_.localStorage={is_supported:function is_supported(force_check){var supported=localStorageSupported(null,force_check);if(!supported){console.error("localStorage unsupported; falling back to cookie store")}return supported},error:function error(msg){console.error("localStorage error: "+msg)},get:function get(name){try{return window.localStorage.getItem(name)}catch(err){_.localStorage.error(err)}return null},parse:function parse(name){try{return _.JSONDecode(_.localStorage.get(name))||{}}catch(err){}return null},set:function set(name,value){try{window.localStorage.setItem(name,value)}catch(err){_.localStorage.error(err)}},remove:function remove(name){try{window.localStorage.removeItem(name)}catch(err){_.localStorage.error(err)}}};_.register_event=function(){var register_event=function register_event(element,type,handler,oldSchool,useCapture){if(!element){console.error("No valid element provided to register_event");return}if(element.addEventListener&&!oldSchool){element.addEventListener(type,handler,!!useCapture)}else{var ontype="on"+type;var old_handler=element[ontype];element[ontype]=makeHandler(element,handler,old_handler)}};function makeHandler(element,new_handler,old_handlers){var handler=function handler(event){event=event||fixEvent(window.event);if(!event){return undefined}var ret=true;var old_result,new_result;if(_.isFunction(old_handlers)){old_result=old_handlers(event)}new_result=new_handler.call(element,event);if(false===old_result||false===new_result){ret=false}return ret};return handler}function fixEvent(event){if(event){event.preventDefault=fixEvent.preventDefault;event.stopPropagation=fixEvent.stopPropagation}return event}fixEvent.preventDefault=function(){this.returnValue=false};fixEvent.stopPropagation=function(){this.cancelBubble=true};return register_event}();var TOKEN_MATCH_REGEX=new RegExp('^(\\w*)\\[(\\w+)([=~\\|\\^\\$\\*]?)=?"?([^\\]"]*)"?\\]$');_.dom_query=function(){function getAllChildren(e){return e.all?e.all:e.getElementsByTagName("*")}var bad_whitespace=/[\t\r\n]/g;function hasClass(elem,selector){var className=" "+selector+" ";return(" "+elem.className+" ").replace(bad_whitespace," ").indexOf(className)>=0}function getElementsBySelector(selector){if(!document$1.getElementsByTagName){return[]}var tokens=selector.split(" ");var token,bits,tagName,found,foundCount,i,j,k,elements,currentContextIndex;var currentContext=[document$1];for(i=0;i<tokens.length;i++){token=tokens[i].replace(/^\s+/,"").replace(/\s+$/,"");if(token.indexOf("#")>-1){bits=token.split("#");tagName=bits[0];var id=bits[1];var element=document$1.getElementById(id);if(!element||tagName&&element.nodeName.toLowerCase()!=tagName){return[]}currentContext=[element];continue}if(token.indexOf(".")>-1){bits=token.split(".");tagName=bits[0];var className=bits[1];if(!tagName){tagName="*"}found=[];foundCount=0;for(j=0;j<currentContext.length;j++){if(tagName=="*"){elements=getAllChildren(currentContext[j])}else{elements=currentContext[j].getElementsByTagName(tagName)}for(k=0;k<elements.length;k++){found[foundCount++]=elements[k]}}currentContext=[];currentContextIndex=0;for(j=0;j<found.length;j++){if(found[j].className&&_.isString(found[j].className)&&hasClass(found[j],className)){currentContext[currentContextIndex++]=found[j]}}continue}var token_match=token.match(TOKEN_MATCH_REGEX);if(token_match){tagName=token_match[1];var attrName=token_match[2];var attrOperator=token_match[3];var attrValue=token_match[4];if(!tagName){tagName="*"}found=[];foundCount=0;for(j=0;j<currentContext.length;j++){if(tagName=="*"){elements=getAllChildren(currentContext[j])}else{elements=currentContext[j].getElementsByTagName(tagName)}for(k=0;k<elements.length;k++){found[foundCount++]=elements[k]}}currentContext=[];currentContextIndex=0;var checkFunction;switch(attrOperator){case"=":checkFunction=function checkFunction(e){return e.getAttribute(attrName)==attrValue};break;case"~":checkFunction=function checkFunction(e){return e.getAttribute(attrName).match(new RegExp("\\b"+attrValue+"\\b"))};break;case"|":checkFunction=function checkFunction(e){return e.getAttribute(attrName).match(new RegExp("^"+attrValue+"-?"))};break;case"^":checkFunction=function checkFunction(e){return e.getAttribute(attrName).indexOf(attrValue)===0};break;case"$":checkFunction=function checkFunction(e){return e.getAttribute(attrName).lastIndexOf(attrValue)==e.getAttribute(attrName).length-attrValue.length};break;case"*":checkFunction=function checkFunction(e){return e.getAttribute(attrName).indexOf(attrValue)>-1};break;default:checkFunction=function checkFunction(e){return e.getAttribute(attrName)}}currentContext=[];currentContextIndex=0;for(j=0;j<found.length;j++){if(checkFunction(found[j])){currentContext[currentContextIndex++]=found[j]}}continue}tagName=token;found=[];foundCount=0;for(j=0;j<currentContext.length;j++){elements=currentContext[j].getElementsByTagName(tagName);for(k=0;k<elements.length;k++){found[foundCount++]=elements[k]}}currentContext=found}return currentContext}return function(query){if(_.isElement(query)){return[query]}else if(_.isObject(query)&&!_.isUndefined(query.length)){return query}else{return getElementsBySelector.call(this,query)}}}();var CAMPAIGN_KEYWORDS=["utm_source","utm_medium","utm_campaign","utm_content","utm_term"];var CLICK_IDS=["dclid","fbclid","gclid","ko_click_id","li_fat_id","msclkid","ttclid","twclid","wbraid"];_.info={campaignParams:function campaignParams(default_value){var kw="",params={};_.each(CAMPAIGN_KEYWORDS,function(kwkey){kw=_.getQueryParam(document$1.URL,kwkey);if(kw.length){params[kwkey]=kw}else if(default_value!==undefined){params[kwkey]=default_value}});return params},clickParams:function clickParams(){var id="",params={};_.each(CLICK_IDS,function(idkey){id=_.getQueryParam(document$1.URL,idkey);if(id.length){params[idkey]=id}});return params},marketingParams:function marketingParams(){return _.extend(_.info.campaignParams(),_.info.clickParams())},searchEngine:function searchEngine(referrer){if(referrer.search("https?://(.*)google.([^/?]*)")===0){return"google"}else if(referrer.search("https?://(.*)bing.com")===0){return"bing"}else if(referrer.search("https?://(.*)yahoo.com")===0){return"yahoo"}else if(referrer.search("https?://(.*)duckduckgo.com")===0){return"duckduckgo"}else{return null}},searchInfo:function searchInfo(referrer){var search=_.info.searchEngine(referrer),param=search!="yahoo"?"q":"p",ret={};if(search!==null){ret["$search_engine"]=search;var keyword=_.getQueryParam(referrer,param);if(keyword.length){ret["mp_keyword"]=keyword}}return ret},browser:function browser(user_agent,vendor,opera){vendor=vendor||"";if(opera||_.includes(user_agent," OPR/")){if(_.includes(user_agent,"Mini")){return"Opera Mini"}return"Opera"}else if(/(BlackBerry|PlayBook|BB10)/i.test(user_agent)){return"BlackBerry"}else if(_.includes(user_agent,"IEMobile")||_.includes(user_agent,"WPDesktop")){return"Internet Explorer Mobile"}else if(_.includes(user_agent,"SamsungBrowser/")){return"Samsung Internet"}else if(_.includes(user_agent,"Edge")||_.includes(user_agent,"Edg/")){return"Microsoft Edge"}else if(_.includes(user_agent,"FBIOS")){return"Facebook Mobile"}else if(_.includes(user_agent,"Chrome")){return"Chrome"}else if(_.includes(user_agent,"CriOS")){return"Chrome iOS"}else if(_.includes(user_agent,"UCWEB")||_.includes(user_agent,"UCBrowser")){return"UC Browser"}else if(_.includes(user_agent,"FxiOS")){return"Firefox iOS"}else if(_.includes(vendor,"Apple")){if(_.includes(user_agent,"Mobile")){return"Mobile Safari"}return"Safari"}else if(_.includes(user_agent,"Android")){return"Android Mobile"}else if(_.includes(user_agent,"Konqueror")){return"Konqueror"}else if(_.includes(user_agent,"Firefox")){return"Firefox"}else if(_.includes(user_agent,"MSIE")||_.includes(user_agent,"Trident/")){return"Internet Explorer"}else if(_.includes(user_agent,"Gecko")){return"Mozilla"}else{return""}},browserVersion:function browserVersion(userAgent,vendor,opera){var browser=_.info.browser(userAgent,vendor,opera);var versionRegexs={"Internet Explorer Mobile":/rv:(\d+(\.\d+)?)/,"Microsoft Edge":/Edge?\/(\d+(\.\d+)?)/,Chrome:/Chrome\/(\d+(\.\d+)?)/,"Chrome iOS":/CriOS\/(\d+(\.\d+)?)/,"UC Browser":/(UCBrowser|UCWEB)\/(\d+(\.\d+)?)/,Safari:/Version\/(\d+(\.\d+)?)/,"Mobile Safari":/Version\/(\d+(\.\d+)?)/,Opera:/(Opera|OPR)\/(\d+(\.\d+)?)/,Firefox:/Firefox\/(\d+(\.\d+)?)/,"Firefox iOS":/FxiOS\/(\d+(\.\d+)?)/,Konqueror:/Konqueror:(\d+(\.\d+)?)/,BlackBerry:/BlackBerry (\d+(\.\d+)?)/,"Android Mobile":/android\s(\d+(\.\d+)?)/,"Samsung Internet":/SamsungBrowser\/(\d+(\.\d+)?)/,"Internet Explorer":/(rv:|MSIE )(\d+(\.\d+)?)/,Mozilla:/rv:(\d+(\.\d+)?)/};var regex=versionRegexs[browser];if(regex===undefined){return null}var matches=userAgent.match(regex);if(!matches){return null}return parseFloat(matches[matches.length-2])},os:function os(){var a=userAgent;if(/Windows/i.test(a)){if(/Phone/.test(a)||/WPDesktop/.test(a)){return"Windows Phone"}return"Windows"}else if(/(iPhone|iPad|iPod)/.test(a)){return"iOS"}else if(/Android/.test(a)){return"Android"}else if(/(BlackBerry|PlayBook|BB10)/i.test(a)){return"BlackBerry"}else if(/Mac/i.test(a)){return"Mac OS X"}else if(/Linux/.test(a)){return"Linux"}else if(/CrOS/.test(a)){return"Chrome OS"}else{return""}},device:function device(user_agent){if(/Windows Phone/i.test(user_agent)||/WPDesktop/.test(user_agent)){return"Windows Phone"}else if(/iPad/.test(user_agent)){return"iPad"}else if(/iPod/.test(user_agent)){return"iPod Touch"}else if(/iPhone/.test(user_agent)){return"iPhone"}else if(/(BlackBerry|PlayBook|BB10)/i.test(user_agent)){return"BlackBerry"}else if(/Android/.test(user_agent)){return"Android"}else{return""}},referringDomain:function referringDomain(referrer){var split=referrer.split("/");if(split.length>=3){return split[2]}return""},properties:function properties(){return _.extend(_.strip_empty_properties({$os:_.info.os(),$browser:_.info.browser(userAgent,navigator.vendor,windowOpera),$referrer:document$1.referrer,$referring_domain:_.info.referringDomain(document$1.referrer),$device:_.info.device(userAgent)}),{$current_url:window$1.location.href,$browser_version:_.info.browserVersion(userAgent,navigator.vendor,windowOpera),$screen_height:screen.height,$screen_width:screen.width,mp_lib:"web",$lib_version:Config.LIB_VERSION,$insert_id:cheap_guid(),time:_.timestamp()/1e3})},people_properties:function people_properties(){return _.extend(_.strip_empty_properties({$os:_.info.os(),$browser:_.info.browser(userAgent,navigator.vendor,windowOpera)}),{$browser_version:_.info.browserVersion(userAgent,navigator.vendor,windowOpera)})},mpPageViewProperties:function mpPageViewProperties(){return _.strip_empty_properties({current_page_title:document$1.title,current_domain:window$1.location.hostname,current_url_path:window$1.location.pathname,current_url_protocol:window$1.location.protocol,current_url_search:window$1.location.search})}};var cheap_guid=function cheap_guid(maxlen){var guid=Math.random().toString(36).substring(2,10)+Math.random().toString(36).substring(2,10);return maxlen?guid.substring(0,maxlen):guid};var SIMPLE_DOMAIN_MATCH_REGEX=/[a-z0-9][a-z0-9-]*\.[a-z]+$/i;var DOMAIN_MATCH_REGEX=/[a-z0-9][a-z0-9-]+\.[a-z.]{2,6}$/i;var extract_domain=function extract_domain(hostname){var domain_regex=DOMAIN_MATCH_REGEX;var parts=hostname.split(".");var tld=parts[parts.length-1];if(tld.length>4||tld==="com"||tld==="org"){domain_regex=SIMPLE_DOMAIN_MATCH_REGEX}var matches=hostname.match(domain_regex);return matches?matches[0]:""};var JSONStringify=null;var JSONParse=null;if(typeof JSON!=="undefined"){JSONStringify=JSON.stringify;JSONParse=JSON.parse}JSONStringify=JSONStringify||_.JSONEncode;JSONParse=JSONParse||_.JSONDecode;_["toArray"]=_.toArray;_["isObject"]=_.isObject;_["JSONEncode"]=_.JSONEncode;_["JSONDecode"]=_.JSONDecode;_["isBlockedUA"]=_.isBlockedUA;_["isEmptyObject"]=_.isEmptyObject;_["info"]=_.info;_["info"]["device"]=_.info.device;_["info"]["browser"]=_.info.browser;_["info"]["browserVersion"]=_.info.browserVersion;_["info"]["properties"]=_.info.properties;var DomTracker=function DomTracker(){};DomTracker.prototype.create_properties=function(){};DomTracker.prototype.event_handler=function(){};DomTracker.prototype.after_track_handler=function(){};DomTracker.prototype.init=function(mixpanel_instance){this.mp=mixpanel_instance;return this};DomTracker.prototype.track=function(query,event_name,properties,user_callback){var that=this;var elements=_.dom_query(query);if(elements.length===0){console.error("The DOM query ("+query+") returned 0 elements");return}_.each(elements,function(element){_.register_event(element,this.override_event,function(e){var options={};var props=that.create_properties(properties,this);var timeout=that.mp.get_config("track_links_timeout");that.event_handler(e,this,options);window.setTimeout(that.track_callback(user_callback,props,options,true),timeout);that.mp.track(event_name,props,that.track_callback(user_callback,props,options))})},this);return true};DomTracker.prototype.track_callback=function(user_callback,props,options,timeout_occured){timeout_occured=timeout_occured||false;var that=this;return function(){if(options.callback_fired){return}options.callback_fired=true;if(user_callback&&user_callback(timeout_occured,props)===false){return}that.after_track_handler(props,options,timeout_occured)}};DomTracker.prototype.create_properties=function(properties,element){var props;if(typeof properties==="function"){props=properties(element)}else{props=_.extend({},properties)}return props};var LinkTracker=function LinkTracker(){this.override_event="click"};_.inherit(LinkTracker,DomTracker);LinkTracker.prototype.create_properties=function(properties,element){var props=LinkTracker.superclass.create_properties.apply(this,arguments);if(element.href){props["url"]=element.href}return props};LinkTracker.prototype.event_handler=function(evt,element,options){options.new_tab=evt.which===2||evt.metaKey||evt.ctrlKey||element.target==="_blank";options.href=element.href;if(!options.new_tab){evt.preventDefault()}};LinkTracker.prototype.after_track_handler=function(props,options){if(options.new_tab){return}setTimeout(function(){window.location=options.href},0)};var FormTracker=function FormTracker(){this.override_event="submit"};_.inherit(FormTracker,DomTracker);FormTracker.prototype.event_handler=function(evt,element,options){options.element=element;evt.preventDefault()};FormTracker.prototype.after_track_handler=function(props,options){setTimeout(function(){options.element.submit()},0)};var logger$2=console_with_prefix("lock");var SharedLock=function SharedLock(key,options){options=options||{};this.storageKey=key;this.storage=options.storage||window.localStorage;this.pollIntervalMS=options.pollIntervalMS||100;this.timeoutMS=options.timeoutMS||2e3};SharedLock.prototype.withLock=function(lockedCB,errorCB,pid){if(!pid&&typeof errorCB!=="function"){pid=errorCB;errorCB=null}var i=pid||(new Date).getTime()+"|"+Math.random();var startTime=(new Date).getTime();var key=this.storageKey;var pollIntervalMS=this.pollIntervalMS;var timeoutMS=this.timeoutMS;var storage=this.storage;var keyX=key+":X";var keyY=key+":Y";var keyZ=key+":Z";var reportError=function reportError(err){errorCB&&errorCB(err)};var delay=function delay(cb){if((new Date).getTime()-startTime>timeoutMS){logger$2.error("Timeout waiting for mutex on "+key+"; clearing lock. ["+i+"]");storage.removeItem(keyZ);storage.removeItem(keyY);loop();return}setTimeout(function(){try{cb()}catch(err){reportError(err)}},pollIntervalMS*(Math.random()+.1))};var waitFor=function waitFor(predicate,cb){if(predicate()){cb()}else{delay(function(){waitFor(predicate,cb)})}};var getSetY=function getSetY(){var valY=storage.getItem(keyY);if(valY&&valY!==i){return false}else{storage.setItem(keyY,i);if(storage.getItem(keyY)===i){return true}else{if(!localStorageSupported(storage,true)){throw new Error("localStorage support dropped while acquiring lock")}return false}}};var loop=function loop(){storage.setItem(keyX,i);waitFor(getSetY,function(){if(storage.getItem(keyX)===i){criticalSection();return}delay(function(){if(storage.getItem(keyY)!==i){loop();return}waitFor(function(){return!storage.getItem(keyZ)},criticalSection)})})};var criticalSection=function criticalSection(){storage.setItem(keyZ,"1");try{lockedCB()}finally{storage.removeItem(keyZ);if(storage.getItem(keyY)===i){storage.removeItem(keyY)}if(storage.getItem(keyX)===i){storage.removeItem(keyX)}}};try{if(localStorageSupported(storage,true)){loop()}else{throw new Error("localStorage support check failed")}}catch(err){reportError(err)}};var logger$1=console_with_prefix("batch");var RequestQueue=function RequestQueue(storageKey,options){options=options||{};this.storageKey=storageKey;this.storage=options.storage||window.localStorage;this.reportError=options.errorReporter||_.bind(logger$1.error,logger$1);this.lock=new SharedLock(storageKey,{storage:this.storage});this.pid=options.pid||null;this.memQueue=[]};RequestQueue.prototype.enqueue=function(item,flushInterval,cb){var queueEntry={id:cheap_guid(),flushAfter:(new Date).getTime()+flushInterval*2,payload:item};this.lock.withLock(_.bind(function lockAcquired(){var succeeded;try{var storedQueue=this.readFromStorage();storedQueue.push(queueEntry);succeeded=this.saveToStorage(storedQueue);if(succeeded){this.memQueue.push(queueEntry)}}catch(err){this.reportError("Error enqueueing item",item);succeeded=false}if(cb){cb(succeeded)}},this),_.bind(function lockFailure(err){this.reportError("Error acquiring storage lock",err);if(cb){cb(false)}},this),this.pid)};RequestQueue.prototype.fillBatch=function(batchSize){var batch=this.memQueue.slice(0,batchSize);if(batch.length<batchSize){var storedQueue=this.readFromStorage();if(storedQueue.length){var idsInBatch={};_.each(batch,function(item){idsInBatch[item["id"]]=true});for(var i=0;i<storedQueue.length;i++){var item=storedQueue[i];if((new Date).getTime()>item["flushAfter"]&&!idsInBatch[item["id"]]){item.orphaned=true;batch.push(item);if(batch.length>=batchSize){break}}}}}return batch};var filterOutIDsAndInvalid=function filterOutIDsAndInvalid(items,idSet){var filteredItems=[];_.each(items,function(item){if(item["id"]&&!idSet[item["id"]]){filteredItems.push(item)}});return filteredItems};RequestQueue.prototype.removeItemsByID=function(ids,cb){var idSet={};_.each(ids,function(id){idSet[id]=true});this.memQueue=filterOutIDsAndInvalid(this.memQueue,idSet);var removeFromStorage=_.bind(function(){var succeeded;try{var storedQueue=this.readFromStorage();storedQueue=filterOutIDsAndInvalid(storedQueue,idSet);succeeded=this.saveToStorage(storedQueue);if(succeeded){storedQueue=this.readFromStorage();for(var i=0;i<storedQueue.length;i++){var item=storedQueue[i];if(item["id"]&&!!idSet[item["id"]]){this.reportError("Item not removed from storage");return false}}}}catch(err){this.reportError("Error removing items",ids);succeeded=false}return succeeded},this);this.lock.withLock(function lockAcquired(){var succeeded=removeFromStorage();if(cb){cb(succeeded)}},_.bind(function lockFailure(err){var succeeded=false;this.reportError("Error acquiring storage lock",err);if(!localStorageSupported(this.storage,true)){succeeded=removeFromStorage();if(!succeeded){try{this.storage.removeItem(this.storageKey)}catch(err){this.reportError("Error clearing queue",err)}}}if(cb){cb(succeeded)}},this),this.pid)};var updatePayloads=function updatePayloads(existingItems,itemsToUpdate){var newItems=[];_.each(existingItems,function(item){var id=item["id"];if(id in itemsToUpdate){var newPayload=itemsToUpdate[id];if(newPayload!==null){item["payload"]=newPayload;newItems.push(item)}}else{newItems.push(item)}});return newItems};RequestQueue.prototype.updatePayloads=function(itemsToUpdate,cb){this.memQueue=updatePayloads(this.memQueue,itemsToUpdate);this.lock.withLock(_.bind(function lockAcquired(){var succeeded;try{var storedQueue=this.readFromStorage();storedQueue=updatePayloads(storedQueue,itemsToUpdate);succeeded=this.saveToStorage(storedQueue)}catch(err){this.reportError("Error updating items",itemsToUpdate);succeeded=false}if(cb){cb(succeeded)}},this),_.bind(function lockFailure(err){this.reportError("Error acquiring storage lock",err);if(cb){cb(false)}},this),this.pid)};RequestQueue.prototype.readFromStorage=function(){var storageEntry;try{storageEntry=this.storage.getItem(this.storageKey);if(storageEntry){storageEntry=JSONParse(storageEntry);if(!_.isArray(storageEntry)){this.reportError("Invalid storage entry:",storageEntry);storageEntry=null}}}catch(err){this.reportError("Error retrieving queue",err);storageEntry=null}return storageEntry||[]};RequestQueue.prototype.saveToStorage=function(queue){try{this.storage.setItem(this.storageKey,JSONStringify(queue));return true}catch(err){this.reportError("Error saving queue",err);return false}};RequestQueue.prototype.clear=function(){this.memQueue=[];this.storage.removeItem(this.storageKey)};var MAX_RETRY_INTERVAL_MS=10*60*1e3;var logger=console_with_prefix("batch");var RequestBatcher=function RequestBatcher(storageKey,options){this.errorReporter=options.errorReporter;this.queue=new RequestQueue(storageKey,{errorReporter:_.bind(this.reportError,this),storage:options.storage});this.libConfig=options.libConfig;this.sendRequest=options.sendRequestFunc;this.beforeSendHook=options.beforeSendHook;this.stopAllBatching=options.stopAllBatchingFunc;this.batchSize=this.libConfig["batch_size"];this.flushInterval=this.libConfig["batch_flush_interval_ms"];this.stopped=!this.libConfig["batch_autostart"];this.consecutiveRemovalFailures=0;this.itemIdsSentSuccessfully={}};RequestBatcher.prototype.enqueue=function(item,cb){this.queue.enqueue(item,this.flushInterval,cb)};RequestBatcher.prototype.start=function(){this.stopped=false;this.consecutiveRemovalFailures=0;this.flush()};RequestBatcher.prototype.stop=function(){this.stopped=true;if(this.timeoutID){clearTimeout(this.timeoutID);this.timeoutID=null}};RequestBatcher.prototype.clear=function(){this.queue.clear()};RequestBatcher.prototype.resetBatchSize=function(){this.batchSize=this.libConfig["batch_size"]};RequestBatcher.prototype.resetFlush=function(){this.scheduleFlush(this.libConfig["batch_flush_interval_ms"])};RequestBatcher.prototype.scheduleFlush=function(flushMS){this.flushInterval=flushMS;if(!this.stopped){this.timeoutID=setTimeout(_.bind(this.flush,this),this.flushInterval)}};RequestBatcher.prototype.flush=function(options){try{if(this.requestInProgress){logger.log("Flush: Request already in progress");return}options=options||{};var timeoutMS=this.libConfig["batch_request_timeout_ms"];var startTime=(new Date).getTime();var currentBatchSize=this.batchSize;var batch=this.queue.fillBatch(currentBatchSize);var dataForRequest=[];var transformedItems={};_.each(batch,function(item){var payload=item["payload"];if(this.beforeSendHook&&!item.orphaned){payload=this.beforeSendHook(payload)}if(payload){if(payload["event"]&&payload["properties"]){payload["properties"]=_.extend({},payload["properties"],{mp_sent_by_lib_version:Config.LIB_VERSION})}var addPayload=true;var itemId=item["id"];if(itemId){if((this.itemIdsSentSuccessfully[itemId]||0)>5){this.reportError("[dupe] item ID sent too many times, not sending",{item:item,batchSize:batch.length,timesSent:this.itemIdsSentSuccessfully[itemId]});addPayload=false}}else{this.reportError("[dupe] found item with no ID",{item:item})}if(addPayload){dataForRequest.push(payload)}}transformedItems[item["id"]]=payload},this);if(dataForRequest.length<1){this.resetFlush();return}this.requestInProgress=true;var batchSendCallback=_.bind(function(res){this.requestInProgress=false;try{var removeItemsFromQueue=false;if(options.unloading){this.queue.updatePayloads(transformedItems)}else if(_.isObject(res)&&res.error==="timeout"&&(new Date).getTime()-startTime>=timeoutMS){this.reportError("Network timeout; retrying");this.flush()}else if(_.isObject(res)&&res.xhr_req&&(res.xhr_req["status"]>=500||res.xhr_req["status"]===429||res.error==="timeout")){var retryMS=this.flushInterval*2;var headers=res.xhr_req["responseHeaders"];if(headers){var retryAfter=headers["Retry-After"];if(retryAfter){retryMS=parseInt(retryAfter,10)*1e3||retryMS}}retryMS=Math.min(MAX_RETRY_INTERVAL_MS,retryMS);this.reportError("Error; retry in "+retryMS+" ms");this.scheduleFlush(retryMS)}else if(_.isObject(res)&&res.xhr_req&&res.xhr_req["status"]===413){if(batch.length>1){var halvedBatchSize=Math.max(1,Math.floor(currentBatchSize/2));this.batchSize=Math.min(this.batchSize,halvedBatchSize,batch.length-1);this.reportError("413 response; reducing batch size to "+this.batchSize);this.resetFlush()}else{this.reportError("Single-event request too large; dropping",batch);this.resetBatchSize();removeItemsFromQueue=true}}else{removeItemsFromQueue=true}if(removeItemsFromQueue){this.queue.removeItemsByID(_.map(batch,function(item){return item["id"]}),_.bind(function(succeeded){if(succeeded){this.consecutiveRemovalFailures=0;this.flush()}else{this.reportError("Failed to remove items from queue");if(++this.consecutiveRemovalFailures>5){this.reportError("Too many queue failures; disabling batching system.");this.stopAllBatching()}else{this.resetFlush()}}},this));_.each(batch,_.bind(function(item){var itemId=item["id"];if(itemId){this.itemIdsSentSuccessfully[itemId]=this.itemIdsSentSuccessfully[itemId]||0;this.itemIdsSentSuccessfully[itemId]++;if(this.itemIdsSentSuccessfully[itemId]>5){this.reportError("[dupe] item ID sent too many times",{item:item,batchSize:batch.length,timesSent:this.itemIdsSentSuccessfully[itemId]})}}else{this.reportError("[dupe] found item with no ID while removing",{item:item})}},this))}}catch(err){this.reportError("Error handling API response",err);this.resetFlush()}},this);var requestOptions={method:"POST",verbose:true,ignore_json_errors:true,timeout_ms:timeoutMS};if(options.unloading){requestOptions.transport="sendBeacon"}logger.log("MIXPANEL REQUEST:",dataForRequest);this.sendRequest(dataForRequest,requestOptions,batchSendCallback)}catch(err){this.reportError("Error flushing request queue",err);this.resetFlush()}};RequestBatcher.prototype.reportError=function(msg,err){logger.error.apply(logger.error,arguments);if(this.errorReporter){try{if(!(err instanceof Error)){err=new Error(msg)}this.errorReporter(msg,err)}catch(err){logger.error(err)}}};var GDPR_DEFAULT_PERSISTENCE_PREFIX="__mp_opt_in_out_";function optIn(token,options){_optInOut(true,token,options)}function optOut(token,options){_optInOut(false,token,options)}function hasOptedIn(token,options){return _getStorageValue(token,options)==="1"}function hasOptedOut(token,options){if(_hasDoNotTrackFlagOn(options)){console.warn('This browser has "Do Not Track" enabled. This will prevent the Mixpanel SDK from sending any data. To ignore the "Do Not Track" browser setting, initialize the Mixpanel instance with the config "ignore_dnt: true"');return true}var optedOut=_getStorageValue(token,options)==="0";if(optedOut){console.warn("You are opted out of Mixpanel tracking. This will prevent the Mixpanel SDK from sending any data.")}return optedOut}function addOptOutCheckMixpanelLib(method){return _addOptOutCheck(method,function(name){return this.get_config(name)})}function addOptOutCheckMixpanelPeople(method){return _addOptOutCheck(method,function(name){return this._get_config(name)})}function addOptOutCheckMixpanelGroup(method){return _addOptOutCheck(method,function(name){return this._get_config(name)})}function clearOptInOut(token,options){options=options||{};_getStorage(options).remove(_getStorageKey(token,options),!!options.crossSubdomainCookie,options.cookieDomain)}function _getStorage(options){options=options||{};return options.persistenceType==="localStorage"?_.localStorage:_.cookie}function _getStorageKey(token,options){options=options||{};return(options.persistencePrefix||GDPR_DEFAULT_PERSISTENCE_PREFIX)+token}function _getStorageValue(token,options){return _getStorage(options).get(_getStorageKey(token,options))}function _hasDoNotTrackFlagOn(options){if(options&&options.ignoreDnt){return false}var win=options&&options.window||window$1;var nav=win["navigator"]||{};var hasDntOn=false;_.each([nav["doNotTrack"],nav["msDoNotTrack"],win["doNotTrack"]],function(dntValue){if(_.includes([true,1,"1","yes"],dntValue)){hasDntOn=true}});return hasDntOn}function _optInOut(optValue,token,options){if(!_.isString(token)||!token.length){console.error("gdpr."+(optValue?"optIn":"optOut")+" called with an invalid token");return}options=options||{};_getStorage(options).set(_getStorageKey(token,options),optValue?1:0,_.isNumber(options.cookieExpiration)?options.cookieExpiration:null,!!options.crossSubdomainCookie,!!options.secureCookie,!!options.crossSiteCookie,options.cookieDomain);if(options.track&&optValue){options.track(options.trackEventName||"$opt_in",options.trackProperties,{send_immediately:true})}}function _addOptOutCheck(method,getConfigValue){return function(){var optedOut=false;try{var token=getConfigValue.call(this,"token");var ignoreDnt=getConfigValue.call(this,"ignore_dnt");var persistenceType=getConfigValue.call(this,"opt_out_tracking_persistence_type");var persistencePrefix=getConfigValue.call(this,"opt_out_tracking_cookie_prefix");var win=getConfigValue.call(this,"window");if(token){optedOut=hasOptedOut(token,{ignoreDnt:ignoreDnt,persistenceType:persistenceType,persistencePrefix:persistencePrefix,window:win})}}catch(err){console.error("Unexpected error when checking tracking opt-out status: "+err)}if(!optedOut){return method.apply(this,arguments)}var callback=arguments[arguments.length-1];if(typeof callback==="function"){callback(0)}return}}var SET_ACTION="$set";var SET_ONCE_ACTION="$set_once";var UNSET_ACTION="$unset";var ADD_ACTION="$add";var APPEND_ACTION="$append";var UNION_ACTION="$union";var REMOVE_ACTION="$remove";var DELETE_ACTION="$delete";var apiActions={set_action:function set_action(prop,to){var data={};var $set={};if(_.isObject(prop)){_.each(prop,function(v,k){if(!this._is_reserved_property(k)){$set[k]=v}},this)}else{$set[prop]=to}data[SET_ACTION]=$set;return data},unset_action:function unset_action(prop){var data={};var $unset=[];if(!_.isArray(prop)){prop=[prop]}_.each(prop,function(k){if(!this._is_reserved_property(k)){$unset.push(k)}},this);data[UNSET_ACTION]=$unset;return data},set_once_action:function set_once_action(prop,to){var data={};var $set_once={};if(_.isObject(prop)){_.each(prop,function(v,k){if(!this._is_reserved_property(k)){$set_once[k]=v}},this)}else{$set_once[prop]=to}data[SET_ONCE_ACTION]=$set_once;return data},union_action:function union_action(list_name,values){var data={};var $union={};if(_.isObject(list_name)){_.each(list_name,function(v,k){if(!this._is_reserved_property(k)){$union[k]=_.isArray(v)?v:[v]}},this)}else{$union[list_name]=_.isArray(values)?values:[values]}data[UNION_ACTION]=$union;return data},append_action:function append_action(list_name,value){var data={};var $append={};if(_.isObject(list_name)){_.each(list_name,function(v,k){if(!this._is_reserved_property(k)){$append[k]=v}},this)}else{$append[list_name]=value}data[APPEND_ACTION]=$append;return data},remove_action:function remove_action(list_name,value){var data={};var $remove={};if(_.isObject(list_name)){_.each(list_name,function(v,k){if(!this._is_reserved_property(k)){$remove[k]=v}},this)}else{$remove[list_name]=value}data[REMOVE_ACTION]=$remove;return data},delete_action:function delete_action(){var data={};data[DELETE_ACTION]="";return data}};var MixpanelGroup=function MixpanelGroup(){};_.extend(MixpanelGroup.prototype,apiActions);MixpanelGroup.prototype._init=function(mixpanel_instance,group_key,group_id){this._mixpanel=mixpanel_instance;this._group_key=group_key;this._group_id=group_id};MixpanelGroup.prototype.set=addOptOutCheckMixpanelGroup(function(prop,to,callback){var data=this.set_action(prop,to);if(_.isObject(prop)){callback=to}return this._send_request(data,callback)});MixpanelGroup.prototype.set_once=addOptOutCheckMixpanelGroup(function(prop,to,callback){var data=this.set_once_action(prop,to);if(_.isObject(prop)){callback=to}return this._send_request(data,callback)});MixpanelGroup.prototype.unset=addOptOutCheckMixpanelGroup(function(prop,callback){var data=this.unset_action(prop);return this._send_request(data,callback)});MixpanelGroup.prototype.union=addOptOutCheckMixpanelGroup(function(list_name,values,callback){if(_.isObject(list_name)){callback=values}var data=this.union_action(list_name,values);return this._send_request(data,callback)});MixpanelGroup.prototype["delete"]=addOptOutCheckMixpanelGroup(function(callback){var data=this.delete_action();return this._send_request(data,callback)});MixpanelGroup.prototype.remove=addOptOutCheckMixpanelGroup(function(list_name,value,callback){var data=this.remove_action(list_name,value);return this._send_request(data,callback)});MixpanelGroup.prototype._send_request=function(data,callback){data["$group_key"]=this._group_key;data["$group_id"]=this._group_id;data["$token"]=this._get_config("token");var date_encoded_data=_.encodeDates(data);return this._mixpanel._track_or_batch({type:"groups",data:date_encoded_data,endpoint:this._get_config("api_host")+"/groups/",batcher:this._mixpanel.request_batchers.groups},callback)};MixpanelGroup.prototype._is_reserved_property=function(prop){return prop==="$group_key"||prop==="$group_id"};MixpanelGroup.prototype._get_config=function(conf){return this._mixpanel.get_config(conf)};MixpanelGroup.prototype.toString=function(){return this._mixpanel.toString()+".group."+this._group_key+"."+this._group_id};MixpanelGroup.prototype["remove"]=MixpanelGroup.prototype.remove;MixpanelGroup.prototype["set"]=MixpanelGroup.prototype.set;MixpanelGroup.prototype["set_once"]=MixpanelGroup.prototype.set_once;MixpanelGroup.prototype["union"]=MixpanelGroup.prototype.union;MixpanelGroup.prototype["unset"]=MixpanelGroup.prototype.unset;MixpanelGroup.prototype["toString"]=MixpanelGroup.prototype.toString;var MixpanelPeople=function MixpanelPeople(){};_.extend(MixpanelPeople.prototype,apiActions);MixpanelPeople.prototype._init=function(mixpanel_instance){this._mixpanel=mixpanel_instance};MixpanelPeople.prototype.set=addOptOutCheckMixpanelPeople(function(prop,to,callback){var data=this.set_action(prop,to);if(_.isObject(prop)){callback=to}if(this._get_config("save_referrer")){this._mixpanel["persistence"].update_referrer_info(document.referrer)}data[SET_ACTION]=_.extend({},_.info.people_properties(),this._mixpanel["persistence"].get_referrer_info(),data[SET_ACTION]);return this._send_request(data,callback)});MixpanelPeople.prototype.set_once=addOptOutCheckMixpanelPeople(function(prop,to,callback){var data=this.set_once_action(prop,to);if(_.isObject(prop)){callback=to}return this._send_request(data,callback)});MixpanelPeople.prototype.unset=addOptOutCheckMixpanelPeople(function(prop,callback){var data=this.unset_action(prop);return this._send_request(data,callback)});MixpanelPeople.prototype.increment=addOptOutCheckMixpanelPeople(function(prop,by,callback){var data={};var $add={};if(_.isObject(prop)){_.each(prop,function(v,k){if(!this._is_reserved_property(k)){if(isNaN(parseFloat(v))){console.error("Invalid increment value passed to mixpanel.people.increment - must be a number");return}else{$add[k]=v}}},this);callback=by}else{if(_.isUndefined(by)){by=1}$add[prop]=by}data[ADD_ACTION]=$add;return this._send_request(data,callback)});MixpanelPeople.prototype.append=addOptOutCheckMixpanelPeople(function(list_name,value,callback){if(_.isObject(list_name)){callback=value}var data=this.append_action(list_name,value);return this._send_request(data,callback)});MixpanelPeople.prototype.remove=addOptOutCheckMixpanelPeople(function(list_name,value,callback){if(_.isObject(list_name)){callback=value}var data=this.remove_action(list_name,value);return this._send_request(data,callback)});MixpanelPeople.prototype.union=addOptOutCheckMixpanelPeople(function(list_name,values,callback){if(_.isObject(list_name)){callback=values}var data=this.union_action(list_name,values);return this._send_request(data,callback)});MixpanelPeople.prototype.track_charge=addOptOutCheckMixpanelPeople(function(amount,properties,callback){if(!_.isNumber(amount)){amount=parseFloat(amount);if(isNaN(amount)){console.error("Invalid value passed to mixpanel.people.track_charge - must be a number");return}}return this.append("$transactions",_.extend({$amount:amount},properties),callback)});MixpanelPeople.prototype.clear_charges=function(callback){return this.set("$transactions",[],callback)};MixpanelPeople.prototype.delete_user=function(){if(!this._identify_called()){console.error("mixpanel.people.delete_user() requires you to call identify() first");return}var data={$delete:this._mixpanel.get_distinct_id()};return this._send_request(data)};MixpanelPeople.prototype.toString=function(){return this._mixpanel.toString()+".people"};MixpanelPeople.prototype._send_request=function(data,callback){data["$token"]=this._get_config("token");data["$distinct_id"]=this._mixpanel.get_distinct_id();var device_id=this._mixpanel.get_property("$device_id");var user_id=this._mixpanel.get_property("$user_id");var had_persisted_distinct_id=this._mixpanel.get_property("$had_persisted_distinct_id");if(device_id){data["$device_id"]=device_id}if(user_id){data["$user_id"]=user_id}if(had_persisted_distinct_id){data["$had_persisted_distinct_id"]=had_persisted_distinct_id}var date_encoded_data=_.encodeDates(data);if(!this._identify_called()){this._enqueue(data);if(!_.isUndefined(callback)){if(this._get_config("verbose")){callback({status:-1,error:null})}else{callback(-1)}}return _.truncate(date_encoded_data,255)}return this._mixpanel._track_or_batch({type:"people",data:date_encoded_data,endpoint:this._get_config("api_host")+"/engage/",batcher:this._mixpanel.request_batchers.people},callback)};MixpanelPeople.prototype._get_config=function(conf_var){return this._mixpanel.get_config(conf_var)};MixpanelPeople.prototype._identify_called=function(){return this._mixpanel._flags.identify_called===true};MixpanelPeople.prototype._enqueue=function(data){if(SET_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(SET_ACTION,data)}else if(SET_ONCE_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(SET_ONCE_ACTION,data)}else if(UNSET_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(UNSET_ACTION,data)}else if(ADD_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(ADD_ACTION,data)}else if(APPEND_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(APPEND_ACTION,data)}else if(REMOVE_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(REMOVE_ACTION,data)}else if(UNION_ACTION in data){this._mixpanel["persistence"]._add_to_people_queue(UNION_ACTION,data)}else{console.error("Invalid call to _enqueue():",data)}};MixpanelPeople.prototype._flush_one_queue=function(action,action_method,callback,queue_to_params_fn){var _this=this;var queued_data=_.extend({},this._mixpanel["persistence"]._get_queue(action));var action_params=queued_data;if(!_.isUndefined(queued_data)&&_.isObject(queued_data)&&!_.isEmptyObject(queued_data)){_this._mixpanel["persistence"]._pop_from_people_queue(action,queued_data);if(queue_to_params_fn){action_params=queue_to_params_fn(queued_data)}action_method.call(_this,action_params,function(response,data){if(response===0){_this._mixpanel["persistence"]._add_to_people_queue(action,queued_data)}if(!_.isUndefined(callback)){callback(response,data)}})}};MixpanelPeople.prototype._flush=function(_set_callback,_add_callback,_append_callback,_set_once_callback,_union_callback,_unset_callback,_remove_callback){var _this=this;var $append_queue=this._mixpanel["persistence"]._get_queue(APPEND_ACTION);var $remove_queue=this._mixpanel["persistence"]._get_queue(REMOVE_ACTION);this._flush_one_queue(SET_ACTION,this.set,_set_callback);this._flush_one_queue(SET_ONCE_ACTION,this.set_once,_set_once_callback);this._flush_one_queue(UNSET_ACTION,this.unset,_unset_callback,function(queue){return _.keys(queue)});this._flush_one_queue(ADD_ACTION,this.increment,_add_callback);this._flush_one_queue(UNION_ACTION,this.union,_union_callback);if(!_.isUndefined($append_queue)&&_.isArray($append_queue)&&$append_queue.length){var $append_item;var append_callback=function append_callback(response,data){if(response===0){_this._mixpanel["persistence"]._add_to_people_queue(APPEND_ACTION,$append_item)}if(!_.isUndefined(_append_callback)){_append_callback(response,data)}};for(var i=$append_queue.length-1;i>=0;i--){$append_item=$append_queue.pop();if(!_.isEmptyObject($append_item)){_this.append($append_item,append_callback)}}_this._mixpanel["persistence"].save()}if(!_.isUndefined($remove_queue)&&_.isArray($remove_queue)&&$remove_queue.length){var $remove_item;var remove_callback=function remove_callback(response,data){if(response===0){_this._mixpanel["persistence"]._add_to_people_queue(REMOVE_ACTION,$remove_item)}if(!_.isUndefined(_remove_callback)){_remove_callback(response,data)}};for(var j=$remove_queue.length-1;j>=0;j--){$remove_item=$remove_queue.pop();if(!_.isEmptyObject($remove_item)){_this.remove($remove_item,remove_callback)}}_this._mixpanel["persistence"].save()}};MixpanelPeople.prototype._is_reserved_property=function(prop){return prop==="$distinct_id"||prop==="$token"||prop==="$device_id"||prop==="$user_id"||prop==="$had_persisted_distinct_id"};MixpanelPeople.prototype["set"]=MixpanelPeople.prototype.set;MixpanelPeople.prototype["set_once"]=MixpanelPeople.prototype.set_once;MixpanelPeople.prototype["unset"]=MixpanelPeople.prototype.unset;MixpanelPeople.prototype["increment"]=MixpanelPeople.prototype.increment;MixpanelPeople.prototype["append"]=MixpanelPeople.prototype.append;MixpanelPeople.prototype["remove"]=MixpanelPeople.prototype.remove;MixpanelPeople.prototype["union"]=MixpanelPeople.prototype.union;MixpanelPeople.prototype["track_charge"]=MixpanelPeople.prototype.track_charge;MixpanelPeople.prototype["clear_charges"]=MixpanelPeople.prototype.clear_charges;MixpanelPeople.prototype["delete_user"]=MixpanelPeople.prototype.delete_user;MixpanelPeople.prototype["toString"]=MixpanelPeople.prototype.toString;var SET_QUEUE_KEY="__mps";var SET_ONCE_QUEUE_KEY="__mpso";var UNSET_QUEUE_KEY="__mpus";var ADD_QUEUE_KEY="__mpa";var APPEND_QUEUE_KEY="__mpap";var REMOVE_QUEUE_KEY="__mpr";var UNION_QUEUE_KEY="__mpu";var PEOPLE_DISTINCT_ID_KEY="$people_distinct_id";var ALIAS_ID_KEY="__alias";var EVENT_TIMERS_KEY="__timers";var RESERVED_PROPERTIES=[SET_QUEUE_KEY,SET_ONCE_QUEUE_KEY,UNSET_QUEUE_KEY,ADD_QUEUE_KEY,APPEND_QUEUE_KEY,REMOVE_QUEUE_KEY,UNION_QUEUE_KEY,PEOPLE_DISTINCT_ID_KEY,ALIAS_ID_KEY,EVENT_TIMERS_KEY];var MixpanelPersistence=function MixpanelPersistence(config){this["props"]={};this.campaign_params_saved=false;if(config["persistence_name"]){this.name="mp_"+config["persistence_name"]}else{this.name="mp_"+config["token"]+"_mixpanel"}var storage_type=config["persistence"];if(storage_type!=="cookie"&&storage_type!=="localStorage"){console.critical("Unknown persistence type "+storage_type+"; falling back to cookie");storage_type=config["persistence"]="cookie"}if(storage_type==="localStorage"&&_.localStorage.is_supported()){this.storage=_.localStorage}else{this.storage=_.cookie}this.load();this.update_config(config);this.upgrade(config);this.save()};MixpanelPersistence.prototype.properties=function(){var p={};_.each(this["props"],function(v,k){if(!_.include(RESERVED_PROPERTIES,k)){p[k]=v}});return p};MixpanelPersistence.prototype.load=function(){if(this.disabled){return}var entry=this.storage.parse(this.name);if(entry){this["props"]=_.extend({},entry)}};MixpanelPersistence.prototype.upgrade=function(config){var upgrade_from_old_lib=config["upgrade"],old_cookie_name,old_cookie;if(upgrade_from_old_lib){old_cookie_name="mp_super_properties";if(typeof upgrade_from_old_lib==="string"){old_cookie_name=upgrade_from_old_lib}old_cookie=this.storage.parse(old_cookie_name);this.storage.remove(old_cookie_name);this.storage.remove(old_cookie_name,true);if(old_cookie){this["props"]=_.extend(this["props"],old_cookie["all"],old_cookie["events"])}}if(!config["cookie_name"]&&config["name"]!=="mixpanel"){old_cookie_name="mp_"+config["token"]+"_"+config["name"];old_cookie=this.storage.parse(old_cookie_name);if(old_cookie){this.storage.remove(old_cookie_name);this.storage.remove(old_cookie_name,true);this.register_once(old_cookie)}}if(this.storage===_.localStorage){old_cookie=_.cookie.parse(this.name);_.cookie.remove(this.name);_.cookie.remove(this.name,true);if(old_cookie){this.register_once(old_cookie)}}};MixpanelPersistence.prototype.save=function(){if(this.disabled){return}this.storage.set(this.name,_.JSONEncode(this["props"]),this.expire_days,this.cross_subdomain,this.secure,this.cross_site,this.cookie_domain)};MixpanelPersistence.prototype.remove=function(){this.storage.remove(this.name,false,this.cookie_domain);this.storage.remove(this.name,true,this.cookie_domain)};MixpanelPersistence.prototype.clear=function(){this.remove();this["props"]={}};MixpanelPersistence.prototype.register_once=function(props,default_value,days){if(_.isObject(props)){if(typeof default_value==="undefined"){default_value="None"}this.expire_days=typeof days==="undefined"?this.default_expiry:days;_.each(props,function(val,prop){if(!this["props"].hasOwnProperty(prop)||this["props"][prop]===default_value){this["props"][prop]=val}},this);this.save();return true}return false};MixpanelPersistence.prototype.register=function(props,days){if(_.isObject(props)){this.expire_days=typeof days==="undefined"?this.default_expiry:days;_.extend(this["props"],props);this.save();return true}return false};MixpanelPersistence.prototype.unregister=function(prop){if(prop in this["props"]){delete this["props"][prop];this.save()}};MixpanelPersistence.prototype.update_search_keyword=function(referrer){this.register(_.info.searchInfo(referrer))};MixpanelPersistence.prototype.update_referrer_info=function(referrer){this.register_once({$initial_referrer:referrer||"$direct",$initial_referring_domain:_.info.referringDomain(referrer)||"$direct"},"")};MixpanelPersistence.prototype.get_referrer_info=function(){return _.strip_empty_properties({$initial_referrer:this["props"]["$initial_referrer"],$initial_referring_domain:this["props"]["$initial_referring_domain"]})};MixpanelPersistence.prototype.safe_merge=function(props){_.each(this["props"],function(val,prop){if(!(prop in props)){props[prop]=val}});return props};MixpanelPersistence.prototype.update_config=function(config){this.default_expiry=this.expire_days=config["cookie_expiration"];this.set_disabled(config["disable_persistence"]);this.set_cookie_domain(config["cookie_domain"]);this.set_cross_site(config["cross_site_cookie"]);this.set_cross_subdomain(config["cross_subdomain_cookie"]);this.set_secure(config["secure_cookie"])};MixpanelPersistence.prototype.set_disabled=function(disabled){this.disabled=disabled;if(this.disabled){this.remove()}else{this.save()}};MixpanelPersistence.prototype.set_cookie_domain=function(cookie_domain){if(cookie_domain!==this.cookie_domain){this.remove();this.cookie_domain=cookie_domain;this.save()}};MixpanelPersistence.prototype.set_cross_site=function(cross_site){if(cross_site!==this.cross_site){this.cross_site=cross_site;this.remove();this.save()}};MixpanelPersistence.prototype.set_cross_subdomain=function(cross_subdomain){if(cross_subdomain!==this.cross_subdomain){this.cross_subdomain=cross_subdomain;this.remove();this.save()}};MixpanelPersistence.prototype.get_cross_subdomain=function(){return this.cross_subdomain};MixpanelPersistence.prototype.set_secure=function(secure){if(secure!==this.secure){this.secure=secure?true:false;this.remove();this.save()}};MixpanelPersistence.prototype._add_to_people_queue=function(queue,data){var q_key=this._get_queue_key(queue),q_data=data[queue],set_q=this._get_or_create_queue(SET_ACTION),set_once_q=this._get_or_create_queue(SET_ONCE_ACTION),unset_q=this._get_or_create_queue(UNSET_ACTION),add_q=this._get_or_create_queue(ADD_ACTION),union_q=this._get_or_create_queue(UNION_ACTION),remove_q=this._get_or_create_queue(REMOVE_ACTION,[]),append_q=this._get_or_create_queue(APPEND_ACTION,[]);if(q_key===SET_QUEUE_KEY){_.extend(set_q,q_data);this._pop_from_people_queue(ADD_ACTION,q_data);this._pop_from_people_queue(UNION_ACTION,q_data);this._pop_from_people_queue(UNSET_ACTION,q_data)}else if(q_key===SET_ONCE_QUEUE_KEY){_.each(q_data,function(v,k){if(!(k in set_once_q)){set_once_q[k]=v}});this._pop_from_people_queue(UNSET_ACTION,q_data)}else if(q_key===UNSET_QUEUE_KEY){_.each(q_data,function(prop){_.each([set_q,set_once_q,add_q,union_q],function(enqueued_obj){if(prop in enqueued_obj){delete enqueued_obj[prop]}});_.each(append_q,function(append_obj){if(prop in append_obj){delete append_obj[prop]}});unset_q[prop]=true})}else if(q_key===ADD_QUEUE_KEY){_.each(q_data,function(v,k){if(k in set_q){set_q[k]+=v}else{if(!(k in add_q)){add_q[k]=0}add_q[k]+=v}},this);this._pop_from_people_queue(UNSET_ACTION,q_data)}else if(q_key===UNION_QUEUE_KEY){_.each(q_data,function(v,k){if(_.isArray(v)){if(!(k in union_q)){union_q[k]=[]}union_q[k]=union_q[k].concat(v)}});this._pop_from_people_queue(UNSET_ACTION,q_data)}else if(q_key===REMOVE_QUEUE_KEY){remove_q.push(q_data);this._pop_from_people_queue(APPEND_ACTION,q_data)}else if(q_key===APPEND_QUEUE_KEY){append_q.push(q_data);this._pop_from_people_queue(UNSET_ACTION,q_data)}console.log("MIXPANEL PEOPLE REQUEST (QUEUED, PENDING IDENTIFY):");console.log(data);this.save()};MixpanelPersistence.prototype._pop_from_people_queue=function(queue,data){var q=this._get_queue(queue);if(!_.isUndefined(q)){_.each(data,function(v,k){if(queue===APPEND_ACTION||queue===REMOVE_ACTION){_.each(q,function(queued_action){if(queued_action[k]===v){delete queued_action[k]}})}else{delete q[k]}},this);this.save()}};MixpanelPersistence.prototype._get_queue_key=function(queue){if(queue===SET_ACTION){return SET_QUEUE_KEY}else if(queue===SET_ONCE_ACTION){return SET_ONCE_QUEUE_KEY}else if(queue===UNSET_ACTION){return UNSET_QUEUE_KEY}else if(queue===ADD_ACTION){return ADD_QUEUE_KEY}else if(queue===APPEND_ACTION){return APPEND_QUEUE_KEY}else if(queue===REMOVE_ACTION){return REMOVE_QUEUE_KEY}else if(queue===UNION_ACTION){return UNION_QUEUE_KEY}else{console.error("Invalid queue:",queue)}};MixpanelPersistence.prototype._get_queue=function(queue){return this["props"][this._get_queue_key(queue)]};MixpanelPersistence.prototype._get_or_create_queue=function(queue,default_val){var key=this._get_queue_key(queue);default_val=_.isUndefined(default_val)?{}:default_val;return this["props"][key]||(this["props"][key]=default_val)};MixpanelPersistence.prototype.set_event_timer=function(event_name,timestamp){var timers=this["props"][EVENT_TIMERS_KEY]||{};timers[event_name]=timestamp;this["props"][EVENT_TIMERS_KEY]=timers;this.save()};MixpanelPersistence.prototype.remove_event_timer=function(event_name){var timers=this["props"][EVENT_TIMERS_KEY]||{};var timestamp=timers[event_name];if(!_.isUndefined(timestamp)){delete this["props"][EVENT_TIMERS_KEY][event_name];this.save()}return timestamp};var init_type;var mixpanel_master;var INIT_MODULE=0;var INIT_SNIPPET=1;var IDENTITY_FUNC=function IDENTITY_FUNC(x){return x};var NOOP_FUNC=function NOOP_FUNC(){};var PRIMARY_INSTANCE_NAME="mixpanel";var PAYLOAD_TYPE_BASE64="base64";var PAYLOAD_TYPE_JSON="json";var DEVICE_ID_PREFIX="$device:";var USE_XHR=window$1.XMLHttpRequest&&"withCredentials"in new XMLHttpRequest;var ENQUEUE_REQUESTS=!USE_XHR&&userAgent.indexOf("MSIE")===-1&&userAgent.indexOf("Mozilla")===-1;var sendBeacon=null;if(navigator["sendBeacon"]){sendBeacon=function sendBeacon(){return navigator["sendBeacon"].apply(navigator,arguments)}}var DEFAULT_CONFIG={api_host:"https://api-js.mixpanel.com",api_method:"POST",api_transport:"XHR",api_payload_format:PAYLOAD_TYPE_BASE64,app_host:"https://mixpanel.com",cdn:"https://cdn.mxpnl.com",cross_site_cookie:false,cross_subdomain_cookie:true,error_reporter:NOOP_FUNC,persistence:"cookie",persistence_name:"",cookie_domain:"",cookie_name:"",loaded:NOOP_FUNC,track_marketing:true,track_pageview:false,skip_first_touch_marketing:false,store_google:true,save_referrer:true,test:false,verbose:false,img:false,debug:false,track_links_timeout:300,cookie_expiration:365,upgrade:false,disable_persistence:false,disable_cookie:false,secure_cookie:false,ip:true,opt_out_tracking_by_default:false,opt_out_persistence_by_default:false,opt_out_tracking_persistence_type:"localStorage",opt_out_tracking_cookie_prefix:null,property_blacklist:[],xhr_headers:{},ignore_dnt:false,batch_requests:true,batch_size:50,batch_flush_interval_ms:5e3,batch_request_timeout_ms:9e4,batch_autostart:true,hooks:{}};var DOM_LOADED=false;var MixpanelLib=function MixpanelLib(){};var create_mplib=function create_mplib(token,config,name){var instance,target=name===PRIMARY_INSTANCE_NAME?mixpanel_master:mixpanel_master[name];if(target&&init_type===INIT_MODULE){instance=target}else{if(target&&!_.isArray(target)){console.error("You have already initialized "+name);return}instance=new MixpanelLib}instance._cached_groups={};instance._init(token,config,name);instance["people"]=new MixpanelPeople;instance["people"]._init(instance);if(!instance.get_config("skip_first_touch_marketing")){var utm_params=_.info.campaignParams(null);var initial_utm_params={};var has_utm=false;_.each(utm_params,function(utm_value,utm_key){initial_utm_params["initial_"+utm_key]=utm_value;if(utm_value){has_utm=true}});if(has_utm){instance["people"].set_once(initial_utm_params)}}Config.DEBUG=Config.DEBUG||instance.get_config("debug");if(!_.isUndefined(target)&&_.isArray(target)){instance._execute_array.call(instance["people"],target["people"]);instance._execute_array(target)}return instance};MixpanelLib.prototype.init=function(token,config,name){if(_.isUndefined(name)){this.report_error("You must name your new library: init(token, config, name)");return}if(name===PRIMARY_INSTANCE_NAME){this.report_error("You must initialize the main mixpanel object right after you include the Mixpanel js snippet");return}var instance=create_mplib(token,config,name);mixpanel_master[name]=instance;instance._loaded();return instance};MixpanelLib.prototype._init=function(token,config,name){config=config||{};this["__loaded"]=true;this["config"]={};var variable_features={};if(!("api_payload_format"in config)){var api_host=config["api_host"]||DEFAULT_CONFIG["api_host"];if(api_host.match(/\.mixpanel\.com/)){variable_features["api_payload_format"]=PAYLOAD_TYPE_JSON}}this.set_config(_.extend({},DEFAULT_CONFIG,variable_features,config,{name:name,token:token,callback_fn:(name===PRIMARY_INSTANCE_NAME?name:PRIMARY_INSTANCE_NAME+"."+name)+"._jsc"}));this["_jsc"]=NOOP_FUNC;this.__dom_loaded_queue=[];this.__request_queue=[];this.__disabled_events=[];this._flags={disable_all_events:false,identify_called:false};this.request_batchers={};this._batch_requests=this.get_config("batch_requests");if(this._batch_requests){if(!_.localStorage.is_supported(true)||!USE_XHR){this._batch_requests=false;console.log("Turning off Mixpanel request-queueing; needs XHR and localStorage support")}else{this.init_batchers();if(sendBeacon&&window$1.addEventListener){var flush_on_unload=_.bind(function(){if(!this.request_batchers.events.stopped){this.request_batchers.events.flush({unloading:true})}},this);window$1.addEventListener("pagehide",function(ev){if(ev["persisted"]){flush_on_unload()}});window$1.addEventListener("visibilitychange",function(){if(document$1["visibilityState"]==="hidden"){flush_on_unload()}})}}}this["persistence"]=this["cookie"]=new MixpanelPersistence(this["config"]);this.unpersisted_superprops={};this._gdpr_init();var uuid=_.UUID();if(!this.get_distinct_id()){this.register_once({distinct_id:DEVICE_ID_PREFIX+uuid,$device_id:uuid},"")}if(this.get_config("track_pageview")){this.track_pageview()}};MixpanelLib.prototype._loaded=function(){this.get_config("loaded")(this);this._set_default_superprops()};MixpanelLib.prototype._set_default_superprops=function(){this["persistence"].update_search_keyword(document$1.referrer);if(this.get_config("store_google")){this.register(_.info.campaignParams(),{persistent:false})}if(this.get_config("save_referrer")){this["persistence"].update_referrer_info(document$1.referrer)}};MixpanelLib.prototype._dom_loaded=function(){_.each(this.__dom_loaded_queue,function(item){this._track_dom.apply(this,item)},this);if(!this.has_opted_out_tracking()){_.each(this.__request_queue,function(item){this._send_request.apply(this,item)},this)}delete this.__dom_loaded_queue;delete this.__request_queue};MixpanelLib.prototype._track_dom=function(DomClass,args){if(this.get_config("img")){this.report_error("You can't use DOM tracking functions with img = true.");return false}if(!DOM_LOADED){this.__dom_loaded_queue.push([DomClass,args]);return false}var dt=(new DomClass).init(this);return dt.track.apply(dt,args)};MixpanelLib.prototype._prepare_callback=function(callback,data){if(_.isUndefined(callback)){return null}if(USE_XHR){var callback_function=function callback_function(response){callback(response,data)};return callback_function}else{var jsc=this["_jsc"];var randomized_cb=""+Math.floor(Math.random()*1e8);var callback_string=this.get_config("callback_fn")+"["+randomized_cb+"]";jsc[randomized_cb]=function(response){delete jsc[randomized_cb];callback(response,data)};return callback_string}};MixpanelLib.prototype._send_request=function(url,data,options,callback){var succeeded=true;if(ENQUEUE_REQUESTS){this.__request_queue.push(arguments);return succeeded}var DEFAULT_OPTIONS={method:this.get_config("api_method"),transport:this.get_config("api_transport"),verbose:this.get_config("verbose")};var body_data=null;if(!callback&&(_.isFunction(options)||typeof options==="string")){callback=options;options=null}options=_.extend(DEFAULT_OPTIONS,options||{});if(!USE_XHR){options.method="GET"}var use_post=options.method==="POST";var use_sendBeacon=sendBeacon&&use_post&&options.transport.toLowerCase()==="sendbeacon";var verbose_mode=options.verbose;if(data["verbose"]){verbose_mode=true}if(this.get_config("test")){data["test"]=1}if(verbose_mode){data["verbose"]=1}if(this.get_config("img")){data["img"]=1}if(!USE_XHR){if(callback){data["callback"]=callback}else if(verbose_mode||this.get_config("test")){data["callback"]="(function(){})"}}data["ip"]=this.get_config("ip")?1:0;data["_"]=(new Date).getTime().toString();if(use_post){body_data="data="+encodeURIComponent(data["data"]);delete data["data"]}url+="?"+_.HTTPBuildQuery(data);var lib=this;if("img"in data){var img=document$1.createElement("img");img.src=url;document$1.body.appendChild(img)}else if(use_sendBeacon){try{succeeded=sendBeacon(url,body_data)}catch(e){lib.report_error(e);succeeded=false}try{if(callback){callback(succeeded?1:0)}}catch(e){lib.report_error(e)}}else if(USE_XHR){try{var req=new XMLHttpRequest;req.open(options.method,url,true);var headers=this.get_config("xhr_headers");if(use_post){headers["Content-Type"]="application/x-www-form-urlencoded"}_.each(headers,function(headerValue,headerName){req.setRequestHeader(headerName,headerValue)});if(options.timeout_ms&&typeof req.timeout!=="undefined"){req.timeout=options.timeout_ms;var start_time=(new Date).getTime()}req.withCredentials=true;req.onreadystatechange=function(){if(req.readyState===4){if(req.status===200){if(callback){if(verbose_mode){var response;try{response=_.JSONDecode(req.responseText)}catch(e){lib.report_error(e);if(options.ignore_json_errors){response=req.responseText}else{return}}callback(response)}else{callback(Number(req.responseText))}}}else{var error;if(req.timeout&&!req.status&&(new Date).getTime()-start_time>=req.timeout){error="timeout"}else{error="Bad HTTP status: "+req.status+" "+req.statusText}lib.report_error(error);if(callback){if(verbose_mode){callback({status:0,error:error,xhr_req:req})}else{callback(0)}}}}};req.send(body_data)}catch(e){lib.report_error(e);succeeded=false}}else{var script=document$1.createElement("script");script.type="text/javascript";script.async=true;script.defer=true;script.src=url;var s=document$1.getElementsByTagName("script")[0];s.parentNode.insertBefore(script,s)}return succeeded};MixpanelLib.prototype._execute_array=function(array){var fn_name,alias_calls=[],other_calls=[],tracking_calls=[];_.each(array,function(item){if(item){fn_name=item[0];if(_.isArray(fn_name)){tracking_calls.push(item)}else if(typeof item==="function"){item.call(this)}else if(_.isArray(item)&&fn_name==="alias"){alias_calls.push(item)}else if(_.isArray(item)&&fn_name.indexOf("track")!==-1&&typeof this[fn_name]==="function"){tracking_calls.push(item)}else{other_calls.push(item)}}},this);var execute=function execute(calls,context){_.each(calls,function(item){if(_.isArray(item[0])){var caller=context;_.each(item,function(call){caller=caller[call[0]].apply(caller,call.slice(1))})}else{this[item[0]].apply(this,item.slice(1))}},context)};execute(alias_calls,this);execute(other_calls,this);execute(tracking_calls,this)};MixpanelLib.prototype.are_batchers_initialized=function(){return!!this.request_batchers.events};MixpanelLib.prototype.init_batchers=function(){var token=this.get_config("token");if(!this.are_batchers_initialized()){var batcher_for=_.bind(function(attrs){return new RequestBatcher("__mpq_"+token+attrs.queue_suffix,{libConfig:this["config"],sendRequestFunc:_.bind(function(data,options,cb){this._send_request(this.get_config("api_host")+attrs.endpoint,this._encode_data_for_request(data),options,this._prepare_callback(cb,data))},this),beforeSendHook:_.bind(function(item){return this._run_hook("before_send_"+attrs.type,item)},this),errorReporter:this.get_config("error_reporter"),stopAllBatchingFunc:_.bind(this.stop_batch_senders,this)})},this);this.request_batchers={events:batcher_for({type:"events",endpoint:"/track/",queue_suffix:"_ev"}),people:batcher_for({type:"people",endpoint:"/engage/",queue_suffix:"_pp"}),groups:batcher_for({type:"groups",endpoint:"/groups/",queue_suffix:"_gr"})}}if(this.get_config("batch_autostart")){this.start_batch_senders()}};MixpanelLib.prototype.start_batch_senders=function(){if(this.are_batchers_initialized()){this._batch_requests=true;_.each(this.request_batchers,function(batcher){batcher.start()})}};MixpanelLib.prototype.stop_batch_senders=function(){this._batch_requests=false;_.each(this.request_batchers,function(batcher){batcher.stop();batcher.clear()})};MixpanelLib.prototype.push=function(item){this._execute_array([item])};MixpanelLib.prototype.disable=function(events){if(typeof events==="undefined"){this._flags.disable_all_events=true}else{this.__disabled_events=this.__disabled_events.concat(events)}};MixpanelLib.prototype._encode_data_for_request=function(data){var encoded_data=_.JSONEncode(data);if(this.get_config("api_payload_format")===PAYLOAD_TYPE_BASE64){encoded_data=_.base64Encode(encoded_data)}return{data:encoded_data}};MixpanelLib.prototype._track_or_batch=function(options,callback){var truncated_data=_.truncate(options.data,255);var endpoint=options.endpoint;var batcher=options.batcher;var should_send_immediately=options.should_send_immediately;var send_request_options=options.send_request_options||{};callback=callback||NOOP_FUNC;var request_enqueued_or_initiated=true;var send_request_immediately=_.bind(function(){if(!send_request_options.skip_hooks){truncated_data=this._run_hook("before_send_"+options.type,truncated_data)}if(truncated_data){console.log("MIXPANEL REQUEST:");console.log(truncated_data);return this._send_request(endpoint,this._encode_data_for_request(truncated_data),send_request_options,this._prepare_callback(callback,truncated_data))}else{return null}},this);if(this._batch_requests&&!should_send_immediately){batcher.enqueue(truncated_data,function(succeeded){if(succeeded){callback(1,truncated_data)}else{send_request_immediately()}})}else{request_enqueued_or_initiated=send_request_immediately()}return request_enqueued_or_initiated&&truncated_data};MixpanelLib.prototype.track=addOptOutCheckMixpanelLib(function(event_name,properties,options,callback){if(!callback&&typeof options==="function"){callback=options;options=null}options=options||{};var transport=options["transport"];if(transport){options.transport=transport}var should_send_immediately=options["send_immediately"];if(typeof callback!=="function"){callback=NOOP_FUNC}if(_.isUndefined(event_name)){this.report_error("No event name provided to mixpanel.track");return}if(this._event_is_disabled(event_name)){callback(0);return}properties=properties||{};properties["token"]=this.get_config("token");var start_timestamp=this["persistence"].remove_event_timer(event_name);if(!_.isUndefined(start_timestamp)){var duration_in_ms=(new Date).getTime()-start_timestamp;properties["$duration"]=parseFloat((duration_in_ms/1e3).toFixed(3))}this._set_default_superprops();var marketing_properties=this.get_config("track_marketing")?_.info.marketingParams():{};properties=_.extend({},_.info.properties(),marketing_properties,this["persistence"].properties(),this.unpersisted_superprops,properties);var property_blacklist=this.get_config("property_blacklist");if(_.isArray(property_blacklist)){_.each(property_blacklist,function(blacklisted_prop){delete properties[blacklisted_prop]})}else{this.report_error("Invalid value for property_blacklist config: "+property_blacklist)}var data={event:event_name,properties:properties};var ret=this._track_or_batch({type:"events",data:data,endpoint:this.get_config("api_host")+"/track/",batcher:this.request_batchers.events,should_send_immediately:should_send_immediately,send_request_options:options},callback);return ret});MixpanelLib.prototype.set_group=addOptOutCheckMixpanelLib(function(group_key,group_ids,callback){if(!_.isArray(group_ids)){group_ids=[group_ids]}var prop={};prop[group_key]=group_ids;this.register(prop);return this["people"].set(group_key,group_ids,callback)});MixpanelLib.prototype.add_group=addOptOutCheckMixpanelLib(function(group_key,group_id,callback){var old_values=this.get_property(group_key);if(old_values===undefined){var prop={};prop[group_key]=[group_id];this.register(prop)}else{if(old_values.indexOf(group_id)===-1){old_values.push(group_id);this.register(prop)}}return this["people"].union(group_key,group_id,callback)});MixpanelLib.prototype.remove_group=addOptOutCheckMixpanelLib(function(group_key,group_id,callback){var old_value=this.get_property(group_key);if(old_value!==undefined){var idx=old_value.indexOf(group_id);if(idx>-1){old_value.splice(idx,1);this.register({group_key:old_value})}if(old_value.length===0){this.unregister(group_key)}}return this["people"].remove(group_key,group_id,callback)});MixpanelLib.prototype.track_with_groups=addOptOutCheckMixpanelLib(function(event_name,properties,groups,callback){var tracking_props=_.extend({},properties||{});_.each(groups,function(v,k){if(v!==null&&v!==undefined){tracking_props[k]=v}});return this.track(event_name,tracking_props,callback)});MixpanelLib.prototype._create_map_key=function(group_key,group_id){return group_key+"_"+JSON.stringify(group_id)};MixpanelLib.prototype._remove_group_from_cache=function(group_key,group_id){delete this._cached_groups[this._create_map_key(group_key,group_id)]};MixpanelLib.prototype.get_group=function(group_key,group_id){var map_key=this._create_map_key(group_key,group_id);var group=this._cached_groups[map_key];if(group===undefined||group._group_key!==group_key||group._group_id!==group_id){group=new MixpanelGroup;group._init(this,group_key,group_id);this._cached_groups[map_key]=group}return group};MixpanelLib.prototype.track_pageview=addOptOutCheckMixpanelLib(function(properties,options){if(_typeof(properties)!=="object"){properties={}}options=options||{};var event_name=options["event_name"]||"$mp_web_page_view";var default_page_properties=_.extend(_.info.mpPageViewProperties(),_.info.campaignParams(),_.info.clickParams());var event_properties=_.extend({},default_page_properties,properties);return this.track(event_name,event_properties)});MixpanelLib.prototype.track_links=function(){return this._track_dom.call(this,LinkTracker,arguments)};MixpanelLib.prototype.track_forms=function(){return this._track_dom.call(this,FormTracker,arguments)};MixpanelLib.prototype.time_event=function(event_name){if(_.isUndefined(event_name)){this.report_error("No event name provided to mixpanel.time_event");return}if(this._event_is_disabled(event_name)){return}this["persistence"].set_event_timer(event_name,(new Date).getTime())};var REGISTER_DEFAULTS={persistent:true};var options_for_register=function options_for_register(days_or_options){var options;if(_.isObject(days_or_options)){options=days_or_options}else if(!_.isUndefined(days_or_options)){options={days:days_or_options}}else{options={}}return _.extend({},REGISTER_DEFAULTS,options)};MixpanelLib.prototype.register=function(props,days_or_options){var options=options_for_register(days_or_options);if(options["persistent"]){this["persistence"].register(props,options["days"])}else{_.extend(this.unpersisted_superprops,props)}};MixpanelLib.prototype.register_once=function(props,default_value,days_or_options){var options=options_for_register(days_or_options);if(options["persistent"]){this["persistence"].register_once(props,default_value,options["days"])}else{if(typeof default_value==="undefined"){default_value="None"}_.each(props,function(val,prop){if(!this.unpersisted_superprops.hasOwnProperty(prop)||this.unpersisted_superprops[prop]===default_value){this.unpersisted_superprops[prop]=val}},this)}};MixpanelLib.prototype.unregister=function(property,options){options=options_for_register(options);if(options["persistent"]){this["persistence"].unregister(property)}else{delete this.unpersisted_superprops[property]}};MixpanelLib.prototype._register_single=function(prop,value){var props={};props[prop]=value;this.register(props)};MixpanelLib.prototype.identify=function(new_distinct_id,_set_callback,_add_callback,_append_callback,_set_once_callback,_union_callback,_unset_callback,_remove_callback){var previous_distinct_id=this.get_distinct_id();if(new_distinct_id&&previous_distinct_id!==new_distinct_id){if(typeof new_distinct_id==="string"&&new_distinct_id.indexOf(DEVICE_ID_PREFIX)===0){this.report_error("distinct_id cannot have $device: prefix");return-1}this.register({$user_id:new_distinct_id})}if(!this.get_property("$device_id")){var device_id=previous_distinct_id;this.register_once({$had_persisted_distinct_id:true,$device_id:device_id},"")}if(new_distinct_id!==previous_distinct_id&&new_distinct_id!==this.get_property(ALIAS_ID_KEY)){this.unregister(ALIAS_ID_KEY);this.register({distinct_id:new_distinct_id})}this._flags.identify_called=true;this["people"]._flush(_set_callback,_add_callback,_append_callback,_set_once_callback,_union_callback,_unset_callback,_remove_callback);if(new_distinct_id!==previous_distinct_id){this.track("$identify",{distinct_id:new_distinct_id,$anon_distinct_id:previous_distinct_id},{skip_hooks:true})}};MixpanelLib.prototype.reset=function(){this["persistence"].clear();this._flags.identify_called=false;var uuid=_.UUID();this.register_once({distinct_id:DEVICE_ID_PREFIX+uuid,$device_id:uuid},"")};MixpanelLib.prototype.get_distinct_id=function(){return this.get_property("distinct_id")};MixpanelLib.prototype.alias=function(alias,original){if(alias===this.get_property(PEOPLE_DISTINCT_ID_KEY)){this.report_error("Attempting to create alias for existing People user - aborting.");return-2}var _this=this;if(_.isUndefined(original)){original=this.get_distinct_id()}if(alias!==original){this._register_single(ALIAS_ID_KEY,alias);return this.track("$create_alias",{alias:alias,distinct_id:original},{skip_hooks:true},function(){_this.identify(alias)})}else{this.report_error("alias matches current distinct_id - skipping api call.");this.identify(alias);return-1}};MixpanelLib.prototype.name_tag=function(name_tag){this._register_single("mp_name_tag",name_tag)};MixpanelLib.prototype.set_config=function(config){if(_.isObject(config)){_.extend(this["config"],config);var new_batch_size=config["batch_size"];if(new_batch_size){_.each(this.request_batchers,function(batcher){batcher.resetBatchSize()})}if(!this.get_config("persistence_name")){this["config"]["persistence_name"]=this["config"]["cookie_name"]}if(!this.get_config("disable_persistence")){this["config"]["disable_persistence"]=this["config"]["disable_cookie"]}if(this["persistence"]){this["persistence"].update_config(this["config"])}Config.DEBUG=Config.DEBUG||this.get_config("debug")}};MixpanelLib.prototype.get_config=function(prop_name){return this["config"][prop_name]};MixpanelLib.prototype._run_hook=function(hook_name){var ret=(this["config"]["hooks"][hook_name]||IDENTITY_FUNC).apply(this,slice.call(arguments,1));if(typeof ret==="undefined"){this.report_error(hook_name+" hook did not return a value");ret=null}return ret};MixpanelLib.prototype.get_property=function(property_name){return this["persistence"]["props"][property_name]};MixpanelLib.prototype.toString=function(){var name=this.get_config("name");if(name!==PRIMARY_INSTANCE_NAME){name=PRIMARY_INSTANCE_NAME+"."+name}return name};MixpanelLib.prototype._event_is_disabled=function(event_name){return _.isBlockedUA(userAgent)||this._flags.disable_all_events||_.include(this.__disabled_events,event_name)};MixpanelLib.prototype._gdpr_init=function(){var is_localStorage_requested=this.get_config("opt_out_tracking_persistence_type")==="localStorage";if(is_localStorage_requested&&_.localStorage.is_supported()){if(!this.has_opted_in_tracking()&&this.has_opted_in_tracking({persistence_type:"cookie"})){this.opt_in_tracking({enable_persistence:false})}if(!this.has_opted_out_tracking()&&this.has_opted_out_tracking({persistence_type:"cookie"})){this.opt_out_tracking({clear_persistence:false})}this.clear_opt_in_out_tracking({persistence_type:"cookie",enable_persistence:false})}if(this.has_opted_out_tracking()){this._gdpr_update_persistence({clear_persistence:true})}else if(!this.has_opted_in_tracking()&&(this.get_config("opt_out_tracking_by_default")||_.cookie.get("mp_optout"))){_.cookie.remove("mp_optout");this.opt_out_tracking({clear_persistence:this.get_config("opt_out_persistence_by_default")})}};MixpanelLib.prototype._gdpr_update_persistence=function(options){var disabled;if(options&&options["clear_persistence"]){disabled=true}else if(options&&options["enable_persistence"]){disabled=false}else{return}if(!this.get_config("disable_persistence")&&this["persistence"].disabled!==disabled){this["persistence"].set_disabled(disabled)}if(disabled){_.each(this.request_batchers,function(batcher){batcher.clear()})}};MixpanelLib.prototype._gdpr_call_func=function(func,options){options=_.extend({track:_.bind(this.track,this),persistence_type:this.get_config("opt_out_tracking_persistence_type"),cookie_prefix:this.get_config("opt_out_tracking_cookie_prefix"),cookie_expiration:this.get_config("cookie_expiration"),cross_site_cookie:this.get_config("cross_site_cookie"),cross_subdomain_cookie:this.get_config("cross_subdomain_cookie"),cookie_domain:this.get_config("cookie_domain"),secure_cookie:this.get_config("secure_cookie"),ignore_dnt:this.get_config("ignore_dnt")},options);if(!_.localStorage.is_supported()){options["persistence_type"]="cookie"}return func(this.get_config("token"),{track:options["track"],trackEventName:options["track_event_name"],trackProperties:options["track_properties"],persistenceType:options["persistence_type"],persistencePrefix:options["cookie_prefix"],cookieDomain:options["cookie_domain"],cookieExpiration:options["cookie_expiration"],crossSiteCookie:options["cross_site_cookie"],crossSubdomainCookie:options["cross_subdomain_cookie"],secureCookie:options["secure_cookie"],ignoreDnt:options["ignore_dnt"]})};MixpanelLib.prototype.opt_in_tracking=function(options){options=_.extend({enable_persistence:true},options);this._gdpr_call_func(optIn,options);this._gdpr_update_persistence(options)};MixpanelLib.prototype.opt_out_tracking=function(options){options=_.extend({clear_persistence:true,delete_user:true},options);if(options["delete_user"]&&this["people"]&&this["people"]._identify_called()){this["people"].delete_user();this["people"].clear_charges()}this._gdpr_call_func(optOut,options);this._gdpr_update_persistence(options)};MixpanelLib.prototype.has_opted_in_tracking=function(options){return this._gdpr_call_func(hasOptedIn,options)};MixpanelLib.prototype.has_opted_out_tracking=function(options){return this._gdpr_call_func(hasOptedOut,options)};MixpanelLib.prototype.clear_opt_in_out_tracking=function(options){options=_.extend({enable_persistence:true},options);this._gdpr_call_func(clearOptInOut,options);this._gdpr_update_persistence(options)};MixpanelLib.prototype.report_error=function(msg,err){console.error.apply(console.error,arguments);try{if(!err&&!(msg instanceof Error)){msg=new Error(msg)}this.get_config("error_reporter")(msg,err)}catch(err){console.error(err)}};MixpanelLib.prototype["init"]=MixpanelLib.prototype.init;MixpanelLib.prototype["reset"]=MixpanelLib.prototype.reset;MixpanelLib.prototype["disable"]=MixpanelLib.prototype.disable;MixpanelLib.prototype["time_event"]=MixpanelLib.prototype.time_event;MixpanelLib.prototype["track"]=MixpanelLib.prototype.track;MixpanelLib.prototype["track_links"]=MixpanelLib.prototype.track_links;MixpanelLib.prototype["track_forms"]=MixpanelLib.prototype.track_forms;MixpanelLib.prototype["track_pageview"]=MixpanelLib.prototype.track_pageview;MixpanelLib.prototype["register"]=MixpanelLib.prototype.register;MixpanelLib.prototype["register_once"]=MixpanelLib.prototype.register_once;MixpanelLib.prototype["unregister"]=MixpanelLib.prototype.unregister;MixpanelLib.prototype["identify"]=MixpanelLib.prototype.identify;MixpanelLib.prototype["alias"]=MixpanelLib.prototype.alias;MixpanelLib.prototype["name_tag"]=MixpanelLib.prototype.name_tag;MixpanelLib.prototype["set_config"]=MixpanelLib.prototype.set_config;MixpanelLib.prototype["get_config"]=MixpanelLib.prototype.get_config;MixpanelLib.prototype["get_property"]=MixpanelLib.prototype.get_property;MixpanelLib.prototype["get_distinct_id"]=MixpanelLib.prototype.get_distinct_id;MixpanelLib.prototype["toString"]=MixpanelLib.prototype.toString;MixpanelLib.prototype["opt_out_tracking"]=MixpanelLib.prototype.opt_out_tracking;MixpanelLib.prototype["opt_in_tracking"]=MixpanelLib.prototype.opt_in_tracking;MixpanelLib.prototype["has_opted_out_tracking"]=MixpanelLib.prototype.has_opted_out_tracking;MixpanelLib.prototype["has_opted_in_tracking"]=MixpanelLib.prototype.has_opted_in_tracking;MixpanelLib.prototype["clear_opt_in_out_tracking"]=MixpanelLib.prototype.clear_opt_in_out_tracking;MixpanelLib.prototype["get_group"]=MixpanelLib.prototype.get_group;MixpanelLib.prototype["set_group"]=MixpanelLib.prototype.set_group;MixpanelLib.prototype["add_group"]=MixpanelLib.prototype.add_group;MixpanelLib.prototype["remove_group"]=MixpanelLib.prototype.remove_group;MixpanelLib.prototype["track_with_groups"]=MixpanelLib.prototype.track_with_groups;MixpanelLib.prototype["start_batch_senders"]=MixpanelLib.prototype.start_batch_senders;MixpanelLib.prototype["stop_batch_senders"]=MixpanelLib.prototype.stop_batch_senders;MixpanelPersistence.prototype["properties"]=MixpanelPersistence.prototype.properties;MixpanelPersistence.prototype["update_search_keyword"]=MixpanelPersistence.prototype.update_search_keyword;MixpanelPersistence.prototype["update_referrer_info"]=MixpanelPersistence.prototype.update_referrer_info;MixpanelPersistence.prototype["get_cross_subdomain"]=MixpanelPersistence.prototype.get_cross_subdomain;MixpanelPersistence.prototype["clear"]=MixpanelPersistence.prototype.clear;var instances={};var extend_mp=function extend_mp(){_.each(instances,function(instance,name){if(name!==PRIMARY_INSTANCE_NAME){mixpanel_master[name]=instance}});mixpanel_master["_"]=_};var override_mp_init_func=function override_mp_init_func(){mixpanel_master["init"]=function(token,config,name){if(name){if(!mixpanel_master[name]){mixpanel_master[name]=instances[name]=create_mplib(token,config,name);mixpanel_master[name]._loaded()}return mixpanel_master[name]}else{var instance=mixpanel_master;if(instances[PRIMARY_INSTANCE_NAME]){instance=instances[PRIMARY_INSTANCE_NAME]}else if(token){instance=create_mplib(token,config,PRIMARY_INSTANCE_NAME);instance._loaded();instances[PRIMARY_INSTANCE_NAME]=instance}mixpanel_master=instance;if(init_type===INIT_SNIPPET){window$1[PRIMARY_INSTANCE_NAME]=mixpanel_master}extend_mp()}}};var add_dom_loaded_handler=function add_dom_loaded_handler(){function dom_loaded_handler(){if(dom_loaded_handler.done){return}dom_loaded_handler.done=true;DOM_LOADED=true;ENQUEUE_REQUESTS=false;_.each(instances,function(inst){inst._dom_loaded()})}function do_scroll_check(){try{document$1.documentElement.doScroll("left")}catch(e){setTimeout(do_scroll_check,1);return}dom_loaded_handler()}if(document$1.addEventListener){if(document$1.readyState==="complete"){dom_loaded_handler()}else{document$1.addEventListener("DOMContentLoaded",dom_loaded_handler,false)}}else if(document$1.attachEvent){document$1.attachEvent("onreadystatechange",dom_loaded_handler);var toplevel=false;try{toplevel=window$1.frameElement===null}catch(e){}if(document$1.documentElement.doScroll&&toplevel){do_scroll_check()}}_.register_event(window$1,"load",dom_loaded_handler,true)};function init_as_module(){init_type=INIT_MODULE;mixpanel_master=new MixpanelLib;override_mp_init_func();mixpanel_master["init"]();add_dom_loaded_handler();return mixpanel_master}var mixpanel=init_as_module();module.exports=mixpanel},{}],16:[function(require,module,exports){(function(global){(function(){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var hasMap=typeof Map==="function"&&Map.prototype;var mapSizeDescriptor=Object.getOwnPropertyDescriptor&&hasMap?Object.getOwnPropertyDescriptor(Map.prototype,"size"):null;var mapSize=hasMap&&mapSizeDescriptor&&typeof mapSizeDescriptor.get==="function"?mapSizeDescriptor.get:null;var mapForEach=hasMap&&Map.prototype.forEach;var hasSet=typeof Set==="function"&&Set.prototype;var setSizeDescriptor=Object.getOwnPropertyDescriptor&&hasSet?Object.getOwnPropertyDescriptor(Set.prototype,"size"):null;var setSize=hasSet&&setSizeDescriptor&&typeof setSizeDescriptor.get==="function"?setSizeDescriptor.get:null;var setForEach=hasSet&&Set.prototype.forEach;var hasWeakMap=typeof WeakMap==="function"&&WeakMap.prototype;var weakMapHas=hasWeakMap?WeakMap.prototype.has:null;var hasWeakSet=typeof WeakSet==="function"&&WeakSet.prototype;var weakSetHas=hasWeakSet?WeakSet.prototype.has:null;var hasWeakRef=typeof WeakRef==="function"&&WeakRef.prototype;var weakRefDeref=hasWeakRef?WeakRef.prototype.deref:null;var booleanValueOf=Boolean.prototype.valueOf;var objectToString=Object.prototype.toString;var functionToString=Function.prototype.toString;var $match=String.prototype.match;var $slice=String.prototype.slice;var $replace=String.prototype.replace;var $toUpperCase=String.prototype.toUpperCase;var $toLowerCase=String.prototype.toLowerCase;var $test=RegExp.prototype.test;var $concat=Array.prototype.concat;var $join=Array.prototype.join;var $arrSlice=Array.prototype.slice;var $floor=Math.floor;var bigIntValueOf=typeof BigInt==="function"?BigInt.prototype.valueOf:null;var gOPS=Object.getOwnPropertySymbols;var symToString=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="symbol"?Symbol.prototype.toString:null;var hasShammedSymbols=typeof Symbol==="function"&&_typeof(Symbol.iterator)==="object";var toStringTag=typeof Symbol==="function"&&Symbol.toStringTag&&(_typeof(Symbol.toStringTag)===hasShammedSymbols?"object":"symbol")?Symbol.toStringTag:null;var isEnumerable=Object.prototype.propertyIsEnumerable;var gPO=(typeof Reflect==="function"?Reflect.getPrototypeOf:Object.getPrototypeOf)||([].__proto__===Array.prototype?function(O){return O.__proto__}:null);function addNumericSeparator(num,str){if(num===Infinity||num===-Infinity||num!==num||num&&num>-1e3&&num<1e3||$test.call(/e/,str)){return str}var sepRegex=/[0-9](?=(?:[0-9]{3})+(?![0-9]))/g;if(typeof num==="number"){var _int=num<0?-$floor(-num):$floor(num);if(_int!==num){var intStr=String(_int);var dec=$slice.call(str,intStr.length+1);return $replace.call(intStr,sepRegex,"$&_")+"."+$replace.call($replace.call(dec,/([0-9]{3})/g,"$&_"),/_$/,"")}}return $replace.call(str,sepRegex,"$&_")}var utilInspect=require("./util.inspect");var inspectCustom=utilInspect.custom;var inspectSymbol=isSymbol(inspectCustom)?inspectCustom:null;module.exports=function inspect_(obj,options,depth,seen){var opts=options||{};if(has(opts,"quoteStyle")&&opts.quoteStyle!=="single"&&opts.quoteStyle!=="double"){throw new TypeError('option "quoteStyle" must be "single" or "double"')}if(has(opts,"maxStringLength")&&(typeof opts.maxStringLength==="number"?opts.maxStringLength<0&&opts.maxStringLength!==Infinity:opts.maxStringLength!==null)){throw new TypeError('option "maxStringLength", if provided, must be a positive integer, Infinity, or `null`')}var customInspect=has(opts,"customInspect")?opts.customInspect:true;if(typeof customInspect!=="boolean"&&customInspect!=="symbol"){throw new TypeError("option \"customInspect\", if provided, must be `true`, `false`, or `'symbol'`")}if(has(opts,"indent")&&opts.indent!==null&&opts.indent!=="\t"&&!(parseInt(opts.indent,10)===opts.indent&&opts.indent>0)){throw new TypeError('option "indent" must be "\\t", an integer > 0, or `null`')}if(has(opts,"numericSeparator")&&typeof opts.numericSeparator!=="boolean"){throw new TypeError('option "numericSeparator", if provided, must be `true` or `false`')}var numericSeparator=opts.numericSeparator;if(typeof obj==="undefined"){return"undefined"}if(obj===null){return"null"}if(typeof obj==="boolean"){return obj?"true":"false"}if(typeof obj==="string"){return inspectString(obj,opts)}if(typeof obj==="number"){if(obj===0){return Infinity/obj>0?"0":"-0"}var str=String(obj);return numericSeparator?addNumericSeparator(obj,str):str}if(typeof obj==="bigint"){var bigIntStr=String(obj)+"n";return numericSeparator?addNumericSeparator(obj,bigIntStr):bigIntStr}var maxDepth=typeof opts.depth==="undefined"?5:opts.depth;if(typeof depth==="undefined"){depth=0}if(depth>=maxDepth&&maxDepth>0&&_typeof(obj)==="object"){return isArray(obj)?"[Array]":"[Object]"}var indent=getIndent(opts,depth);if(typeof seen==="undefined"){seen=[]}else if(indexOf(seen,obj)>=0){return"[Circular]"}function inspect(value,from,noIndent){if(from){seen=$arrSlice.call(seen);seen.push(from)}if(noIndent){var newOpts={depth:opts.depth};if(has(opts,"quoteStyle")){newOpts.quoteStyle=opts.quoteStyle}return inspect_(value,newOpts,depth+1,seen)}return inspect_(value,opts,depth+1,seen)}if(typeof obj==="function"&&!isRegExp(obj)){var name=nameOf(obj);var keys=arrObjKeys(obj,inspect);return"[Function"+(name?": "+name:" (anonymous)")+"]"+(keys.length>0?" { "+$join.call(keys,", ")+" }":"")}if(isSymbol(obj)){var symString=hasShammedSymbols?$replace.call(String(obj),/^(Symbol\(.*\))_[^)]*$/,"$1"):symToString.call(obj);return _typeof(obj)==="object"&&!hasShammedSymbols?markBoxed(symString):symString}if(isElement(obj)){var s="<"+$toLowerCase.call(String(obj.nodeName));var attrs=obj.attributes||[];for(var i=0;i<attrs.length;i++){s+=" "+attrs[i].name+"="+wrapQuotes(quote(attrs[i].value),"double",opts)}s+=">";if(obj.childNodes&&obj.childNodes.length){s+="..."}s+="</"+$toLowerCase.call(String(obj.nodeName))+">";return s}if(isArray(obj)){if(obj.length===0){return"[]"}var xs=arrObjKeys(obj,inspect);if(indent&&!singleLineValues(xs)){return"["+indentedJoin(xs,indent)+"]"}return"[ "+$join.call(xs,", ")+" ]"}if(isError(obj)){var parts=arrObjKeys(obj,inspect);if(!("cause"in Error.prototype)&&"cause"in obj&&!isEnumerable.call(obj,"cause")){return"{ ["+String(obj)+"] "+$join.call($concat.call("[cause]: "+inspect(obj.cause),parts),", ")+" }"}if(parts.length===0){return"["+String(obj)+"]"}return"{ ["+String(obj)+"] "+$join.call(parts,", ")+" }"}if(_typeof(obj)==="object"&&customInspect){if(inspectSymbol&&typeof obj[inspectSymbol]==="function"&&utilInspect){return utilInspect(obj,{depth:maxDepth-depth})}else if(customInspect!=="symbol"&&typeof obj.inspect==="function"){return obj.inspect()}}if(isMap(obj)){var mapParts=[];if(mapForEach){mapForEach.call(obj,function(value,key){mapParts.push(inspect(key,obj,true)+" => "+inspect(value,obj))})}return collectionOf("Map",mapSize.call(obj),mapParts,indent)}if(isSet(obj)){var setParts=[];if(setForEach){setForEach.call(obj,function(value){setParts.push(inspect(value,obj))})}return collectionOf("Set",setSize.call(obj),setParts,indent)}if(isWeakMap(obj)){return weakCollectionOf("WeakMap")}if(isWeakSet(obj)){return weakCollectionOf("WeakSet")}if(isWeakRef(obj)){return weakCollectionOf("WeakRef")}if(isNumber(obj)){return markBoxed(inspect(Number(obj)))}if(isBigInt(obj)){return markBoxed(inspect(bigIntValueOf.call(obj)))}if(isBoolean(obj)){return markBoxed(booleanValueOf.call(obj))}if(isString(obj)){return markBoxed(inspect(String(obj)))}if(obj===global){if(typeof window!=="undefined"){return"{ [object Window] }"}return"{ [object global] }"}if(!isDate(obj)&&!isRegExp(obj)){var ys=arrObjKeys(obj,inspect);var isPlainObject=gPO?gPO(obj)===Object.prototype:obj instanceof Object||obj.constructor===Object;var protoTag=obj instanceof Object?"":"null prototype";var stringTag=!isPlainObject&&toStringTag&&Object(obj)===obj&&toStringTag in obj?$slice.call(toStr(obj),8,-1):protoTag?"Object":"";var constructorTag=isPlainObject||typeof obj.constructor!=="function"?"":obj.constructor.name?obj.constructor.name+" ":"";var tag=constructorTag+(stringTag||protoTag?"["+$join.call($concat.call([],stringTag||[],protoTag||[]),": ")+"] ":"");if(ys.length===0){return tag+"{}"}if(indent){return tag+"{"+indentedJoin(ys,indent)+"}"}return tag+"{ "+$join.call(ys,", ")+" }"}return String(obj)};function wrapQuotes(s,defaultStyle,opts){var quoteChar=(opts.quoteStyle||defaultStyle)==="double"?'"':"'";return quoteChar+s+quoteChar}function quote(s){return $replace.call(String(s),/"/g,"&quot;")}function isArray(obj){return toStr(obj)==="[object Array]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isDate(obj){return toStr(obj)==="[object Date]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isRegExp(obj){return toStr(obj)==="[object RegExp]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isError(obj){return toStr(obj)==="[object Error]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isString(obj){return toStr(obj)==="[object String]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isNumber(obj){return toStr(obj)==="[object Number]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isBoolean(obj){return toStr(obj)==="[object Boolean]"&&(!toStringTag||!(_typeof(obj)==="object"&&toStringTag in obj))}function isSymbol(obj){if(hasShammedSymbols){return obj&&_typeof(obj)==="object"&&obj instanceof Symbol}if(_typeof(obj)==="symbol"){return true}if(!obj||_typeof(obj)!=="object"||!symToString){return false}try{symToString.call(obj);return true}catch(e){}return false}function isBigInt(obj){if(!obj||_typeof(obj)!=="object"||!bigIntValueOf){return false}try{bigIntValueOf.call(obj);return true}catch(e){}return false}var hasOwn=Object.prototype.hasOwnProperty||function(key){return key in this};function has(obj,key){return hasOwn.call(obj,key)}function toStr(obj){return objectToString.call(obj)}function nameOf(f){if(f.name){return f.name}var m=$match.call(functionToString.call(f),/^function\s*([\w$]+)/);if(m){return m[1]}return null}function indexOf(xs,x){if(xs.indexOf){return xs.indexOf(x)}for(var i=0,l=xs.length;i<l;i++){if(xs[i]===x){return i}}return-1}function isMap(x){if(!mapSize||!x||_typeof(x)!=="object"){return false}try{mapSize.call(x);try{setSize.call(x)}catch(s){return true}return x instanceof Map}catch(e){}return false}function isWeakMap(x){if(!weakMapHas||!x||_typeof(x)!=="object"){return false}try{weakMapHas.call(x,weakMapHas);try{weakSetHas.call(x,weakSetHas)}catch(s){return true}return x instanceof WeakMap}catch(e){}return false}function isWeakRef(x){if(!weakRefDeref||!x||_typeof(x)!=="object"){return false}try{weakRefDeref.call(x);return true}catch(e){}return false}function isSet(x){if(!setSize||!x||_typeof(x)!=="object"){return false}try{setSize.call(x);try{mapSize.call(x)}catch(m){return true}return x instanceof Set}catch(e){}return false}function isWeakSet(x){if(!weakSetHas||!x||_typeof(x)!=="object"){return false}try{weakSetHas.call(x,weakSetHas);try{weakMapHas.call(x,weakMapHas)}catch(s){return true}return x instanceof WeakSet}catch(e){}return false}function isElement(x){if(!x||_typeof(x)!=="object"){return false}if(typeof HTMLElement!=="undefined"&&x instanceof HTMLElement){return true}return typeof x.nodeName==="string"&&typeof x.getAttribute==="function"}function inspectString(str,opts){if(str.length>opts.maxStringLength){var remaining=str.length-opts.maxStringLength;var trailer="... "+remaining+" more character"+(remaining>1?"s":"");return inspectString($slice.call(str,0,opts.maxStringLength),opts)+trailer}var s=$replace.call($replace.call(str,/(['\\])/g,"\\$1"),/[\x00-\x1f]/g,lowbyte);return wrapQuotes(s,"single",opts)}function lowbyte(c){var n=c.charCodeAt(0);var x={8:"b",9:"t",10:"n",12:"f",13:"r"}[n];if(x){return"\\"+x}return"\\x"+(n<16?"0":"")+$toUpperCase.call(n.toString(16))}function markBoxed(str){return"Object("+str+")"}function weakCollectionOf(type){return type+" { ? }"}function collectionOf(type,size,entries,indent){var joinedEntries=indent?indentedJoin(entries,indent):$join.call(entries,", ");return type+" ("+size+") {"+joinedEntries+"}"}function singleLineValues(xs){for(var i=0;i<xs.length;i++){if(indexOf(xs[i],"\n")>=0){return false}}return true}function getIndent(opts,depth){var baseIndent;if(opts.indent==="\t"){baseIndent="\t"}else if(typeof opts.indent==="number"&&opts.indent>0){baseIndent=$join.call(Array(opts.indent+1)," ")}else{return null}return{base:baseIndent,prev:$join.call(Array(depth+1),baseIndent)}}function indentedJoin(xs,indent){if(xs.length===0){return""}var lineJoiner="\n"+indent.prev+indent.base;return lineJoiner+$join.call(xs,","+lineJoiner)+"\n"+indent.prev}function arrObjKeys(obj,inspect){var isArr=isArray(obj);var xs=[];if(isArr){xs.length=obj.length;for(var i=0;i<obj.length;i++){xs[i]=has(obj,i)?inspect(obj[i],obj):""}}var syms=typeof gOPS==="function"?gOPS(obj):[];var symMap;if(hasShammedSymbols){symMap={};for(var k=0;k<syms.length;k++){symMap["$"+syms[k]]=syms[k]}}for(var key in obj){if(!has(obj,key)){continue}if(isArr&&String(Number(key))===key&&key<obj.length){continue}if(hasShammedSymbols&&symMap["$"+key]instanceof Symbol){continue}else if($test.call(/[^\w$]/,key)){xs.push(inspect(key,obj)+": "+inspect(obj[key],obj))}else{xs.push(key+": "+inspect(obj[key],obj))}}if(typeof gOPS==="function"){for(var j=0;j<syms.length;j++){if(isEnumerable.call(obj,syms[j])){xs.push("["+inspect(syms[j])+"]: "+inspect(obj[syms[j]],obj))}}}return xs}}).call(this)}).call(this,typeof global!=="undefined"?global:typeof self!=="undefined"?self:typeof window!=="undefined"?window:{})},{"./util.inspect":1}],17:[function(require,module,exports){"use strict";var replace=String.prototype.replace;var percentTwenties=/%20/g;var Format={RFC1738:"RFC1738",RFC3986:"RFC3986"};module.exports={default:Format.RFC3986,formatters:{RFC1738:function RFC1738(value){return replace.call(value,percentTwenties,"+")},RFC3986:function RFC3986(value){return String(value)}},RFC1738:Format.RFC1738,RFC3986:Format.RFC3986}},{}],18:[function(require,module,exports){"use strict";var stringify=require("./stringify");var parse=require("./parse");var formats=require("./formats");module.exports={formats:formats,parse:parse,stringify:stringify}},{"./formats":17,"./parse":19,"./stringify":20}],19:[function(require,module,exports){"use strict";var utils=require("./utils");var has=Object.prototype.hasOwnProperty;var isArray=Array.isArray;var defaults={allowDots:false,allowPrototypes:false,allowSparse:false,arrayLimit:20,charset:"utf-8",charsetSentinel:false,comma:false,decoder:utils.decode,delimiter:"&",depth:5,ignoreQueryPrefix:false,interpretNumericEntities:false,parameterLimit:1e3,parseArrays:true,plainObjects:false,strictNullHandling:false};var interpretNumericEntities=function interpretNumericEntities(str){return str.replace(/&#(\d+);/g,function($0,numberStr){return String.fromCharCode(parseInt(numberStr,10))})};var parseArrayValue=function parseArrayValue(val,options){if(val&&typeof val==="string"&&options.comma&&val.indexOf(",")>-1){return val.split(",")}return val};var isoSentinel="utf8=%26%2310003%3B";var charsetSentinel="utf8=%E2%9C%93";var parseValues=function parseQueryStringValues(str,options){var obj={__proto__:null};var cleanStr=options.ignoreQueryPrefix?str.replace(/^\?/,""):str;var limit=options.parameterLimit===Infinity?undefined:options.parameterLimit;var parts=cleanStr.split(options.delimiter,limit);var skipIndex=-1;var i;var charset=options.charset;if(options.charsetSentinel){for(i=0;i<parts.length;++i){if(parts[i].indexOf("utf8=")===0){if(parts[i]===charsetSentinel){charset="utf-8"}else if(parts[i]===isoSentinel){charset="iso-8859-1"}skipIndex=i;i=parts.length}}}for(i=0;i<parts.length;++i){if(i===skipIndex){continue}var part=parts[i];var bracketEqualsPos=part.indexOf("]=");var pos=bracketEqualsPos===-1?part.indexOf("="):bracketEqualsPos+1;var key,val;if(pos===-1){key=options.decoder(part,defaults.decoder,charset,"key");val=options.strictNullHandling?null:""}else{key=options.decoder(part.slice(0,pos),defaults.decoder,charset,"key");val=utils.maybeMap(parseArrayValue(part.slice(pos+1),options),function(encodedVal){return options.decoder(encodedVal,defaults.decoder,charset,"value")})}if(val&&options.interpretNumericEntities&&charset==="iso-8859-1"){val=interpretNumericEntities(val)}if(part.indexOf("[]=")>-1){val=isArray(val)?[val]:val}if(has.call(obj,key)){obj[key]=utils.combine(obj[key],val)}else{obj[key]=val}}return obj};var parseObject=function parseObject(chain,val,options,valuesParsed){var leaf=valuesParsed?val:parseArrayValue(val,options);for(var i=chain.length-1;i>=0;--i){var obj;var root=chain[i];if(root==="[]"&&options.parseArrays){obj=[].concat(leaf)}else{obj=options.plainObjects?Object.create(null):{};var cleanRoot=root.charAt(0)==="["&&root.charAt(root.length-1)==="]"?root.slice(1,-1):root;var index=parseInt(cleanRoot,10);if(!options.parseArrays&&cleanRoot===""){obj={0:leaf}}else if(!isNaN(index)&&root!==cleanRoot&&String(index)===cleanRoot&&index>=0&&options.parseArrays&&index<=options.arrayLimit){obj=[];obj[index]=leaf}else if(cleanRoot!=="__proto__"){obj[cleanRoot]=leaf}}leaf=obj}return leaf};var parseKeys=function parseQueryStringKeys(givenKey,val,options,valuesParsed){if(!givenKey){return}var key=options.allowDots?givenKey.replace(/\.([^.[]+)/g,"[$1]"):givenKey;var brackets=/(\[[^[\]]*])/;var child=/(\[[^[\]]*])/g;var segment=options.depth>0&&brackets.exec(key);var parent=segment?key.slice(0,segment.index):key;var keys=[];if(parent){if(!options.plainObjects&&has.call(Object.prototype,parent)){if(!options.allowPrototypes){return}}keys.push(parent)}var i=0;while(options.depth>0&&(segment=child.exec(key))!==null&&i<options.depth){i+=1;if(!options.plainObjects&&has.call(Object.prototype,segment[1].slice(1,-1))){if(!options.allowPrototypes){return}}keys.push(segment[1])}if(segment){keys.push("["+key.slice(segment.index)+"]")}return parseObject(keys,val,options,valuesParsed)};var normalizeParseOptions=function normalizeParseOptions(opts){if(!opts){return defaults}if(opts.decoder!==null&&opts.decoder!==undefined&&typeof opts.decoder!=="function"){throw new TypeError("Decoder has to be a function.")}if(typeof opts.charset!=="undefined"&&opts.charset!=="utf-8"&&opts.charset!=="iso-8859-1"){throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined")}var charset=typeof opts.charset==="undefined"?defaults.charset:opts.charset;return{allowDots:typeof opts.allowDots==="undefined"?defaults.allowDots:!!opts.allowDots,allowPrototypes:typeof opts.allowPrototypes==="boolean"?opts.allowPrototypes:defaults.allowPrototypes,allowSparse:typeof opts.allowSparse==="boolean"?opts.allowSparse:defaults.allowSparse,arrayLimit:typeof opts.arrayLimit==="number"?opts.arrayLimit:defaults.arrayLimit,charset:charset,charsetSentinel:typeof opts.charsetSentinel==="boolean"?opts.charsetSentinel:defaults.charsetSentinel,comma:typeof opts.comma==="boolean"?opts.comma:defaults.comma,decoder:typeof opts.decoder==="function"?opts.decoder:defaults.decoder,delimiter:typeof opts.delimiter==="string"||utils.isRegExp(opts.delimiter)?opts.delimiter:defaults.delimiter,depth:typeof opts.depth==="number"||opts.depth===false?+opts.depth:defaults.depth,ignoreQueryPrefix:opts.ignoreQueryPrefix===true,interpretNumericEntities:typeof opts.interpretNumericEntities==="boolean"?opts.interpretNumericEntities:defaults.interpretNumericEntities,parameterLimit:typeof opts.parameterLimit==="number"?opts.parameterLimit:defaults.parameterLimit,parseArrays:opts.parseArrays!==false,plainObjects:typeof opts.plainObjects==="boolean"?opts.plainObjects:defaults.plainObjects,strictNullHandling:typeof opts.strictNullHandling==="boolean"?opts.strictNullHandling:defaults.strictNullHandling}};module.exports=function(str,opts){var options=normalizeParseOptions(opts);if(str===""||str===null||typeof str==="undefined"){return options.plainObjects?Object.create(null):{}}var tempObj=typeof str==="string"?parseValues(str,options):str;var obj=options.plainObjects?Object.create(null):{};var keys=Object.keys(tempObj);for(var i=0;i<keys.length;++i){var key=keys[i];var newObj=parseKeys(key,tempObj[key],options,typeof str==="string");obj=utils.merge(obj,newObj,options)}if(options.allowSparse===true){return obj}return utils.compact(obj)}},{"./utils":21}],20:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var getSideChannel=require("side-channel");var utils=require("./utils");var formats=require("./formats");var has=Object.prototype.hasOwnProperty;var arrayPrefixGenerators={brackets:function brackets(prefix){return prefix+"[]"},comma:"comma",indices:function indices(prefix,key){return prefix+"["+key+"]"},repeat:function repeat(prefix){return prefix}};var isArray=Array.isArray;var push=Array.prototype.push;var pushToArray=function pushToArray(arr,valueOrArray){push.apply(arr,isArray(valueOrArray)?valueOrArray:[valueOrArray])};var toISO=Date.prototype.toISOString;var defaultFormat=formats["default"];var defaults={addQueryPrefix:false,allowDots:false,charset:"utf-8",charsetSentinel:false,delimiter:"&",encode:true,encoder:utils.encode,encodeValuesOnly:false,format:defaultFormat,formatter:formats.formatters[defaultFormat],indices:false,serializeDate:function serializeDate(date){return toISO.call(date)},skipNulls:false,strictNullHandling:false};var isNonNullishPrimitive=function isNonNullishPrimitive(v){return typeof v==="string"||typeof v==="number"||typeof v==="boolean"||_typeof(v)==="symbol"||typeof v==="bigint"};var sentinel={};var stringify=function stringify(object,prefix,generateArrayPrefix,commaRoundTrip,strictNullHandling,skipNulls,encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,sideChannel){var obj=object;var tmpSc=sideChannel;var step=0;var findFlag=false;while((tmpSc=tmpSc.get(sentinel))!==void undefined&&!findFlag){var pos=tmpSc.get(object);step+=1;if(typeof pos!=="undefined"){if(pos===step){throw new RangeError("Cyclic object value")}else{findFlag=true}}if(typeof tmpSc.get(sentinel)==="undefined"){step=0}}if(typeof filter==="function"){obj=filter(prefix,obj)}else if(obj instanceof Date){obj=serializeDate(obj)}else if(generateArrayPrefix==="comma"&&isArray(obj)){obj=utils.maybeMap(obj,function(value){if(value instanceof Date){return serializeDate(value)}return value})}if(obj===null){if(strictNullHandling){return encoder&&!encodeValuesOnly?encoder(prefix,defaults.encoder,charset,"key",format):prefix}obj=""}if(isNonNullishPrimitive(obj)||utils.isBuffer(obj)){if(encoder){var keyValue=encodeValuesOnly?prefix:encoder(prefix,defaults.encoder,charset,"key",format);return[formatter(keyValue)+"="+formatter(encoder(obj,defaults.encoder,charset,"value",format))]}return[formatter(prefix)+"="+formatter(String(obj))]}var values=[];if(typeof obj==="undefined"){return values}var objKeys;if(generateArrayPrefix==="comma"&&isArray(obj)){if(encodeValuesOnly&&encoder){obj=utils.maybeMap(obj,encoder)}objKeys=[{value:obj.length>0?obj.join(",")||null:void undefined}]}else if(isArray(filter)){objKeys=filter}else{var keys=Object.keys(obj);objKeys=sort?keys.sort(sort):keys}var adjustedPrefix=commaRoundTrip&&isArray(obj)&&obj.length===1?prefix+"[]":prefix;for(var j=0;j<objKeys.length;++j){var key=objKeys[j];var value=_typeof(key)==="object"&&typeof key.value!=="undefined"?key.value:obj[key];if(skipNulls&&value===null){continue}var keyPrefix=isArray(obj)?typeof generateArrayPrefix==="function"?generateArrayPrefix(adjustedPrefix,key):adjustedPrefix:adjustedPrefix+(allowDots?"."+key:"["+key+"]");sideChannel.set(object,step);var valueSideChannel=getSideChannel();valueSideChannel.set(sentinel,sideChannel);pushToArray(values,stringify(value,keyPrefix,generateArrayPrefix,commaRoundTrip,strictNullHandling,skipNulls,generateArrayPrefix==="comma"&&encodeValuesOnly&&isArray(obj)?null:encoder,filter,sort,allowDots,serializeDate,format,formatter,encodeValuesOnly,charset,valueSideChannel))}return values};var normalizeStringifyOptions=function normalizeStringifyOptions(opts){if(!opts){return defaults}if(opts.encoder!==null&&typeof opts.encoder!=="undefined"&&typeof opts.encoder!=="function"){throw new TypeError("Encoder has to be a function.")}var charset=opts.charset||defaults.charset;if(typeof opts.charset!=="undefined"&&opts.charset!=="utf-8"&&opts.charset!=="iso-8859-1"){throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined")}var format=formats["default"];if(typeof opts.format!=="undefined"){if(!has.call(formats.formatters,opts.format)){throw new TypeError("Unknown format option provided.")}format=opts.format}var formatter=formats.formatters[format];var filter=defaults.filter;if(typeof opts.filter==="function"||isArray(opts.filter)){filter=opts.filter}return{addQueryPrefix:typeof opts.addQueryPrefix==="boolean"?opts.addQueryPrefix:defaults.addQueryPrefix,allowDots:typeof opts.allowDots==="undefined"?defaults.allowDots:!!opts.allowDots,charset:charset,charsetSentinel:typeof opts.charsetSentinel==="boolean"?opts.charsetSentinel:defaults.charsetSentinel,delimiter:typeof opts.delimiter==="undefined"?defaults.delimiter:opts.delimiter,encode:typeof opts.encode==="boolean"?opts.encode:defaults.encode,encoder:typeof opts.encoder==="function"?opts.encoder:defaults.encoder,encodeValuesOnly:typeof opts.encodeValuesOnly==="boolean"?opts.encodeValuesOnly:defaults.encodeValuesOnly,filter:filter,format:format,formatter:formatter,serializeDate:typeof opts.serializeDate==="function"?opts.serializeDate:defaults.serializeDate,skipNulls:typeof opts.skipNulls==="boolean"?opts.skipNulls:defaults.skipNulls,sort:typeof opts.sort==="function"?opts.sort:null,strictNullHandling:typeof opts.strictNullHandling==="boolean"?opts.strictNullHandling:defaults.strictNullHandling}};module.exports=function(object,opts){var obj=object;var options=normalizeStringifyOptions(opts);var objKeys;var filter;if(typeof options.filter==="function"){filter=options.filter;obj=filter("",obj)}else if(isArray(options.filter)){filter=options.filter;objKeys=filter}var keys=[];if(_typeof(obj)!=="object"||obj===null){return""}var arrayFormat;if(opts&&opts.arrayFormat in arrayPrefixGenerators){arrayFormat=opts.arrayFormat}else if(opts&&"indices"in opts){arrayFormat=opts.indices?"indices":"repeat"}else{arrayFormat="indices"}var generateArrayPrefix=arrayPrefixGenerators[arrayFormat];if(opts&&"commaRoundTrip"in opts&&typeof opts.commaRoundTrip!=="boolean"){throw new TypeError("`commaRoundTrip` must be a boolean, or absent")}var commaRoundTrip=generateArrayPrefix==="comma"&&opts&&opts.commaRoundTrip;if(!objKeys){objKeys=Object.keys(obj)}if(options.sort){objKeys.sort(options.sort)}var sideChannel=getSideChannel();for(var i=0;i<objKeys.length;++i){var key=objKeys[i];if(options.skipNulls&&obj[key]===null){continue}pushToArray(keys,stringify(obj[key],key,generateArrayPrefix,commaRoundTrip,options.strictNullHandling,options.skipNulls,options.encode?options.encoder:null,options.filter,options.sort,options.allowDots,options.serializeDate,options.format,options.formatter,options.encodeValuesOnly,options.charset,sideChannel))}var joined=keys.join(options.delimiter);var prefix=options.addQueryPrefix===true?"?":"";if(options.charsetSentinel){if(options.charset==="iso-8859-1"){prefix+="utf8=%26%2310003%3B&"}else{prefix+="utf8=%E2%9C%93&"}}return joined.length>0?prefix+joined:""}},{"./formats":17,"./utils":21,"side-channel":22}],21:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var formats=require("./formats");var has=Object.prototype.hasOwnProperty;var isArray=Array.isArray;var hexTable=function(){var array=[];for(var i=0;i<256;++i){array.push("%"+((i<16?"0":"")+i.toString(16)).toUpperCase())}return array}();var compactQueue=function compactQueue(queue){while(queue.length>1){var item=queue.pop();var obj=item.obj[item.prop];if(isArray(obj)){var compacted=[];for(var j=0;j<obj.length;++j){if(typeof obj[j]!=="undefined"){compacted.push(obj[j])}}item.obj[item.prop]=compacted}}};var arrayToObject=function arrayToObject(source,options){var obj=options&&options.plainObjects?Object.create(null):{};for(var i=0;i<source.length;++i){if(typeof source[i]!=="undefined"){obj[i]=source[i]}}return obj};var merge=function merge(target,source,options){if(!source){return target}if(_typeof(source)!=="object"){if(isArray(target)){target.push(source)}else if(target&&_typeof(target)==="object"){if(options&&(options.plainObjects||options.allowPrototypes)||!has.call(Object.prototype,source)){target[source]=true}}else{return[target,source]}return target}if(!target||_typeof(target)!=="object"){return[target].concat(source)}var mergeTarget=target;if(isArray(target)&&!isArray(source)){mergeTarget=arrayToObject(target,options)}if(isArray(target)&&isArray(source)){source.forEach(function(item,i){if(has.call(target,i)){var targetItem=target[i];if(targetItem&&_typeof(targetItem)==="object"&&item&&_typeof(item)==="object"){target[i]=merge(targetItem,item,options)}else{target.push(item)}}else{target[i]=item}});return target}return Object.keys(source).reduce(function(acc,key){var value=source[key];if(has.call(acc,key)){acc[key]=merge(acc[key],value,options)}else{acc[key]=value}return acc},mergeTarget)};var assign=function assignSingleSource(target,source){return Object.keys(source).reduce(function(acc,key){acc[key]=source[key];return acc},target)};var decode=function decode(str,decoder,charset){var strWithoutPlus=str.replace(/\+/g," ");if(charset==="iso-8859-1"){return strWithoutPlus.replace(/%[0-9a-f]{2}/gi,unescape)}try{return decodeURIComponent(strWithoutPlus)}catch(e){return strWithoutPlus}};var encode=function encode(str,defaultEncoder,charset,kind,format){if(str.length===0){return str}var string=str;if(_typeof(str)==="symbol"){string=Symbol.prototype.toString.call(str)}else if(typeof str!=="string"){string=String(str)}if(charset==="iso-8859-1"){return escape(string).replace(/%u[0-9a-f]{4}/gi,function($0){return"%26%23"+parseInt($0.slice(2),16)+"%3B"})}var out="";for(var i=0;i<string.length;++i){var c=string.charCodeAt(i);if(c===45||c===46||c===95||c===126||c>=48&&c<=57||c>=65&&c<=90||c>=97&&c<=122||format===formats.RFC1738&&(c===40||c===41)){out+=string.charAt(i);continue}if(c<128){out=out+hexTable[c];continue}if(c<2048){out=out+(hexTable[192|c>>6]+hexTable[128|c&63]);continue}if(c<55296||c>=57344){out=out+(hexTable[224|c>>12]+hexTable[128|c>>6&63]+hexTable[128|c&63]);continue}i+=1;c=65536+((c&1023)<<10|string.charCodeAt(i)&1023);out+=hexTable[240|c>>18]+hexTable[128|c>>12&63]+hexTable[128|c>>6&63]+hexTable[128|c&63]}return out};var compact=function compact(value){var queue=[{obj:{o:value},prop:"o"}];var refs=[];for(var i=0;i<queue.length;++i){var item=queue[i];var obj=item.obj[item.prop];var keys=Object.keys(obj);for(var j=0;j<keys.length;++j){var key=keys[j];var val=obj[key];if(_typeof(val)==="object"&&val!==null&&refs.indexOf(val)===-1){queue.push({obj:obj,prop:key});refs.push(val)}}}compactQueue(queue);return value};var isRegExp=function isRegExp(obj){return Object.prototype.toString.call(obj)==="[object RegExp]"};var isBuffer=function isBuffer(obj){if(!obj||_typeof(obj)!=="object"){return false}return!!(obj.constructor&&obj.constructor.isBuffer&&obj.constructor.isBuffer(obj))};var combine=function combine(a,b){return[].concat(a,b)};var maybeMap=function maybeMap(val,fn){if(isArray(val)){var mapped=[];for(var i=0;i<val.length;i+=1){mapped.push(fn(val[i]))}return mapped}return fn(val)};module.exports={arrayToObject:arrayToObject,assign:assign,combine:combine,compact:compact,decode:decode,encode:encode,isBuffer:isBuffer,isRegExp:isRegExp,maybeMap:maybeMap,merge:merge}},{"./formats":17}],22:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}var GetIntrinsic=require("get-intrinsic");var callBound=require("call-bind/callBound");var inspect=require("object-inspect");var $TypeError=GetIntrinsic("%TypeError%");var $WeakMap=GetIntrinsic("%WeakMap%",true);var $Map=GetIntrinsic("%Map%",true);var $weakMapGet=callBound("WeakMap.prototype.get",true);var $weakMapSet=callBound("WeakMap.prototype.set",true);var $weakMapHas=callBound("WeakMap.prototype.has",true);var $mapGet=callBound("Map.prototype.get",true);var $mapSet=callBound("Map.prototype.set",true);var $mapHas=callBound("Map.prototype.has",true);var listGetNode=function listGetNode(list,key){for(var prev=list,curr;(curr=prev.next)!==null;prev=curr){if(curr.key===key){prev.next=curr.next;curr.next=list.next;list.next=curr;return curr}}};var listGet=function listGet(objects,key){var node=listGetNode(objects,key);return node&&node.value};var listSet=function listSet(objects,key,value){var node=listGetNode(objects,key);if(node){node.value=value}else{objects.next={key:key,next:objects.next,value:value}}};var listHas=function listHas(objects,key){return!!listGetNode(objects,key)};module.exports=function getSideChannel(){var $wm;var $m;var $o;var channel={assert:function assert(key){if(!channel.has(key)){throw new $TypeError("Side channel does not contain "+inspect(key))}},get:function get(key){if($WeakMap&&key&&(_typeof(key)==="object"||typeof key==="function")){if($wm){return $weakMapGet($wm,key)}}else if($Map){if($m){return $mapGet($m,key)}}else{if($o){return listGet($o,key)}}},has:function has(key){if($WeakMap&&key&&(_typeof(key)==="object"||typeof key==="function")){if($wm){return $weakMapHas($wm,key)}}else if($Map){if($m){return $mapHas($m,key)}}else{if($o){return listHas($o,key)}}return false},set:function set(key,value){if($WeakMap&&key&&(_typeof(key)==="object"||typeof key==="function")){if(!$wm){$wm=new $WeakMap}$weakMapSet($wm,key,value)}else if($Map){if(!$m){$m=new $Map}$mapSet($m,key,value)}else{if(!$o){$o={key:{},next:null}}listSet($o,key,value)}}};return channel}},{"call-bind/callBound":2,"get-intrinsic":6,"object-inspect":16}],23:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"NIL",{enumerable:true,get:function get(){return _nil["default"]}});Object.defineProperty(exports,"parse",{enumerable:true,get:function get(){return _parse["default"]}});Object.defineProperty(exports,"stringify",{enumerable:true,get:function get(){return _stringify["default"]}});Object.defineProperty(exports,"v1",{enumerable:true,get:function get(){return _v["default"]}});Object.defineProperty(exports,"v3",{enumerable:true,get:function get(){return _v2["default"]}});Object.defineProperty(exports,"v4",{enumerable:true,get:function get(){return _v3["default"]}});Object.defineProperty(exports,"v5",{enumerable:true,get:function get(){return _v4["default"]}});Object.defineProperty(exports,"validate",{enumerable:true,get:function get(){return _validate["default"]}});Object.defineProperty(exports,"version",{enumerable:true,get:function get(){return _version["default"]}});var _v=_interopRequireDefault(require("./v1.js"));var _v2=_interopRequireDefault(require("./v3.js"));var _v3=_interopRequireDefault(require("./v4.js"));var _v4=_interopRequireDefault(require("./v5.js"));var _nil=_interopRequireDefault(require("./nil.js"));var _version=_interopRequireDefault(require("./version.js"));var _validate=_interopRequireDefault(require("./validate.js"));var _stringify=_interopRequireDefault(require("./stringify.js"));var _parse=_interopRequireDefault(require("./parse.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}},{"./nil.js":26,"./parse.js":27,"./stringify.js":31,"./v1.js":32,"./v3.js":33,"./v4.js":35,"./v5.js":36,"./validate.js":37,"./version.js":38}],24:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;function md5(bytes){if(typeof bytes==="string"){var msg=unescape(encodeURIComponent(bytes));bytes=new Uint8Array(msg.length);for(var i=0;i<msg.length;++i){bytes[i]=msg.charCodeAt(i)}}return md5ToHexEncodedArray(wordsToMd5(bytesToWords(bytes),bytes.length*8))}function md5ToHexEncodedArray(input){var output=[];var length32=input.length*32;var hexTab="0123456789abcdef";for(var i=0;i<length32;i+=8){var x=input[i>>5]>>>i%32&255;var hex=parseInt(hexTab.charAt(x>>>4&15)+hexTab.charAt(x&15),16);output.push(hex)}return output}function getOutputLength(inputLength8){return(inputLength8+64>>>9<<4)+14+1}function wordsToMd5(x,len){x[len>>5]|=128<<len%32;x[getOutputLength(len)-1]=len;var a=1732584193;var b=-271733879;var c=-1732584194;var d=271733878;for(var i=0;i<x.length;i+=16){var olda=a;var oldb=b;var oldc=c;var oldd=d;a=md5ff(a,b,c,d,x[i],7,-680876936);d=md5ff(d,a,b,c,x[i+1],12,-389564586);c=md5ff(c,d,a,b,x[i+2],17,606105819);b=md5ff(b,c,d,a,x[i+3],22,-1044525330);a=md5ff(a,b,c,d,x[i+4],7,-176418897);d=md5ff(d,a,b,c,x[i+5],12,1200080426);c=md5ff(c,d,a,b,x[i+6],17,-1473231341);b=md5ff(b,c,d,a,x[i+7],22,-45705983);a=md5ff(a,b,c,d,x[i+8],7,1770035416);d=md5ff(d,a,b,c,x[i+9],12,-1958414417);c=md5ff(c,d,a,b,x[i+10],17,-42063);b=md5ff(b,c,d,a,x[i+11],22,-1990404162);a=md5ff(a,b,c,d,x[i+12],7,1804603682);d=md5ff(d,a,b,c,x[i+13],12,-40341101);c=md5ff(c,d,a,b,x[i+14],17,-1502002290);b=md5ff(b,c,d,a,x[i+15],22,1236535329);a=md5gg(a,b,c,d,x[i+1],5,-165796510);d=md5gg(d,a,b,c,x[i+6],9,-1069501632);c=md5gg(c,d,a,b,x[i+11],14,643717713);b=md5gg(b,c,d,a,x[i],20,-373897302);a=md5gg(a,b,c,d,x[i+5],5,-701558691);d=md5gg(d,a,b,c,x[i+10],9,38016083);c=md5gg(c,d,a,b,x[i+15],14,-660478335);b=md5gg(b,c,d,a,x[i+4],20,-405537848);a=md5gg(a,b,c,d,x[i+9],5,568446438);d=md5gg(d,a,b,c,x[i+14],9,-1019803690);c=md5gg(c,d,a,b,x[i+3],14,-187363961);b=md5gg(b,c,d,a,x[i+8],20,1163531501);a=md5gg(a,b,c,d,x[i+13],5,-1444681467);d=md5gg(d,a,b,c,x[i+2],9,-51403784);c=md5gg(c,d,a,b,x[i+7],14,1735328473);b=md5gg(b,c,d,a,x[i+12],20,-1926607734);a=md5hh(a,b,c,d,x[i+5],4,-378558);d=md5hh(d,a,b,c,x[i+8],11,-2022574463);c=md5hh(c,d,a,b,x[i+11],16,1839030562);b=md5hh(b,c,d,a,x[i+14],23,-35309556);a=md5hh(a,b,c,d,x[i+1],4,-1530992060);d=md5hh(d,a,b,c,x[i+4],11,1272893353);c=md5hh(c,d,a,b,x[i+7],16,-155497632);b=md5hh(b,c,d,a,x[i+10],23,-1094730640);a=md5hh(a,b,c,d,x[i+13],4,681279174);d=md5hh(d,a,b,c,x[i],11,-358537222);c=md5hh(c,d,a,b,x[i+3],16,-722521979);b=md5hh(b,c,d,a,x[i+6],23,76029189);a=md5hh(a,b,c,d,x[i+9],4,-640364487);d=md5hh(d,a,b,c,x[i+12],11,-421815835);c=md5hh(c,d,a,b,x[i+15],16,530742520);b=md5hh(b,c,d,a,x[i+2],23,-995338651);a=md5ii(a,b,c,d,x[i],6,-198630844);d=md5ii(d,a,b,c,x[i+7],10,1126891415);c=md5ii(c,d,a,b,x[i+14],15,-1416354905);b=md5ii(b,c,d,a,x[i+5],21,-57434055);a=md5ii(a,b,c,d,x[i+12],6,1700485571);d=md5ii(d,a,b,c,x[i+3],10,-1894986606);c=md5ii(c,d,a,b,x[i+10],15,-1051523);b=md5ii(b,c,d,a,x[i+1],21,-2054922799);a=md5ii(a,b,c,d,x[i+8],6,1873313359);d=md5ii(d,a,b,c,x[i+15],10,-30611744);c=md5ii(c,d,a,b,x[i+6],15,-1560198380);b=md5ii(b,c,d,a,x[i+13],21,1309151649);a=md5ii(a,b,c,d,x[i+4],6,-145523070);d=md5ii(d,a,b,c,x[i+11],10,-1120210379);c=md5ii(c,d,a,b,x[i+2],15,718787259);b=md5ii(b,c,d,a,x[i+9],21,-343485551);a=safeAdd(a,olda);b=safeAdd(b,oldb);c=safeAdd(c,oldc);d=safeAdd(d,oldd)}return[a,b,c,d]}function bytesToWords(input){if(input.length===0){return[]}var length8=input.length*8;var output=new Uint32Array(getOutputLength(length8));for(var i=0;i<length8;i+=8){output[i>>5]|=(input[i/8]&255)<<i%32}return output}function safeAdd(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}function bitRotateLeft(num,cnt){return num<<cnt|num>>>32-cnt}function md5cmn(q,a,b,x,s,t){return safeAdd(bitRotateLeft(safeAdd(safeAdd(a,q),safeAdd(x,t)),s),b)}function md5ff(a,b,c,d,x,s,t){return md5cmn(b&c|~b&d,a,b,x,s,t)}function md5gg(a,b,c,d,x,s,t){return md5cmn(b&d|c&~d,a,b,x,s,t)}function md5hh(a,b,c,d,x,s,t){return md5cmn(b^c^d,a,b,x,s,t)}function md5ii(a,b,c,d,x,s,t){return md5cmn(c^(b|~d),a,b,x,s,t)}var _default=md5;exports["default"]=_default},{}],25:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var randomUUID=typeof crypto!=="undefined"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto);var _default={randomUUID:randomUUID};exports["default"]=_default},{}],26:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _default="00000000-0000-0000-0000-000000000000";exports["default"]=_default},{}],27:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _validate=_interopRequireDefault(require("./validate.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function parse(uuid){if(!(0,_validate["default"])(uuid)){throw TypeError("Invalid UUID")}var v;var arr=new Uint8Array(16);arr[0]=(v=parseInt(uuid.slice(0,8),16))>>>24;arr[1]=v>>>16&255;arr[2]=v>>>8&255;arr[3]=v&255;arr[4]=(v=parseInt(uuid.slice(9,13),16))>>>8;arr[5]=v&255;arr[6]=(v=parseInt(uuid.slice(14,18),16))>>>8;arr[7]=v&255;arr[8]=(v=parseInt(uuid.slice(19,23),16))>>>8;arr[9]=v&255;arr[10]=(v=parseInt(uuid.slice(24,36),16))/1099511627776&255;arr[11]=v/4294967296&255;arr[12]=v>>>24&255;arr[13]=v>>>16&255;arr[14]=v>>>8&255;arr[15]=v&255;return arr}var _default=parse;exports["default"]=_default},{"./validate.js":37}],28:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _default=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;exports["default"]=_default},{}],29:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=rng;var getRandomValues;var rnds8=new Uint8Array(16);function rng(){if(!getRandomValues){getRandomValues=typeof crypto!=="undefined"&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto);if(!getRandomValues){throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported")}}return getRandomValues(rnds8)}},{}],30:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;function f(s,x,y,z){switch(s){case 0:return x&y^~x&z;case 1:return x^y^z;case 2:return x&y^x&z^y&z;case 3:return x^y^z}}function ROTL(x,n){return x<<n|x>>>32-n}function sha1(bytes){var K=[1518500249,1859775393,2400959708,3395469782];var H=[1732584193,4023233417,2562383102,271733878,3285377520];if(typeof bytes==="string"){var msg=unescape(encodeURIComponent(bytes));bytes=[];for(var i=0;i<msg.length;++i){bytes.push(msg.charCodeAt(i))}}else if(!Array.isArray(bytes)){bytes=Array.prototype.slice.call(bytes)}bytes.push(128);var l=bytes.length/4+2;var N=Math.ceil(l/16);var M=new Array(N);for(var _i=0;_i<N;++_i){var arr=new Uint32Array(16);for(var j=0;j<16;++j){arr[j]=bytes[_i*64+j*4]<<24|bytes[_i*64+j*4+1]<<16|bytes[_i*64+j*4+2]<<8|bytes[_i*64+j*4+3]}M[_i]=arr}M[N-1][14]=(bytes.length-1)*8/Math.pow(2,32);M[N-1][14]=Math.floor(M[N-1][14]);M[N-1][15]=(bytes.length-1)*8&4294967295;for(var _i2=0;_i2<N;++_i2){var W=new Uint32Array(80);for(var t=0;t<16;++t){W[t]=M[_i2][t]}for(var _t=16;_t<80;++_t){W[_t]=ROTL(W[_t-3]^W[_t-8]^W[_t-14]^W[_t-16],1)}var a=H[0];var b=H[1];var c=H[2];var d=H[3];var e=H[4];for(var _t2=0;_t2<80;++_t2){var s=Math.floor(_t2/20);var T=ROTL(a,5)+f(s,b,c,d)+e+K[s]+W[_t2]>>>0;e=d;d=c;c=ROTL(b,30)>>>0;b=a;a=T}H[0]=H[0]+a>>>0;H[1]=H[1]+b>>>0;H[2]=H[2]+c>>>0;H[3]=H[3]+d>>>0;H[4]=H[4]+e>>>0}return[H[0]>>24&255,H[0]>>16&255,H[0]>>8&255,H[0]&255,H[1]>>24&255,H[1]>>16&255,H[1]>>8&255,H[1]&255,H[2]>>24&255,H[2]>>16&255,H[2]>>8&255,H[2]&255,H[3]>>24&255,H[3]>>16&255,H[3]>>8&255,H[3]&255,H[4]>>24&255,H[4]>>16&255,H[4]>>8&255,H[4]&255]}var _default=sha1;exports["default"]=_default},{}],31:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;exports.unsafeStringify=unsafeStringify;var _validate=_interopRequireDefault(require("./validate.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var byteToHex=[];for(var i=0;i<256;++i){byteToHex.push((i+256).toString(16).slice(1))}function unsafeStringify(arr){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;return byteToHex[arr[offset+0]]+byteToHex[arr[offset+1]]+byteToHex[arr[offset+2]]+byteToHex[arr[offset+3]]+"-"+byteToHex[arr[offset+4]]+byteToHex[arr[offset+5]]+"-"+byteToHex[arr[offset+6]]+byteToHex[arr[offset+7]]+"-"+byteToHex[arr[offset+8]]+byteToHex[arr[offset+9]]+"-"+byteToHex[arr[offset+10]]+byteToHex[arr[offset+11]]+byteToHex[arr[offset+12]]+byteToHex[arr[offset+13]]+byteToHex[arr[offset+14]]+byteToHex[arr[offset+15]]}function stringify(arr){var offset=arguments.length>1&&arguments[1]!==undefined?arguments[1]:0;var uuid=unsafeStringify(arr,offset);if(!(0,_validate["default"])(uuid)){throw TypeError("Stringified UUID is invalid")}return uuid}var _default=stringify;exports["default"]=_default},{"./validate.js":37}],32:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _rng=_interopRequireDefault(require("./rng.js"));var _stringify=require("./stringify.js");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var _nodeId;var _clockseq;var _lastMSecs=0;var _lastNSecs=0;function v1(options,buf,offset){var i=buf&&offset||0;var b=buf||new Array(16);options=options||{};var node=options.node||_nodeId;var clockseq=options.clockseq!==undefined?options.clockseq:_clockseq;if(node==null||clockseq==null){var seedBytes=options.random||(options.rng||_rng["default"])();if(node==null){node=_nodeId=[seedBytes[0]|1,seedBytes[1],seedBytes[2],seedBytes[3],seedBytes[4],seedBytes[5]]}if(clockseq==null){clockseq=_clockseq=(seedBytes[6]<<8|seedBytes[7])&16383}}var msecs=options.msecs!==undefined?options.msecs:Date.now();var nsecs=options.nsecs!==undefined?options.nsecs:_lastNSecs+1;var dt=msecs-_lastMSecs+(nsecs-_lastNSecs)/1e4;if(dt<0&&options.clockseq===undefined){clockseq=clockseq+1&16383}if((dt<0||msecs>_lastMSecs)&&options.nsecs===undefined){nsecs=0}if(nsecs>=1e4){throw new Error("uuid.v1(): Can't create more than 10M uuids/sec")}_lastMSecs=msecs;_lastNSecs=nsecs;_clockseq=clockseq;msecs+=122192928e5;var tl=((msecs&268435455)*1e4+nsecs)%4294967296;b[i++]=tl>>>24&255;b[i++]=tl>>>16&255;b[i++]=tl>>>8&255;b[i++]=tl&255;var tmh=msecs/4294967296*1e4&268435455;b[i++]=tmh>>>8&255;b[i++]=tmh&255;b[i++]=tmh>>>24&15|16;b[i++]=tmh>>>16&255;b[i++]=clockseq>>>8|128;b[i++]=clockseq&255;for(var n=0;n<6;++n){b[i+n]=node[n]}return buf||(0,_stringify.unsafeStringify)(b)}var _default=v1;exports["default"]=_default},{"./rng.js":29,"./stringify.js":31}],33:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _v=_interopRequireDefault(require("./v35.js"));var _md=_interopRequireDefault(require("./md5.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var v3=(0,_v["default"])("v3",48,_md["default"]);var _default=v3;exports["default"]=_default},{"./md5.js":24,"./v35.js":34}],34:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.URL=exports.DNS=void 0;exports["default"]=v35;var _stringify=require("./stringify.js");var _parse=_interopRequireDefault(require("./parse.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function stringToBytes(str){str=unescape(encodeURIComponent(str));var bytes=[];for(var i=0;i<str.length;++i){bytes.push(str.charCodeAt(i))}return bytes}var DNS="6ba7b810-9dad-11d1-80b4-00c04fd430c8";exports.DNS=DNS;var URL="6ba7b811-9dad-11d1-80b4-00c04fd430c8";exports.URL=URL;function v35(name,version,hashfunc){function generateUUID(value,namespace,buf,offset){var _namespace;if(typeof value==="string"){value=stringToBytes(value)}if(typeof namespace==="string"){namespace=(0,_parse["default"])(namespace)}if(((_namespace=namespace)===null||_namespace===void 0?void 0:_namespace.length)!==16){throw TypeError("Namespace must be array-like (16 iterable integer values, 0-255)")}var bytes=new Uint8Array(16+value.length);bytes.set(namespace);bytes.set(value,namespace.length);bytes=hashfunc(bytes);bytes[6]=bytes[6]&15|version;bytes[8]=bytes[8]&63|128;if(buf){offset=offset||0;for(var i=0;i<16;++i){buf[offset+i]=bytes[i]}return buf}return(0,_stringify.unsafeStringify)(bytes)}try{generateUUID.name=name}catch(err){}generateUUID.DNS=DNS;generateUUID.URL=URL;return generateUUID}},{"./parse.js":27,"./stringify.js":31}],35:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _native=_interopRequireDefault(require("./native.js"));var _rng=_interopRequireDefault(require("./rng.js"));var _stringify=require("./stringify.js");function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function v4(options,buf,offset){if(_native["default"].randomUUID&&!buf&&!options){return _native["default"].randomUUID()}options=options||{};var rnds=options.random||(options.rng||_rng["default"])();rnds[6]=rnds[6]&15|64;rnds[8]=rnds[8]&63|128;if(buf){offset=offset||0;for(var i=0;i<16;++i){buf[offset+i]=rnds[i]}return buf}return(0,_stringify.unsafeStringify)(rnds)}var _default=v4;exports["default"]=_default},{"./native.js":25,"./rng.js":29,"./stringify.js":31}],36:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _v=_interopRequireDefault(require("./v35.js"));var _sha=_interopRequireDefault(require("./sha1.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}var v5=(0,_v["default"])("v5",80,_sha["default"]);var _default=v5;exports["default"]=_default},{"./sha1.js":30,"./v35.js":34}],37:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _regex=_interopRequireDefault(require("./regex.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function validate(uuid){return typeof uuid==="string"&&_regex["default"].test(uuid)}var _default=validate;exports["default"]=_default},{"./regex.js":28}],38:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports["default"]=void 0;var _validate=_interopRequireDefault(require("./validate.js"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function version(uuid){if(!(0,_validate["default"])(uuid)){throw TypeError("Invalid UUID")}return parseInt(uuid.slice(14,15),16)}var _default=version;exports["default"]=_default},{"./validate.js":37}],39:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});var collect_1=require("./collect");if(typeof window!=="undefined"){window.TokenizeJs=collect_1.TokenizeJs}},{"./collect":40}],40:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __importDefault=void 0&&(void 0).__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.TokenizeJs=void 0;var uuid_1=require("uuid");var constants=__importStar(require("./lib/constants"));var shared_1=__importDefault(require("./lib/services/shared"));var applepay_1=__importDefault(require("./lib/services/applepay"));var googlepay_1=__importDefault(require("./lib/services/googlepay"));var paze_1=__importDefault(require("./lib/services/paze"));var card_on_file_1=__importDefault(require("./lib/services/card-on-file"));var helpers=__importStar(require("./lib/helpers/common"));var TokenizeJs=function(){function TokenizeJs(businessId,applicationId,walletRequest){_classCallCheck(this,TokenizeJs);this.sharedService=new shared_1["default"](businessId,applicationId,walletRequest);this.applePayService=new applepay_1["default"](this.sharedService);this.googlePayService=new googlepay_1["default"](this.sharedService);this.pazeService=new paze_1["default"](this.sharedService);this.cardOnFileService=new card_on_file_1["default"](this.sharedService)}_createClass(TokenizeJs,[{key:"on",value:function on(eventName,callback){this.sharedService.on(eventName,callback)}},{key:"mount",value:function mount(domElement,document,mountOptions){var _a,_b,_c;var options=helpers.getAllOptions(this.sharedService.businessId,this.sharedService.applicationId,this.sharedService.sessionId,mountOptions);if(options.enableCardOnFile){this.cardOnFileService.mount(options.locale,options.forceSaveCardOnFile,options.cardAgreementOptions)}var isPaymentFormEnabled=helpers.isPaymentFormEnabled(options);var applePay=(_a=options.paymentMethods)===null||_a===void 0?void 0:_a.includes("apple_pay");var googlePay=(_b=options.paymentMethods)===null||_b===void 0?void 0:_b.includes("google_pay");var paze=(_c=options.paymentMethods)===null||_c===void 0?void 0:_c.includes("paze");if(isPaymentFormEnabled){this.sharedService.mountPaymentForm(domElement,document,options)}if(applePay||googlePay||paze){this.sharedService.mountButtonsContainer(domElement,document,options);if(applePay){this.applePayService.mount(options.buttonOptions,options.applePayButtonOptions)}if(googlePay){this.googlePayService.mount(options.buttonOptions,options.googlePayButtonOptions)}if(paze){this.pazeService.mount(options.buttonOptions,options.pazeButtonOptions)}}if(!isPaymentFormEnabled){this.sharedService.processCallbacks("ready",{type:"ready",data:{}});this.sharedService.processCallbacks("iframe_ready",{type:"iframe_ready",data:{}})}}},{key:"unmount",value:function unmount(domElement,document){this.sharedService.unmount(domElement,document);this.cardOnFileService.unmount()}},{key:"getIFrame",value:function getIFrame(){return this.sharedService.iFrame}},{key:"reload",value:function reload(){var _a,_b;(_b=(_a=this.sharedService.iFrame)===null||_a===void 0?void 0:_a.contentWindow)===null||_b===void 0?void 0:_b.location.reload()}},{key:"getNonce",value:function getNonce(){var getNonceOptions=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};if(!this.sharedService.iFrame){return this.sharedService.handleError("CARD_PAYMENT",new Error("iFrame not found"))}getNonceOptions.requestId=(0,uuid_1.v4)();this.sharedService.mixpanel.track("gdp.collect.nonce_request",{request_id:getNonceOptions.requestId});if(this.cardOnFileService.cardAgreementData){getNonceOptions.cardAgreementMetadata=this.cardOnFileService.cardAgreementData.metadata}this.sharedService.postIFrameMessage({type:"op_get_nonce",options:getNonceOptions})}},{key:"startGooglePaySession",value:function startGooglePaySession(walletRequest){this.googlePayService.startSession(walletRequest)}},{key:"startApplePaySession",value:function startApplePaySession(walletRequest){this.applePayService.startSession(walletRequest)}},{key:"startPazeSession",value:function startPazeSession(walletRequest){this.pazeService.startSession(walletRequest)}},{key:"abortApplePaySession",value:function abortApplePaySession(){this.applePayService.abortSession()}},{key:"supportWalletPayments",value:function supportWalletPayments(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var result,domainName,promises;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:result={googlePay:false,applePay:false,paze:false};domainName=document.location.hostname;if(!constants.DOMAIN_BLACKLIST.includes(domainName)){_context.next=5;break}this.sharedService.handleError("WALLET",new Error(domainName+" is blacklisted. Please reach out GDP support."));return _context.abrupt("return",result);case 5:_context.prev=5;promises=[this.applePayService.initialize(),this.googlePayService.initialize(),this.pazeService.initialize(options.emailAddress)];_context.next=9;return Promise.all(promises);case 9:result.applePay=this.applePayService.isReady();result.googlePay=this.googlePayService.isReady();result.paze=this.pazeService.isReady();_context.next=17;break;case 14:_context.prev=14;_context.t0=_context["catch"](5);this.sharedService.handleError("WALLET",_context.t0);case 17:return _context.abrupt("return",result);case 18:case"end":return _context.stop()}},_callee,this,[[5,14]])}))}}]);return TokenizeJs}();exports.TokenizeJs=TokenizeJs},{"./lib/constants":42,"./lib/helpers/common":45,"./lib/services/applepay":50,"./lib/services/card-on-file":51,"./lib/services/googlepay":52,"./lib/services/paze":54,"./lib/services/shared":55,uuid:23}],41:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.declineButton=exports.acceptButton=exports.actionButtonsContainer=exports.businessPhoneText=exports.businessWebsiteLink=exports.businessNameText=exports.mainText=exports.closeIcon=exports.closeIconContainer=exports.title=exports.agreementContainer=exports.globalContainer=void 0;exports.globalContainer={position:"fixed",top:"0",left:"0",width:"100%",height:"100%",display:"flex","justify-content":"center","align-items":"center","background-color":"rgb(186 166 192 / 50%)","z-index":"9999"};exports.agreementContainer={"max-width":"600px",width:"100%","background-color":"#ffffff","font-family":"Roboto, Open Sans, Segoe UI, sans-serif",padding:"20px 40px 40px 40px","border-radius":"10px"};exports.title={"font-size":"1.2rem","font-weight":"bold","margin-bottom":"10px"};exports.closeIconContainer={"text-align":"right"};exports.closeIcon={"font-size":"1.6rem",cursor:"pointer",color:"#8a8a8a"};exports.mainText={"font-size":"1rem"};exports.businessNameText={"font-weight":"bold"};exports.businessWebsiteLink={"text-decoration":"underline",color:"#0946ED"};exports.businessPhoneText={"font-style":"italic"};exports.actionButtonsContainer={display:"flex","justify-content":"center","align-items":"center","flex-wrap":"wrap",gap:"10px","margin-top":"20px"};exports.acceptButton={padding:"10px 50px","background-color":"#0946ED","border-radius":"15px",color:"#ffffff","max-width":"200px",width:"100%"};exports.declineButton={padding:"10px 50px","background-color":"#627792","border-radius":"15px",color:"#ffffff","max-width":"200px",width:"100%"}},{}],42:[function(require,module,exports){"use strict";var _exports$GOOGLE_PAY_E,_exports$GOOGLE_PAY_I;function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _defineProperty(obj,key,value){key=_toPropertyKey(key);if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}Object.defineProperty(exports,"__esModule",{value:true});exports.MIXPANEL_INSTANCE_NAME=exports.MIXPANEL_TOKEN=exports.COF_DEFAULT_COUNTRY_CODE=exports.COF_DEFAULT_LANGUAGE=exports.ASSETS_CDN_URL=exports.DOMAIN_BLACKLIST=exports.WALLET_SHIPPING_COUNTRY_CODES=exports.DEFAULT_TIMEOUT=exports.PAZE_ALLOWED_CARD_NETWORKS=exports.APPLEPAY_SUPPORTED_NETWORKS=exports.APPLEPAY_MERCHANT_CAPABILITIES=exports.APPLEPAY_VERSION=exports.GOOGLEPAY_ALLOWED_CARD_NETWORKS=exports.GOOGLEPAY_ALLOWED_AUTHN_METHODS=exports.GOOGLEPAY_VERSION_MINOR=exports.GOOGLEPAY_VERSION=exports.GOOGLEPAY_GATEWAY=exports.GOOGLEPAY_MERCHANT_ID=exports.GOOGLEPAY_SCRIPT_URL=exports.GOOGLE_PAY_INTENT_MAP=exports.GOOGLE_PAY_EVENT_MAP=exports.DEFAULT_LOCALE=exports.IFRAME_NAME=void 0;exports.IFRAME_NAME="poynt-collect-v2-iframe";exports.DEFAULT_LOCALE="en-US";exports.GOOGLE_PAY_EVENT_MAP=(_exports$GOOGLE_PAY_E={},_defineProperty(_exports$GOOGLE_PAY_E,"INITIALIZE","shipping_address_change"),_defineProperty(_exports$GOOGLE_PAY_E,"SHIPPING_ADDRESS","shipping_address_change"),_defineProperty(_exports$GOOGLE_PAY_E,"SHIPPING_OPTION","shipping_method_change"),_defineProperty(_exports$GOOGLE_PAY_E,"OFFER","coupon_code_change"),_exports$GOOGLE_PAY_E);exports.GOOGLE_PAY_INTENT_MAP=(_exports$GOOGLE_PAY_I={},_defineProperty(_exports$GOOGLE_PAY_I,"INITIALIZE","SHIPPING_ADDRESS"),_defineProperty(_exports$GOOGLE_PAY_I,"SHIPPING_ADDRESS","SHIPPING_ADDRESS"),_defineProperty(_exports$GOOGLE_PAY_I,"SHIPPING_OPTION","SHIPPING_OPTION"),_defineProperty(_exports$GOOGLE_PAY_I,"OFFER","OFFER"),_exports$GOOGLE_PAY_I);exports.GOOGLEPAY_SCRIPT_URL="https://pay.google.com/gp/p/js/pay.js";exports.GOOGLEPAY_MERCHANT_ID="BCR2DN4T3D32TPA6";exports.GOOGLEPAY_GATEWAY="godaddypayments";exports.GOOGLEPAY_VERSION=2;exports.GOOGLEPAY_VERSION_MINOR=0;exports.GOOGLEPAY_ALLOWED_AUTHN_METHODS=["PAN_ONLY","CRYPTOGRAM_3DS"];exports.GOOGLEPAY_ALLOWED_CARD_NETWORKS=["AMEX","DISCOVER","JCB","MASTERCARD","VISA"];exports.APPLEPAY_VERSION=6;exports.APPLEPAY_MERCHANT_CAPABILITIES=["supports3DS"];exports.APPLEPAY_SUPPORTED_NETWORKS=["visa","masterCard","amex","discover","interac"];exports.PAZE_ALLOWED_CARD_NETWORKS=["VISA","MASTERCARD"];exports.DEFAULT_TIMEOUT=15e3;exports.WALLET_SHIPPING_COUNTRY_CODES=[];exports.DOMAIN_BLACKLIST=["websites.godaddy.com"];exports.ASSETS_CDN_URL="https://d85ecz8votkqa.cloudfront.net/images/collect/";exports.COF_DEFAULT_LANGUAGE="EN";exports.COF_DEFAULT_COUNTRY_CODE="US";exports.MIXPANEL_TOKEN="b3053c0785212011971a15669b094404";exports.MIXPANEL_INSTANCE_NAME="poynt_collect"},{}],43:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buildMaskedPaymentRequest=exports.buildPaymentRequest=exports.buildWalletNonceError=exports.buildErrors=exports.buildShippingMethods=exports.buildTotal=exports.buildLineItems=void 0;var constants_1=require("../constants");var buildLineItems=function buildLineItems(request){if(!request.lineItems){return[]}return request.lineItems.map(function(_ref){var label=_ref.label,amount=_ref.amount,isPending=_ref.isPending;return{label:label,amount:amount,type:isPending?"pending":"final"}})};exports.buildLineItems=buildLineItems;var buildTotal=function buildTotal(request){if(!request.total){return{label:"",amount:"0.00"}}return{label:request.total.label,amount:request.total.amount,type:request.total.isPending?"pending":"final"}};exports.buildTotal=buildTotal;var buildShippingMethods=function buildShippingMethods(request){var _a;if(!((_a=request.shippingMethods)===null||_a===void 0?void 0:_a.length)){return}return request.shippingMethods.map(function(_ref2){var id=_ref2.id,label=_ref2.label,amount=_ref2.amount,detail=_ref2.detail;return{identifier:id,label:label,amount:amount,detail:detail}})};exports.buildShippingMethods=buildShippingMethods;var buildErrors=function buildErrors(request){var errorCodes={invalid_shipping_address:"shippingContactInvalid",unserviceable_address:"addressUnserviceable",invalid_billing_address:"billingContactInvalid",invalid_coupon_code:"couponCodeInvalid",expired_coupon_code:"couponCodeExpired",invalid_payment_data:"unknown",unknown:"unknown"};var error=request.error;if(!error){return}return[new ApplePayError(error.code?errorCodes[error.code]:"unknown",error.contactField,error.message?error.message:"")]};exports.buildErrors=buildErrors;var buildWalletNonceError=function buildWalletNonceError(error){return[new ApplePayError("unknown",undefined,(error===null||error===void 0?void 0:error.developerMessage)||(error===null||error===void 0?void 0:error.message)||"")]};exports.buildWalletNonceError=buildWalletNonceError;var buildPaymentRequest=function buildPaymentRequest(request){var _a;var requiredShippingContactFields=[];if(request.requireShippingAddress){requiredShippingContactFields.push("name");requiredShippingContactFields.push("postalAddress")}if(request.requireEmail){requiredShippingContactFields.push("email")}if(request.requirePhone){requiredShippingContactFields.push("phone")}return{countryCode:request.country,currencyCode:request.currency,merchantCapabilities:constants_1.APPLEPAY_MERCHANT_CAPABILITIES,supportedNetworks:constants_1.APPLEPAY_SUPPORTED_NETWORKS,total:(0,exports.buildTotal)(request),lineItems:(0,exports.buildLineItems)(request),requiredBillingContactFields:["name","postalAddress"],requiredShippingContactFields:requiredShippingContactFields.length?requiredShippingContactFields:undefined,supportsCouponCode:request.supportCouponCode,couponCode:request.supportCouponCode?(_a=request.couponCode)===null||_a===void 0?void 0:_a.code:undefined}};exports.buildPaymentRequest=buildPaymentRequest;var buildMaskedPaymentRequest=function buildMaskedPaymentRequest(request){try{var masked="**masked**";var requestCopy=structuredClone(request);if(requestCopy.total){requestCopy.total=masked}if(requestCopy.lineItems){requestCopy.lineItems=masked}if(requestCopy.couponCode){requestCopy.couponCode=masked}return requestCopy}catch(error){console.warn(error);return{}}};exports.buildMaskedPaymentRequest=buildMaskedPaymentRequest},{"../constants":42}],44:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});exports.getCardAgreement=void 0;var constants_1=require("../constants");var localization_1=require("./localization");var defaultStyles=__importStar(require("../assets/card-on-file/styles"));var isStaticTemplate=function isStaticTemplate(metadata){return!metadata.businessName||!metadata.businessWebsite||!metadata.businessPhone};var getCardAgreementFilePath=function getCardAgreementFilePath(isStatic,lang,countryCode){var filename=isStatic?"DEFAULT.html":"SAVE_COF.hbs";return"https://d1oxd31ykxugjs.cloudfront.net".concat("/",lang,"/").concat(countryCode,"/").concat(filename)};var createElement=function createElement(elementName,defaultStyles,customStyles){var element=document.createElement(elementName);if(defaultStyles){Object.keys(defaultStyles).forEach(function(property){element.style.setProperty(property,defaultStyles[property])})}if(customStyles){Object.keys(customStyles).forEach(function(property){element.style.setProperty(property,customStyles[property])})}return element};var compileCardAgreementTemplate=function compileCardAgreementTemplate(template,metadata,customStyles){var agreement=template.replace(new RegExp("\n","g")," ").replace(new RegExp("<.*?>","g"),"");if(!isStaticTemplate(metadata)){var businessNameElement=createElement("span",defaultStyles.businessNameText,customStyles.businessNameText);var businessWebsiteElement=createElement("a",defaultStyles.businessWebsiteLink,customStyles.businessWebsiteLink);var businessPhoneElement=createElement("span",defaultStyles.businessPhoneText,customStyles.businessPhoneText);businessNameElement.textContent=metadata.businessName||"";businessWebsiteElement.textContent=metadata.businessWebsite||"";businessPhoneElement.textContent=metadata.businessPhone||"";businessWebsiteElement.setAttribute("href",metadata.businessWebsite||"");businessWebsiteElement.setAttribute("target","_blank");businessWebsiteElement.setAttribute("rel","noopener noreferrer");return agreement.replace(new RegExp("{{business_name}}","g"),businessNameElement.outerHTML).replace(new RegExp("{{business_website}}","g"),businessWebsiteElement.outerHTML).replace(new RegExp("{{business_contact_phone}}","g"),businessPhoneElement.outerHTML)}return agreement};var genereteCardAgreementHtml=function genereteCardAgreementHtml(agreement,locale,customStyles,hideActionButtons,onAcceptClick,onDeclineClick){var globalContainer=createElement("div",defaultStyles.globalContainer,customStyles.globalContainer);var agreementContainer=createElement("div",defaultStyles.agreementContainer,customStyles.agreementContainer);var title=createElement("h1",defaultStyles.title,customStyles.title);var closeIconContainer=createElement("div",defaultStyles.closeIconContainer,customStyles.closeIconContainer);var closeIcon=createElement("span",defaultStyles.closeIcon,customStyles.closeIcon);var mainText=createElement("p",defaultStyles.mainText,customStyles.mainText);var actionButtonsContainer=createElement("div",defaultStyles.actionButtonsContainer,customStyles.actionButtonsContainer);var acceptButton=createElement("button",defaultStyles.acceptButton,customStyles.acceptButton);var declineButton=createElement("button",defaultStyles.declineButton,customStyles.declineButton);var messages=(0,localization_1.getMessages)(locale);mainText.innerHTML=agreement;closeIcon.innerHTML="&#215;";title.textContent=messages["cardOnFile.termsAndConditions"];acceptButton.textContent=messages["cardOnFile.accept"];declineButton.textContent=messages["cardOnFile.decline"];closeIconContainer.appendChild(closeIcon);actionButtonsContainer.appendChild(declineButton);actionButtonsContainer.appendChild(acceptButton);agreementContainer.appendChild(closeIconContainer);agreementContainer.appendChild(title);agreementContainer.appendChild(mainText);if(!hideActionButtons){agreementContainer.appendChild(actionButtonsContainer)}globalContainer.appendChild(agreementContainer);globalContainer.onclick=function(event){var isClickInside=agreementContainer.contains(event.target);if(!isClickInside&&document.body.contains(globalContainer)){document.body.removeChild(globalContainer)}};closeIcon.onclick=function(){if(document.body.contains(globalContainer)){document.body.removeChild(globalContainer)}};if(onAcceptClick){acceptButton.onclick=onAcceptClick}if(onDeclineClick){declineButton.onclick=onDeclineClick}return globalContainer};var requestTemplate=function requestTemplate(isStatic,lang,countryCode){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var response,template;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;_context.next=3;return fetch(getCardAgreementFilePath(isStatic,lang,countryCode));case 3:response=_context.sent;if(response.ok){_context.next=8;break}console.warn('Unable to fetch template for language "'.concat(lang,'" and countryCode "').concat(countryCode,'"'));_context.next=12;break;case 8:_context.next=10;return response.text();case 10:template=_context.sent;return _context.abrupt("return",{template:template,lang:lang,countryCode:countryCode});case 12:_context.next=17;break;case 14:_context.prev=14;_context.t0=_context["catch"](0);console.error(_context.t0);case 17:return _context.abrupt("return",null);case 18:case"end":return _context.stop()}},_callee,null,[[0,14]])}))};var findTemplate=function findTemplate(metadata){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark(function _callee2(){var isStatic,localizedTemplate,defaultTemplate;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:isStatic=isStaticTemplate(metadata);_context2.next=3;return requestTemplate(isStatic,metadata.lang,metadata.countryCode);case 3:localizedTemplate=_context2.sent;if(!localizedTemplate){_context2.next=6;break}return _context2.abrupt("return",localizedTemplate);case 6:_context2.next=8;return requestTemplate(isStatic,constants_1.COF_DEFAULT_LANGUAGE,constants_1.COF_DEFAULT_COUNTRY_CODE);case 8:defaultTemplate=_context2.sent;if(!defaultTemplate){_context2.next=11;break}return _context2.abrupt("return",defaultTemplate);case 11:return _context2.abrupt("return",null);case 12:case"end":return _context2.stop()}},_callee2)}))};var getCardAgreement=function getCardAgreement(locale,hideActionButtons,options,onAcceptClick,onDeclineClick){return __awaiter(void 0,void 0,void 0,_regeneratorRuntime().mark(function _callee3(){var metadata,templateResponse,customStyles,agreement,container;return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:metadata={lang:(locale===null||locale===void 0?void 0:locale.length)===5?locale.slice(0,2).toUpperCase():constants_1.COF_DEFAULT_LANGUAGE,countryCode:(locale===null||locale===void 0?void 0:locale.length)===5?locale.slice(-2).toUpperCase():constants_1.COF_DEFAULT_COUNTRY_CODE,businessName:options===null||options===void 0?void 0:options.businessName,businessWebsite:options===null||options===void 0?void 0:options.businessWebsite,businessPhone:options===null||options===void 0?void 0:options.businessPhone};_context3.next=3;return findTemplate(metadata);case 3:templateResponse=_context3.sent;if(!(!templateResponse||!templateResponse.template)){_context3.next=6;break}throw new Error("Card agreement template not found");case 6:metadata.lang=templateResponse.lang;metadata.countryCode=templateResponse.countryCode;customStyles=(options===null||options===void 0?void 0:options.style)||{};agreement=compileCardAgreementTemplate(templateResponse.template,metadata,customStyles);container=genereteCardAgreementHtml(agreement,locale||constants_1.DEFAULT_LOCALE,customStyles,hideActionButtons,onAcceptClick,onDeclineClick);return _context3.abrupt("return",{container:container,metadata:metadata});case 12:case"end":return _context3.stop()}},_callee3)}))};exports.getCardAgreement=getCardAgreement},{"../assets/card-on-file/styles":41,"../constants":42,"./localization":47}],45:[function(require,module,exports){"use strict";function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};Object.defineProperty(exports,"__esModule",{value:true});exports.createDefaultWalletRequest=exports.setButtonsContainerProperties=exports.setButtonProperties=exports.createIFrame=exports.getAllOptions=exports.shouldEnableCardOnFile=exports.isPaymentFormEnabled=exports.parseMessage=exports.loadScript=exports.removeCachedScripts=exports.getCachedScripts=void 0;var qs_1=require("qs");var constants=__importStar(require("../constants"));var cachedScripts={};var getCachedScripts=function getCachedScripts(){return _extends({},cachedScripts)};exports.getCachedScripts=getCachedScripts;var removeCachedScripts=function removeCachedScripts(){Object.keys(cachedScripts).forEach(function(key){return cachedScripts[key]=null})};exports.removeCachedScripts=removeCachedScripts;var loadScript=function loadScript(src){var existing=cachedScripts[src];if(existing){return existing}var promise=new Promise(function(resolve,reject){var script=document.createElement("script");script.src=src;script.async=true;var onScriptLoad=function onScriptLoad(){resolve()};var onScriptError=function onScriptError(){script.removeEventListener("load",onScriptLoad);script.removeEventListener("error",onScriptError);cachedScripts[src]=null;script.remove();reject(new Error("Unable to load script ".concat(src)))};script.addEventListener("load",onScriptLoad);script.addEventListener("error",onScriptError);document.body.appendChild(script)});cachedScripts[src]=promise;return promise};exports.loadScript=loadScript;var parseMessage=function parseMessage(event){try{return JSON.parse(event.data)}catch(error){console.error(error)}return null};exports.parseMessage=parseMessage;var isPaymentFormEnabled=function isPaymentFormEnabled(options){var _a;return!((_a=options.paymentMethods)===null||_a===void 0?void 0:_a.length)||options.paymentMethods.includes("card")};exports.isPaymentFormEnabled=isPaymentFormEnabled;var shouldEnableCardOnFile=function shouldEnableCardOnFile(options){if(!(0,exports.isPaymentFormEnabled)(options)){return false}return!!options.enableCardOnFile};exports.shouldEnableCardOnFile=shouldEnableCardOnFile;var getAllOptions=function getAllOptions(businessId,applicationId,sessionId,mountOptions){var options=mountOptions||{};options.businessId=businessId;options.applicationId=applicationId;options.sessionId=sessionId;options.enableReCaptcha=!!options.enableReCaptcha;options.enableCardOnFile=(0,exports.shouldEnableCardOnFile)(options);return options};exports.getAllOptions=getAllOptions;var createIFrame=function createIFrame(options){var iFrame=document.createElement("iframe");iFrame.setAttribute("name",constants.IFRAME_NAME);iFrame.setAttribute("id",constants.IFRAME_NAME);var iFrameUrl="https://cdn.poynt.net/collect/index.html".concat("?",(0,qs_1.stringify)(options));if(options.iFrame){iFrame.style.cssText=JSON.stringify(options.iFrame);if(options.iFrame.height){iFrame.style["height"]=options.iFrame.height}if(options.iFrame.width){iFrame.style["width"]=options.iFrame.width}if(options.iFrame.border){iFrame.style["border"]=options.iFrame.border}if(options.iFrame.borderRadius){iFrame.style["borderRadius"]=options.iFrame.borderRadius}if(options.iFrame.boxShadow){iFrame.style["boxShadow"]=options.iFrame.boxShadow}}if(!(0,exports.isPaymentFormEnabled)(options)){iFrame.setAttribute("style","display: none")}iFrame.setAttribute("src",iFrameUrl);return iFrame};exports.createIFrame=createIFrame;var setButtonProperties=function setButtonProperties(container,buttonOptions){var button=container.getElementsByTagName("button")[0];var minWidth=(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.type)==="plain"?"160px":"240px";var minHeight="40px";var margin="8px";button.style.setProperty("width","100%");button.style.setProperty("height","100%");button.style.setProperty("min-height",minHeight);button.style.setProperty("border",(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.border)||"unset");button.style.setProperty("border-radius",(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.borderRadius)||"5px");container.style.setProperty("min-width",minWidth);container.style.setProperty("min-height",minHeight);container.style.setProperty("margin",(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.margin)||margin);container.style.setProperty("width",(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.width)||minWidth);container.style.setProperty("height",(buttonOptions===null||buttonOptions===void 0?void 0:buttonOptions.height)||minHeight);return container};exports.setButtonProperties=setButtonProperties;var setButtonsContainerProperties=function setButtonsContainerProperties(container,buttonsContainerOptions){container.style.setProperty("display","flex");container.style.setProperty("justify-content",(buttonsContainerOptions===null||buttonsContainerOptions===void 0?void 0:buttonsContainerOptions.justifyContent)||"center");container.style.setProperty("align-items",(buttonsContainerOptions===null||buttonsContainerOptions===void 0?void 0:buttonsContainerOptions.alignItems)||"center");container.style.setProperty("flex-direction",(buttonsContainerOptions===null||buttonsContainerOptions===void 0?void 0:buttonsContainerOptions.flexDirection)||"row");if(buttonsContainerOptions===null||buttonsContainerOptions===void 0?void 0:buttonsContainerOptions.style){var cssRules=Object.entries(buttonsContainerOptions.style);cssRules.forEach(function(cssRule){container.style.setProperty(cssRule[0],cssRule[1])})}return container};exports.setButtonsContainerProperties=setButtonsContainerProperties;var createDefaultWalletRequest=function createDefaultWalletRequest(){return{currency:"USD",country:"US",merchantName:"",total:{label:"",amount:"0.00"}}};exports.createDefaultWalletRequest=createDefaultWalletRequest},{"../constants":42,qs:18}],46:[function(require,module,exports){"use strict";function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}Object.defineProperty(exports,"__esModule",{value:true});exports.buildMaskedPaymentRequest=exports.buildPaymentRequest=exports.buildPaymentDataChangedHandlerError=exports.buildWalletNonceError=exports.buildMissedHandlerError=exports.buildDuplicateCouponCodeError=exports.buildError=exports.buildOfferInfo=exports.buildShippingMethods=exports.buildTransactionInfo=exports.buildLineItems=exports.getCardPaymentMethod=exports.getBaseCardPaymentMethod=void 0;var constants_1=require("../constants");var getBaseCardPaymentMethod=function getBaseCardPaymentMethod(request){var result={type:"CARD",parameters:{allowedAuthMethods:constants_1.GOOGLEPAY_ALLOWED_AUTHN_METHODS,allowedCardNetworks:constants_1.GOOGLEPAY_ALLOWED_CARD_NETWORKS}};result.parameters.billingAddressRequired=true;result.parameters.billingAddressParameters={format:"FULL"};if(request.requirePhone){result.parameters.billingAddressParameters.phoneNumberRequired=true}return result};exports.getBaseCardPaymentMethod=getBaseCardPaymentMethod;var getCardPaymentMethod=function getCardPaymentMethod(request,businessId){var baseCardPaymentMethod=(0,exports.getBaseCardPaymentMethod)(request);return _extends({tokenizationSpecification:{type:"PAYMENT_GATEWAY",parameters:{gateway:constants_1.GOOGLEPAY_GATEWAY,gatewayMerchantId:businessId}}},baseCardPaymentMethod)};exports.getCardPaymentMethod=getCardPaymentMethod;var buildLineItems=function buildLineItems(request){if(!request.lineItems){return[]}return request.lineItems.map(function(lineItem){return{label:lineItem.label,price:lineItem.amount,type:"LINE_ITEM",status:lineItem.isPending?"PENDING":"FINAL"}})};exports.buildLineItems=buildLineItems;var buildTransactionInfo=function buildTransactionInfo(request){var items=(0,exports.buildLineItems)(request);if(!request.total){return{countryCode:request.country,currencyCode:request.currency||"",totalPrice:"0.00",totalPriceStatus:"ESTIMATED",displayItems:items}}return{countryCode:request.country,currencyCode:request.currency,totalPrice:request.total.amount,totalPriceLabel:request.total.label,totalPriceStatus:request.total.isPending?"ESTIMATED":"FINAL",displayItems:items}};exports.buildTransactionInfo=buildTransactionInfo;var buildShippingMethods=function buildShippingMethods(request){var _a;if(!((_a=request.shippingMethods)===null||_a===void 0?void 0:_a.length)){return}var options=request.shippingMethods.map(function(shippingMethod){return{id:shippingMethod.id,label:shippingMethod.label,description:shippingMethod.detail}});return{shippingOptions:options}};exports.buildShippingMethods=buildShippingMethods;var buildOfferInfo=function buildOfferInfo(request){var _a;if(!((_a=request.couponCode)===null||_a===void 0?void 0:_a.code)){return{offers:[]}}return{offers:[{redemptionCode:request.couponCode.code,description:request.couponCode.label}]}};exports.buildOfferInfo=buildOfferInfo;var buildError=function buildError(request,callbackIntent){var errorCodes={invalid_shipping_address:"SHIPPING_ADDRESS_INVALID",unserviceable_address:"SHIPPING_ADDRESS_UNSERVICEABLE",invalid_billing_address:"PAYMENT_DATA_INVALID",invalid_coupon_code:"OFFER_INVALID",expired_coupon_code:"OFFER_INVALID",invalid_payment_data:"PAYMENT_DATA_INVALID",unknown:"OTHER_ERROR"};var error=request.error;if(!error){return}return{reason:error.code?errorCodes[error.code]:errorCodes.unknown,intent:callbackIntent,message:error.message||""}};exports.buildError=buildError;var buildDuplicateCouponCodeError=function buildDuplicateCouponCodeError(callbackIntent){return{reason:"OFFER_INVALID",intent:callbackIntent,message:"Coupon code already applied"}};exports.buildDuplicateCouponCodeError=buildDuplicateCouponCodeError;var buildMissedHandlerError=function buildMissedHandlerError(eventType,callbackIntent){return{reason:"OTHER_ERROR",intent:callbackIntent,message:"".concat(eventType," callback handler not found")}};exports.buildMissedHandlerError=buildMissedHandlerError;var buildWalletNonceError=function buildWalletNonceError(callbackIntent,error){return{reason:"OTHER_ERROR",intent:callbackIntent,message:(error===null||error===void 0?void 0:error.developerMessage)||(error===null||error===void 0?void 0:error.message)||""}};exports.buildWalletNonceError=buildWalletNonceError;var buildPaymentDataChangedHandlerError=function buildPaymentDataChangedHandlerError(callbackTrigger){return{reason:"OTHER_ERROR",intent:constants_1.GOOGLE_PAY_INTENT_MAP[callbackTrigger],message:'Callback trigger "'.concat(callbackTrigger,'" not found or intermediate payment data does not exist')}};exports.buildPaymentDataChangedHandlerError=buildPaymentDataChangedHandlerError;var buildPaymentRequest=function buildPaymentRequest(request,businessId,authJwt){var _a,_b;var merchantInfo={merchantId:constants_1.GOOGLEPAY_MERCHANT_ID,merchantOrigin:document.location.hostname,merchantName:request.merchantName,authJwt:authJwt};var result={apiVersion:constants_1.GOOGLEPAY_VERSION,apiVersionMinor:constants_1.GOOGLEPAY_VERSION_MINOR,merchantInfo:merchantInfo,allowedPaymentMethods:[(0,exports.getCardPaymentMethod)(request,businessId)],transactionInfo:(0,exports.buildTransactionInfo)(request)};var callbackIntents=["PAYMENT_AUTHORIZATION"];if(request.requireShippingAddress){callbackIntents.push("SHIPPING_ADDRESS","SHIPPING_OPTION");result.shippingAddressRequired=true;result.shippingOptionRequired=true;result.shippingAddressParameters={allowedCountryCodes:constants_1.WALLET_SHIPPING_COUNTRY_CODES,phoneNumberRequired:request.requirePhone};if((_a=request.shippingMethods)===null||_a===void 0?void 0:_a.length){result.shippingOptionParameters=(0,exports.buildShippingMethods)(request)}}if(request.supportCouponCode){callbackIntents.push("OFFER");if((_b=request.couponCode)===null||_b===void 0?void 0:_b.code){result.offerInfo={offers:[{redemptionCode:request.couponCode.code,description:request.couponCode.label}]}}}if(request.requireEmail){result.emailRequired=true}result.callbackIntents=callbackIntents;return result};exports.buildPaymentRequest=buildPaymentRequest;var buildMaskedPaymentRequest=function buildMaskedPaymentRequest(request){try{var masked="**masked**";var requestCopy=structuredClone(request);if(requestCopy.merchantInfo){requestCopy.merchantInfo=masked}if(requestCopy.transactionInfo){requestCopy.transactionInfo=masked}if(requestCopy.shippingOptionParameters){requestCopy.shippingOptionParameters=masked}if(requestCopy.offerInfo){requestCopy.offerInfo=masked}return requestCopy}catch(error){console.warn(error);return{}}};exports.buildMaskedPaymentRequest=buildMaskedPaymentRequest},{"../constants":42}],47:[function(require,module,exports){"use strict";function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}var __importDefault=void 0&&(void 0).__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});exports.getMessages=void 0;var constants_1=require("../constants");var snippet_json_1=__importDefault(require("l10n/collect/en-us/snippet.json"));var snippet_json_2=__importDefault(require("l10n/collect/en-ca/snippet.json"));var snippet_json_3=__importDefault(require("l10n/collect/fr-ca/snippet.json"));var messages={"en-US":snippet_json_1["default"],"en-CA":snippet_json_2["default"],"fr-CA":snippet_json_3["default"]};var getMessages=function getMessages(locale){return messages[locale]?_extends(_extends({},messages[constants_1.DEFAULT_LOCALE]),messages[locale]):messages[constants_1.DEFAULT_LOCALE]};exports.getMessages=getMessages},{"../constants":42,"l10n/collect/en-ca/snippet.json":12,"l10n/collect/en-us/snippet.json":13,"l10n/collect/fr-ca/snippet.json":14}],48:[function(require,module,exports){"use strict";Object.defineProperty(exports,"__esModule",{value:true});exports.buildMaskedCompleteRequest=exports.buildMaskedCheckoutRequest=exports.buildPaymentAuthorizedResponse=exports.buildAddress=exports.buildWalletNonceRequest=exports.buildCompleteRequest=exports.buildCheckoutRequest=exports.formatAmountWithCents=exports.getOrderQuantity=exports.getPazeScriptUrl=void 0;var constants_1=require("../constants");var getPazeScriptUrl=function getPazeScriptUrl(){if(!"https://checkout.paze.com/web/resources/js/digitalwallet-sdk.js"||!"BZTSGJ5554C9KTTUNQCK21_3-pBQgEwsJ0IPORgO-zUhsv1UA"){return""}return"https://checkout.paze.com/web/resources/js/digitalwallet-sdk.js".concat("?id=","BZTSGJ5554C9KTTUNQCK21_3-pBQgEwsJ0IPORgO-zUhsv1UA")};exports.getPazeScriptUrl=getPazeScriptUrl;var getOrderQuantity=function getOrderQuantity(lineItems){if(!(lineItems===null||lineItems===void 0?void 0:lineItems.length)){return}return lineItems.length.toString()};exports.getOrderQuantity=getOrderQuantity;var formatAmountWithCents=function formatAmountWithCents(amount){if(!amount||!Number(amount)){return"0.00"}var parts=amount.split(".");if(parts.length===1){return"".concat(parts[0],".00")}if(parts.length===2&&parts[1].length===1){return"".concat(parts[0],".").concat(parts[1],"0")}return amount};exports.formatAmountWithCents=formatAmountWithCents;var buildCheckoutRequest=function buildCheckoutRequest(request,sessionId,emailAddress){return{emailAddress:emailAddress,sessionId:sessionId,actionCode:"START_FLOW",transactionValue:{transactionCurrencyCode:request.currency,transactionAmount:(0,exports.formatAmountWithCents)(request.total.amount)},enhancedTransactionData:{orderQuantity:(0,exports.getOrderQuantity)(request.lineItems)},shippingPreference:"NONE",billingPreference:"ALL",acceptedShippingCountries:constants_1.WALLET_SHIPPING_COUNTRY_CODES,acceptedPaymentCardNetworks:constants_1.PAZE_ALLOWED_CARD_NETWORKS}};exports.buildCheckoutRequest=buildCheckoutRequest;var buildCompleteRequest=function buildCompleteRequest(request,sessionId){return{sessionId:sessionId,transactionType:"PURCHASE",transactionValue:{transactionCurrencyCode:request.currency,transactionAmount:(0,exports.formatAmountWithCents)(request.total.amount)},transactionOptions:{billingPreference:"ALL",payloadTypeIndicator:"PAYMENT"},enhancedTransactionData:{orderQuantity:(0,exports.getOrderQuantity)(request.lineItems)}}};exports.buildCompleteRequest=buildCompleteRequest;var buildWalletNonceRequest=function buildWalletNonceRequest(checkout,complete,requestId){var result={pazePaymentToken:{paymentTokenJwt:complete.completeResponse}};var billingAddress=checkout.maskedCard.billingAddress;var customerInfo=checkout.consumer;if(billingAddress){result.zip=billingAddress.zip;result.line1=billingAddress.line1;result.line2=billingAddress.line2;result.city=billingAddress.city;result.territory=billingAddress.state;result.countryCode=billingAddress.countryCode}if(customerInfo){result.firstName=customerInfo.firstName;result.lastName=customerInfo.lastName}if(requestId){result.requestId=requestId}return result};exports.buildWalletNonceRequest=buildWalletNonceRequest;var buildAddress=function buildAddress(address,customerInfo){var result={administrativeArea:address.state,countryCode:address.countryCode,postalCode:address.zip,locality:address.city,addressLines:[address.line1||"",address.line2||"",address.line3||""].filter(function(address){return address})};if(customerInfo){result.emailAddress=customerInfo.emailAddress;var phoneNumber;var name=customerInfo.fullName||"".concat(customerInfo.firstName," ").concat(customerInfo.lastName).trim();if(customerInfo.mobileNumber){phoneNumber="".concat(customerInfo.mobileNumber.countryCode).concat(customerInfo.mobileNumber.phoneNumber).trim()}if("deliveryContactDetails"in address){result.name=address.deliveryContactDetails.contactFullName||name;result.phoneNumber=address.deliveryContactDetails.contactPhoneNumber||phoneNumber}else{result.name=name;result.phoneNumber=phoneNumber}}return result};exports.buildAddress=buildAddress;var buildPaymentAuthorizedResponse=function buildPaymentAuthorizedResponse(checkout,nonceResponse,requireShippingAddress){var result={nonce:nonceResponse.nonce,source:"paze"};var billingAddress=checkout.maskedCard.billingAddress;var shippingAddress=checkout.shippingAddress;var customerInfo=checkout.consumer;if(billingAddress){result.billingAddress=(0,exports.buildAddress)(billingAddress,customerInfo)}if(requireShippingAddress&&shippingAddress){result.shippingAddress=(0,exports.buildAddress)(shippingAddress,customerInfo)}return result};exports.buildPaymentAuthorizedResponse=buildPaymentAuthorizedResponse;var buildMaskedCheckoutRequest=function buildMaskedCheckoutRequest(request){try{var masked="**masked**";var requestCopy=structuredClone(request);if(requestCopy.emailAddress){requestCopy.emailAddress=masked}if(requestCopy.transactionValue){requestCopy.transactionValue=masked}return requestCopy}catch(error){console.warn(error);return{}}};exports.buildMaskedCheckoutRequest=buildMaskedCheckoutRequest;var buildMaskedCompleteRequest=function buildMaskedCompleteRequest(request){try{var masked="**masked**";var requestCopy=structuredClone(request);if(requestCopy.transactionValue){requestCopy.transactionValue=masked}return requestCopy}catch(error){console.warn(error);return{}}};exports.buildMaskedCompleteRequest=buildMaskedCompleteRequest},{"../constants":42}],49:[function(require,module,exports){"use strict";function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}var __rest=void 0&&(void 0).__rest||function(s,e){var t={};for(var p in s)if(Object.prototype.hasOwnProperty.call(s,p)&&e.indexOf(p)<0)t[p]=s[p];if(s!=null&&typeof Object.getOwnPropertySymbols==="function")for(var i=0,p=Object.getOwnPropertySymbols(s);i<p.length;i++){if(e.indexOf(p[i])<0&&Object.prototype.propertyIsEnumerable.call(s,p[i]))t[p[i]]=s[p[i]]}return t};Object.defineProperty(exports,"__esModule",{value:true});exports.buildWalletNonceRequest=exports.buildPaymentAuthorizedResponse=exports.buildAddress=exports.buildCouponCodeResponse=exports.buildShippingMethodResponse=exports.buildShippingAddressResponse=void 0;var buildShippingAddressResponse=function buildShippingAddressResponse(event){return{shippingAddress:{administrativeArea:event.administrativeArea||"",countryCode:event.countryCode||"",postalCode:event.postalCode||"",locality:event.locality||""}}};exports.buildShippingAddressResponse=buildShippingAddressResponse;var buildShippingMethodResponse=function buildShippingMethodResponse(event,shippingMethods){var result={shippingMethod:{}};if("identifier"in event){result.shippingMethod={id:event.identifier,label:event.label,detail:event.detail,amount:event.amount}}if("id"in event){var shippingMethod=(shippingMethods||[]).find(function(item){return item.id===event.id});result.shippingMethod={id:event.id,label:shippingMethod===null||shippingMethod===void 0?void 0:shippingMethod.label,detail:shippingMethod===null||shippingMethod===void 0?void 0:shippingMethod.detail,amount:shippingMethod===null||shippingMethod===void 0?void 0:shippingMethod.amount}}return result};exports.buildShippingMethodResponse=buildShippingMethodResponse;var buildCouponCodeResponse=function buildCouponCodeResponse(event){return{couponCode:Array.isArray(event)?event[0]:event}};exports.buildCouponCodeResponse=buildCouponCodeResponse;var buildAddress=function buildAddress(address,email){var result={};if("givenName"in address){var phoneticFamilyName=address.phoneticFamilyName,phoneticGivenName=address.phoneticGivenName,subLocality=address.subLocality,subAdministrativeArea=address.subAdministrativeArea,country=address.country,_address$givenName=address.givenName,givenName=_address$givenName===void 0?"":_address$givenName,_address$familyName=address.familyName,familyName=_address$familyName===void 0?"":_address$familyName,data=__rest(address,["phoneticFamilyName","phoneticGivenName","subLocality","subAdministrativeArea","country","givenName","familyName"]);result=_extends(_extends({},data),{name:"".concat(givenName," ").concat(familyName)})}if("name"in address){var sortingCode=address.sortingCode,_address$address=address.address1,address1=_address$address===void 0?"":_address$address,_address$address2=address.address2,address2=_address$address2===void 0?"":_address$address2,_address$address3=address.address3,address3=_address$address3===void 0?"":_address$address3,_data=__rest(address,["sortingCode","address1","address2","address3"]);result=_extends(_extends({},_data),{emailAddress:email,addressLines:[address1,address2,address3].filter(function(address){return address})})}return result};exports.buildAddress=buildAddress;var buildPaymentAuthorizedResponse=function buildPaymentAuthorizedResponse(event,nonceResponse,requireShippingAddress){var _a;var result={};if("token"in event){if(event.billingContact){result.billingAddress=(0,exports.buildAddress)(event.billingContact)}if(event.shippingContact){var shippingAddress=(0,exports.buildAddress)(event.shippingContact);if(requireShippingAddress){result.shippingAddress=shippingAddress}if(result.billingAddress){if(shippingAddress.emailAddress){result.billingAddress.emailAddress=shippingAddress.emailAddress}if(shippingAddress.phoneNumber){result.billingAddress.phoneNumber=shippingAddress.phoneNumber}}}result.source="apple_pay"}if("paymentMethodData"in event){if(event.shippingAddress){result.shippingAddress=(0,exports.buildAddress)(event.shippingAddress,event.email)}if((_a=event.paymentMethodData.info)===null||_a===void 0?void 0:_a.billingAddress){result.billingAddress=(0,exports.buildAddress)(event.paymentMethodData.info.billingAddress,event.email)}result.source="google_pay"}result.nonce=nonceResponse.nonce;return result};exports.buildPaymentAuthorizedResponse=buildPaymentAuthorizedResponse;var buildWalletNonceRequest=function buildWalletNonceRequest(event){var _a,_b,_c,_d,_e,_f,_g,_h,_j,_k,_l,_m,_o,_p,_q,_r,_s,_t,_u,_v,_w,_x,_y,_z;var result={};if("token"in event){result={applePayPaymentToken:event.token,zip:(_a=event.billingContact)===null||_a===void 0?void 0:_a.postalCode,line1:((_b=event.billingContact)===null||_b===void 0?void 0:_b.addressLines)&&((_c=event.billingContact)===null||_c===void 0?void 0:_c.addressLines[0]),line2:((_d=event.billingContact)===null||_d===void 0?void 0:_d.addressLines)&&((_e=event.billingContact)===null||_e===void 0?void 0:_e.addressLines[1]),city:(_f=event.billingContact)===null||_f===void 0?void 0:_f.locality,territory:(_g=event.billingContact)===null||_g===void 0?void 0:_g.administrativeArea,countryCode:(_h=event.billingContact)===null||_h===void 0?void 0:_h.countryCode,firstName:(_j=event.billingContact)===null||_j===void 0?void 0:_j.givenName,lastName:(_k=event.billingContact)===null||_k===void 0?void 0:_k.familyName}}if("paymentMethodData"in event){result={googlePayPaymentToken:event.paymentMethodData,zip:(_m=(_l=event.paymentMethodData.info)===null||_l===void 0?void 0:_l.billingAddress)===null||_m===void 0?void 0:_m.postalCode,line1:(_p=(_o=event.paymentMethodData.info)===null||_o===void 0?void 0:_o.billingAddress)===null||_p===void 0?void 0:_p.address1,line2:(_r=(_q=event.paymentMethodData.info)===null||_q===void 0?void 0:_q.billingAddress)===null||_r===void 0?void 0:_r.address2,city:(_t=(_s=event.paymentMethodData.info)===null||_s===void 0?void 0:_s.billingAddress)===null||_t===void 0?void 0:_t.locality,territory:(_v=(_u=event.paymentMethodData.info)===null||_u===void 0?void 0:_u.billingAddress)===null||_v===void 0?void 0:_v.administrativeArea,countryCode:(_x=(_w=event.paymentMethodData.info)===null||_w===void 0?void 0:_w.billingAddress)===null||_x===void 0?void 0:_x.countryCode,firstName:(_z=(_y=event.paymentMethodData.info)===null||_y===void 0?void 0:_y.billingAddress)===null||_z===void 0?void 0:_z.name}}return result};exports.buildWalletNonceRequest=buildWalletNonceRequest},{}],50:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});var constants=__importStar(require("../constants"));var walletHelpers=__importStar(require("../helpers/wallet"));var applePayHelpers=__importStar(require("../helpers/applepay"));var common_1=require("../helpers/common");var ApplePay=function(){function ApplePay(sharedService){_classCallCheck(this,ApplePay);this.sharedService=sharedService;this.initialized=false;this.applePaySession=null}_createClass(ApplePay,[{key:"initialize",value:function initialize(){var _a;return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var walletRequest,applePaySession;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!this.initialized){_context.next=2;break}return _context.abrupt("return");case 2:_context.prev=2;walletRequest=this.sharedService.getWalletRequest();if(!((_a=walletRequest.disableWallets)===null||_a===void 0?void 0:_a.applePay)){_context.next=6;break}return _context.abrupt("return");case 6:if(!(window.ApplePaySession&&ApplePaySession.supportsVersion(constants.APPLEPAY_VERSION)&&ApplePaySession.canMakePayments())){_context.next=13;break}_context.next=9;return this.sharedService.walletApi.validateApplePay({domainName:document.location.hostname,displayName:walletRequest.merchantName&&walletRequest.merchantName.substring(0,64)});case 9:applePaySession=_context.sent;if(!applePaySession){_context.next=13;break}this.initialized=true;return _context.abrupt("return");case 13:_context.next=18;break;case 15:_context.prev=15;_context.t0=_context["catch"](2);this.sharedService.handleError("APPLE_PAY",_context.t0);case 18:case"end":return _context.stop()}},_callee,this,[[2,15]])}))}},{key:"isReady",value:function isReady(){return this.initialized}},{key:"buildSession",value:function buildSession(){var paymentRequest=applePayHelpers.buildPaymentRequest(this.sharedService.getWalletRequest());this.sharedService.mixpanel.track("gdp.collect.ap.payment_request",{payment_request:applePayHelpers.buildMaskedPaymentRequest(paymentRequest)});this.applePaySession=new ApplePaySession(constants.APPLEPAY_VERSION,paymentRequest);return this.applePaySession}},{key:"startSession",value:function startSession(walletRequest){this.sharedService.updateWalletRequest(walletRequest||{},"init_wallet");this.handler()}},{key:"abortSession",value:function abortSession(){if(!this.applePaySession){return this.sharedService.handleError("APPLE_PAY",new Error("ApplePay session not found"))}try{this.applePaySession.abort();this.applePaySession=null}catch(error){this.sharedService.handleError("APPLE_PAY",error)}}},{key:"mount",value:function mount(buttonOptions,applePayButtonOptions){var _this=this;var _a;var options=_extends(_extends({},buttonOptions),applePayButtonOptions);var container=document.createElement("div");container.id="applepay-button-container";var button=document.createElement("button");var type=options.type;if(options.type==="checkout"){type="check-out"}button.setAttribute("type","button");var color=!options.color||options.color==="default"?"black":options.color;button.style.setProperty("-webkit-appearance","-apple-pay-button");button.style.setProperty("-apple-pay-button-type",type||"buy");button.style.setProperty("-apple-pay-button-style",color);button.style.setProperty("cursor","pointer");button.setAttribute("lang",options.locale||"en");button.onclick=function(){if(!(options===null||options===void 0?void 0:options.onClick)){return _this.startSession()}options.onClick({source:"apple_pay"})};container.appendChild(button);(0,common_1.setButtonProperties)(container,options);(_a=this.sharedService.buttonsContainer)===null||_a===void 0?void 0:_a.appendChild(container)}},{key:"handler",value:function handler(){var _this2=this;var domainName=document.location.hostname;if(constants.DOMAIN_BLACKLIST.includes(domainName)){return this.sharedService.handleError("WALLET",new Error(domainName+" is blacklisted. Please reach out GDP support."))}if(!window.ApplePaySession){return this.sharedService.handleError("APPLE_PAY",new Error("ApplePay session not found"))}this.sharedService.mixpanel.track("gdp.collect.ap.button_click");this.sharedService.processCallbacks("wallet_button_click",{source:"apple_pay"});var session=this.buildSession();var walletRequest=this.sharedService.getWalletRequest();session.onvalidatemerchant=function(event){_this2.sharedService.walletApi.validateApplePay({domainName:domainName,validationUrl:event.validationURL,displayName:walletRequest.merchantName&&walletRequest.merchantName.substring(0,64)}).then(function(applePaySession){session.completeMerchantValidation(applePaySession)})["catch"](function(error){_this2.sharedService.handleError("APPLE_PAY",error)})};if(walletRequest.requireShippingAddress){if(this.sharedService.listenerCallbacks["shipping_address_change"]){session.onshippingcontactselected=function(event){var updateWith=function updateWith(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate,"shipping_address_change");session.completeShippingContactSelection({newTotal:applePayHelpers.buildTotal(walletRequest),newLineItems:applePayHelpers.buildLineItems(walletRequest),newShippingMethods:applePayHelpers.buildShippingMethods(walletRequest),errors:applePayHelpers.buildErrors(walletRequest)})};_this2.sharedService.processCallbacks("shipping_address_change",_extends(_extends({},walletHelpers.buildShippingAddressResponse(event.shippingContact)),{updateWith:updateWith}))}}if(this.sharedService.listenerCallbacks["shipping_method_change"]){session.onshippingmethodselected=function(event){var updateWith=function updateWith(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate,"shipping_method_change");session.completeShippingMethodSelection({newTotal:applePayHelpers.buildTotal(walletRequest),newLineItems:applePayHelpers.buildLineItems(walletRequest)})};_this2.sharedService.processCallbacks("shipping_method_change",_extends(_extends({},walletHelpers.buildShippingMethodResponse(event.shippingMethod,walletRequest.shippingMethods)),{updateWith:updateWith}))}}}if(this.sharedService.listenerCallbacks["payment_method_change"]){session.onpaymentmethodselected=function(event){var updateWith=function updateWith(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate,"payment_method_change");session.completePaymentMethodSelection({newTotal:applePayHelpers.buildTotal(walletRequest),newLineItems:applePayHelpers.buildLineItems(walletRequest)})};_this2.sharedService.processCallbacks("payment_method_change",_extends(_extends({},event),{updateWith:updateWith}))}}if(this.sharedService.listenerCallbacks["payment_authorized"]){session.onpaymentauthorized=function(event){_this2.sharedService.mixpanel.track("gdp.collect.ap.payment_authorized");var complete=function complete(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate||{},"payment_authorized");var errors=applePayHelpers.buildErrors(walletRequest);var status=errors?ApplePaySession.STATUS_FAILURE:ApplePaySession.STATUS_SUCCESS;_this2.sharedService.mixpanel.track("gdp.collect.ap.payment_completed",{status:errors?"FAILURE":"SUCCESS",error:errors===null||errors===void 0?void 0:errors[0],raw_error:walletRequest.error});session.completePayment({status:status,errors:errors})};_this2.sharedService.walletApi.getWalletNonce(walletHelpers.buildWalletNonceRequest(event.payment)).then(function(nonceResponse){_this2.sharedService.processCallbacks("payment_authorized",_extends(_extends({},walletHelpers.buildPaymentAuthorizedResponse(event.payment,nonceResponse,walletRequest.requireShippingAddress)),{complete:complete}))})["catch"](function(error){_this2.sharedService.handleError("APPLE_PAY_NONCE",error);session.completePayment({status:ApplePaySession.STATUS_FAILURE,errors:applePayHelpers.buildWalletNonceError(error)})})}}if(this.sharedService.listenerCallbacks["close_wallet"]){session.oncancel=function(event){_this2.sharedService.processCallbacks("close_wallet",event)}}if(walletRequest.supportCouponCode&&this.sharedService.listenerCallbacks["coupon_code_change"]){session.oncouponcodechanged=function(event){var updateWith=function updateWith(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate,"coupon_code_change");session.completeCouponCodeChange({newTotal:applePayHelpers.buildTotal(walletRequest),newLineItems:applePayHelpers.buildLineItems(walletRequest),newShippingMethods:applePayHelpers.buildShippingMethods(walletRequest),errors:applePayHelpers.buildErrors(walletRequest)})};_this2.sharedService.processCallbacks("coupon_code_change",_extends(_extends({},walletHelpers.buildCouponCodeResponse(event.couponCode)),{updateWith:updateWith}))}}session.begin()}}]);return ApplePay}();exports["default"]=ApplePay},{"../constants":42,"../helpers/applepay":43,"../helpers/common":45,"../helpers/wallet":49}],51:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});var card_on_file_1=require("../helpers/card-on-file");var CardOnFile=function(){function CardOnFile(sharedService){_classCallCheck(this,CardOnFile);this.sharedService=sharedService;this.cardAgreementData=null}_createClass(CardOnFile,[{key:"mount",value:function mount(locale,hideActionButtons,options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var _this=this;var actionHandler,agreement;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:_context.prev=0;actionHandler=function actionHandler(value){return function(){var _a;_this.sharedService.postIFrameMessage({type:"card_on_file_set_flag",options:{value:value}});var container=(_a=_this.cardAgreementData)===null||_a===void 0?void 0:_a.container;if(container&&document.body.contains(container)){document.body.removeChild(container)}}};_context.next=4;return(0,card_on_file_1.getCardAgreement)(locale,hideActionButtons,options,actionHandler(true),actionHandler(false));case 4:agreement=_context.sent;this.cardAgreementData=agreement;this.sharedService.on("card_on_file_show_agreement",function(){var _a;if((_a=_this.cardAgreementData)===null||_a===void 0?void 0:_a.container){document.body.appendChild(_this.cardAgreementData.container)}});_context.next=12;break;case 9:_context.prev=9;_context.t0=_context["catch"](0);this.sharedService.handleError("CARD_ON_FILE",_context.t0);case 12:;case 13:case"end":return _context.stop()}},_callee,this,[[0,9]])}))}},{key:"unmount",value:function unmount(){if(this.cardAgreementData){if(document.body.contains(this.cardAgreementData.container)){document.body.removeChild(this.cardAgreementData.container)}this.sharedService.off("card_on_file_show_agreement");this.cardAgreementData=null}}}]);return CardOnFile}();exports["default"]=CardOnFile},{"../helpers/card-on-file":44}],52:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});var constants=__importStar(require("../constants"));var walletHelpers=__importStar(require("../helpers/wallet"));var googlePayHelpers=__importStar(require("../helpers/googlepay"));var common_1=require("../helpers/common");var GooglePay=function(){function GooglePay(sharedService){var _this=this;_classCallCheck(this,GooglePay);this.sharedService=sharedService;this.updateWithWrapper=function(callbackTrigger,resolve){var callbackIntent=constants.GOOGLE_PAY_INTENT_MAP[callbackTrigger];var eventType=constants.GOOGLE_PAY_EVENT_MAP[callbackTrigger];return function(walletRequestUpdate){_this.sharedService.updateWalletRequest(walletRequestUpdate,eventType);var walletRequest=_this.sharedService.getWalletRequest();var update={};var transactionInfo=googlePayHelpers.buildTransactionInfo(walletRequest);var error=googlePayHelpers.buildError(walletRequest,callbackIntent);if(transactionInfo){update.newTransactionInfo=transactionInfo}if(error){update.error=error}if(walletRequest.requireShippingAddress&&callbackTrigger!=="SHIPPING_OPTION"){update.newShippingOptionParameters=googlePayHelpers.buildShippingMethods(walletRequest)}if(callbackTrigger==="OFFER"){update.newOfferInfo=googlePayHelpers.buildOfferInfo(walletRequest)}resolve(update)}};this.completeWrapper=function(resolve){return function(walletRequestUpdate){_this.sharedService.updateWalletRequest(walletRequestUpdate||{},"payment_authorized");var walletRequest=_this.sharedService.getWalletRequest();var error=googlePayHelpers.buildError(walletRequest,"PAYMENT_AUTHORIZATION");_this.sharedService.mixpanel.track("gdp.collect.gp.payment_completed",{status:error?"FAILURE":"SUCCESS",error:error,raw_error:walletRequest.error});resolve({transactionState:error?"ERROR":"SUCCESS",error:error})}};this.googlePayPaymentDataChangedHandler=function(intermediatePaymentData){return new Promise(function(resolve){var _a;var callbackTrigger=intermediatePaymentData.callbackTrigger;var callbackIntent=constants.GOOGLE_PAY_INTENT_MAP[callbackTrigger];var eventType=constants.GOOGLE_PAY_EVENT_MAP[callbackTrigger];var updateWith=_this.updateWithWrapper(callbackTrigger,resolve);var walletRequest=_this.sharedService.getWalletRequest();if(callbackTrigger==="INITIALIZE"&&!walletRequest.requireShippingAddress){return resolve({})}if(!_this.sharedService.listenerCallbacks[eventType]){return resolve({error:googlePayHelpers.buildMissedHandlerError(eventType,callbackIntent)})}if(callbackIntent==="SHIPPING_OPTION"&&intermediatePaymentData.shippingOptionData){return _this.sharedService.processCallbacks("shipping_method_change",_extends(_extends({},walletHelpers.buildShippingMethodResponse(intermediatePaymentData.shippingOptionData,walletRequest.shippingMethods)),{updateWith:updateWith}))}if(callbackIntent==="SHIPPING_ADDRESS"&&intermediatePaymentData.shippingAddress){return _this.sharedService.processCallbacks("shipping_address_change",_extends(_extends({},walletHelpers.buildShippingAddressResponse(intermediatePaymentData.shippingAddress)),{updateWith:updateWith}))}if(callbackIntent==="OFFER"&&((_a=intermediatePaymentData.offerData)===null||_a===void 0?void 0:_a.redemptionCodes)){if(intermediatePaymentData.offerData.redemptionCodes.length>1){return resolve({newOfferInfo:googlePayHelpers.buildOfferInfo(walletRequest),error:googlePayHelpers.buildDuplicateCouponCodeError(callbackIntent)})}return _this.sharedService.processCallbacks("coupon_code_change",_extends(_extends({},walletHelpers.buildCouponCodeResponse(intermediatePaymentData.offerData.redemptionCodes)),{updateWith:updateWith}))}var error=googlePayHelpers.buildPaymentDataChangedHandlerError(callbackTrigger);_this.sharedService.handleError("GOOGLE_PAY",error);resolve({error:error})})};this.googlePayPaymentAuthorizedHandler=function(paymentData){_this.sharedService.mixpanel.track("gdp.collect.gp.payment_authorized");return new Promise(function(resolve){var complete=_this.completeWrapper(resolve);if(!_this.sharedService.listenerCallbacks["payment_authorized"]){return resolve({transactionState:"ERROR",error:googlePayHelpers.buildMissedHandlerError("payment_authorized","PAYMENT_AUTHORIZATION")})}_this.sharedService.walletApi.getWalletNonce(walletHelpers.buildWalletNonceRequest(paymentData)).then(function(nonceResponse){_this.sharedService.processCallbacks("payment_authorized",_extends(_extends({},walletHelpers.buildPaymentAuthorizedResponse(paymentData,nonceResponse)),{complete:complete}))})["catch"](function(error){_this.sharedService.handleError("GOOGLE_PAY_NONCE",error);resolve({transactionState:"ERROR",error:googlePayHelpers.buildWalletNonceError("PAYMENT_AUTHORIZATION",error)})})})};this.initialized=false;this.paymentsClient=null;this.googlePayValidationPayload=null}_createClass(GooglePay,[{key:"initialize",value:function initialize(){var _a,_b,_c;return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var walletRequest,googlePayValidationPayload,paymentsClient,isReadyToPay;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!this.initialized){_context.next=2;break}return _context.abrupt("return");case 2:_context.prev=2;walletRequest=this.sharedService.getWalletRequest();if(!((_a=walletRequest.disableWallets)===null||_a===void 0?void 0:_a.googlePay)){_context.next=6;break}return _context.abrupt("return");case 6:_context.next=8;return(0,common_1.loadScript)(constants.GOOGLEPAY_SCRIPT_URL);case 8:if(!((_c=(_b=window.google)===null||_b===void 0?void 0:_b.payments)===null||_c===void 0?void 0:_c.api)){_context.next=22;break}_context.next=11;return this.sharedService.walletApi.validateGooglePay({domain:document.location.hostname});case 11:googlePayValidationPayload=_context.sent;if(!(googlePayValidationPayload.authJwt&&googlePayValidationPayload.googleEnvironment)){_context.next=22;break}paymentsClient=this.buildPaymentsClient(walletRequest,googlePayValidationPayload.googleEnvironment);_context.next=16;return paymentsClient.isReadyToPay({apiVersion:constants.GOOGLEPAY_VERSION,apiVersionMinor:constants.GOOGLEPAY_VERSION_MINOR,allowedPaymentMethods:[googlePayHelpers.getBaseCardPaymentMethod(walletRequest)],existingPaymentMethodRequired:false});case 16:isReadyToPay=_context.sent;if(!isReadyToPay.result){_context.next=22;break}this.initialized=true;this.paymentsClient=paymentsClient;this.googlePayValidationPayload=googlePayValidationPayload;return _context.abrupt("return");case 22:_context.next=27;break;case 24:_context.prev=24;_context.t0=_context["catch"](2);this.sharedService.handleError("GOOGLE_PAY",_context.t0);case 27:case"end":return _context.stop()}},_callee,this,[[2,24]])}))}},{key:"isReady",value:function isReady(){return this.initialized}},{key:"buildPaymentsClient",value:function buildPaymentsClient(walletRequest,googleEnvironment){var paymentDataCallbacks={onPaymentAuthorized:this.googlePayPaymentAuthorizedHandler};if(walletRequest.requireShippingAddress||walletRequest.supportCouponCode){paymentDataCallbacks.onPaymentDataChanged=this.googlePayPaymentDataChangedHandler}var paymentsClient=new window.google.payments.api.PaymentsClient({environment:googleEnvironment,merchantInfo:{merchantName:walletRequest.merchantName,merchantId:constants.GOOGLEPAY_MERCHANT_ID},paymentDataCallbacks:paymentDataCallbacks});return paymentsClient}},{key:"startSession",value:function startSession(walletRequest){this.sharedService.updateWalletRequest(walletRequest||{},"init_wallet");this.handler()}},{key:"mount",value:function mount(buttonOptions,googlePayButtonOptions){var _this2=this;var _a;var options=_extends(_extends({},buttonOptions),googlePayButtonOptions);try{if(this.paymentsClient){var container=this.paymentsClient.createButton({buttonColor:options===null||options===void 0?void 0:options.color,buttonType:options===null||options===void 0?void 0:options.type,buttonSizeMode:"fill",buttonLocale:options===null||options===void 0?void 0:options.locale,allowedPaymentMethods:[googlePayHelpers.getBaseCardPaymentMethod(this.sharedService.getWalletRequest())],onClick:function onClick(){if(!(options===null||options===void 0?void 0:options.onClick)){return _this2.startSession()}options.onClick({source:"google_pay"})}});container.id="googlepay-button-container";(0,common_1.setButtonProperties)(container,options);(_a=this.sharedService.buttonsContainer)===null||_a===void 0?void 0:_a.appendChild(container)}}catch(error){this.sharedService.handleError("GOOGLE_PAY",error)}}},{key:"handler",value:function handler(){var _a;return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee2(){var domainName,paymentRequest;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:domainName=document.location.hostname;if(!constants.DOMAIN_BLACKLIST.includes(domainName)){_context2.next=3;break}return _context2.abrupt("return",this.sharedService.handleError("WALLET",new Error(domainName+" is blacklisted. Please reach out GDP support.")));case 3:if(this.paymentsClient){_context2.next=5;break}return _context2.abrupt("return",this.sharedService.handleError("GOOGLE_PAY",new Error("GooglePay payments client not found")));case 5:if((_a=this.googlePayValidationPayload)===null||_a===void 0?void 0:_a.authJwt){_context2.next=7;break}return _context2.abrupt("return",this.sharedService.handleError("GOOGLE_PAY",new Error("GooglePay auth JWT token not found")));case 7:this.sharedService.mixpanel.track("gdp.collect.gp.button_click");this.sharedService.processCallbacks("wallet_button_click",{source:"google_pay"});paymentRequest=googlePayHelpers.buildPaymentRequest(this.sharedService.getWalletRequest(),this.sharedService.businessId,this.googlePayValidationPayload.authJwt);this.sharedService.mixpanel.track("gdp.collect.gp.payment_request",{payment_request:googlePayHelpers.buildMaskedPaymentRequest(paymentRequest)});_context2.prev=11;_context2.next=14;return this.paymentsClient.loadPaymentData(paymentRequest);case 14:_context2.next=19;break;case 16:_context2.prev=16;_context2.t0=_context2["catch"](11);this.sharedService.processCallbacks("close_wallet",{reason:_context2.t0});case 19:case"end":return _context2.stop()}},_callee2,this,[[11,16]])}))}}]);return GooglePay}();exports["default"]=GooglePay},{"../constants":42,"../helpers/common":45,"../helpers/googlepay":46,"../helpers/wallet":49}],53:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=void 0&&(void 0).__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});var mixpanel_browser_1=__importDefault(require("mixpanel-browser"));var constants=__importStar(require("../constants"));var Mixpanel=function(){function Mixpanel(businessId,applicationId,sessionId){_classCallCheck(this,Mixpanel);this.businessId=businessId;this.applicationId=applicationId;this.sessionId=sessionId}_createClass(Mixpanel,[{key:"init",value:function init(){try{mixpanel_browser_1["default"].init(constants.MIXPANEL_TOKEN,{cross_subdomain_cookie:false,debug:"production"!=="production"},constants.MIXPANEL_INSTANCE_NAME)}catch(error){}}},{key:"track",value:function track(eventType,data){var _a;if("production"==="development"){return}try{(_a=mixpanel_browser_1["default"][constants.MIXPANEL_INSTANCE_NAME])===null||_a===void 0?void 0:_a.track(eventType,_extends({distinct_id:this.businessId,business_id:this.businessId,application_id:this.applicationId,session_id:this.sessionId,environment:"production"},data))}catch(error){}}}]);return Mixpanel}();exports["default"]=Mixpanel},{"../constants":42,"mixpanel-browser":15}],54:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};var __importDefault=void 0&&(void 0).__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});var uuid_1=require("uuid");var jwt_decode_1=__importDefault(require("jwt-decode"));var constants=__importStar(require("../constants"));var common_1=require("../helpers/common");var paze_1=require("../helpers/paze");var Paze=function(){function Paze(sharedService){_classCallCheck(this,Paze);this.sharedService=sharedService;this.initialized=false}_createClass(Paze,[{key:"initialize",value:function initialize(emailAddress){var _a;return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var walletRequest,options,canCheckout;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!this.initialized){_context.next=2;break}return _context.abrupt("return");case 2:_context.prev=2;walletRequest=this.sharedService.getWalletRequest();if(!((_a=walletRequest.disableWallets)===null||_a===void 0?void 0:_a.paze)){_context.next=6;break}return _context.abrupt("return");case 6:_context.next=8;return(0,common_1.loadScript)((0,paze_1.getPazeScriptUrl)());case 8:if(window.DIGITAL_WALLET_SDK){_context.next=10;break}throw new Error("Paze Wallet API is not available");case 10:options={client:{id:"BZTSGJ5554C9KTTUNQCK21_3-pBQgEwsJ0IPORgO-zUhsv1UA"||"",name:walletRequest.merchantName,profileId:"GoDaddyMerchantA"||undefined}};_context.next=13;return window.DIGITAL_WALLET_SDK.initialize(options);case 13:if(emailAddress){_context.next=16;break}this.initialized=true;return _context.abrupt("return");case 16:_context.next=18;return window.DIGITAL_WALLET_SDK.canCheckout({emailAddress:emailAddress});case 18:canCheckout=_context.sent;if(!canCheckout.consumerPresent){_context.next=23;break}this.emailAddress=emailAddress;this.initialized=true;return _context.abrupt("return");case 23:_context.next=28;break;case 25:_context.prev=25;_context.t0=_context["catch"](2);this.sharedService.handleError("PAZE",_context.t0);case 28:case"end":return _context.stop()}},_callee,this,[[2,25]])}))}},{key:"isReady",value:function isReady(){return this.initialized}},{key:"startSession",value:function startSession(walletRequest){this.sharedService.updateWalletRequest(walletRequest||{},"init_wallet");this.handler()}},{key:"mount",value:function mount(buttonOptions,pazeButtonOptions){var _this=this;var _a;var options=_extends(_extends({},buttonOptions),pazeButtonOptions);var container=document.createElement("div");container.id="pazewallet-button-container";var button=document.createElement("button");if(options.color==="white"){button.style.setProperty("background-color","#FFFFFF");button.style.setProperty("background-image","url(".concat(constants.ASSETS_CDN_URL,"paze-logo-blue.svg)"))}else{button.style.setProperty("background-image","url(".concat(constants.ASSETS_CDN_URL,"paze-logo-white.svg)"));button.style.setProperty("background-color",options.color==="black"?"#151B33":"#0F42F8")}button.style.setProperty("background-position","center");button.style.setProperty("background-repeat","no-repeat");button.onclick=function(){if(!options.onClick){return _this.startSession()}options.onClick({source:"paze"})};container.appendChild(button);(0,common_1.setButtonProperties)(container,options);(_a=this.sharedService.buttonsContainer)===null||_a===void 0?void 0:_a.appendChild(container)}},{key:"handleError",value:function handleError(type,originalError){var parsedError=this.sharedService.parseError(type,originalError);this.sharedService.trackError(parsedError);this.sharedService.processCallbacks("close_wallet",{source:"paze",error:parsedError})}},{key:"handler",value:function handler(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee2(){var _this2=this;var domainName,pazeSessionId,walletRequest,checkoutRequest,checkoutResult,decodedCheckoutResult,completeRequest,completeResult,nonceResponse,complete;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:this.sharedService.mixpanel.track("gdp.collect.paze.button_click");this.sharedService.processCallbacks("wallet_button_click",{source:"paze"});domainName=document.location.hostname;if(!constants.DOMAIN_BLACKLIST.includes(domainName)){_context2.next=5;break}return _context2.abrupt("return",this.handleError("WALLET",new Error(domainName+" is blacklisted. Please reach out GDP support.")));case 5:if(this.initialized){_context2.next=7;break}return _context2.abrupt("return",this.handleError("PAZE",new Error("Paze Wallet is not initialized")));case 7:_context2.prev=7;pazeSessionId=(0,uuid_1.v4)();walletRequest=this.sharedService.getWalletRequest();checkoutRequest=(0,paze_1.buildCheckoutRequest)(walletRequest,pazeSessionId,this.emailAddress);this.sharedService.mixpanel.track("gdp.collect.paze.checkout_request",{payment_request:(0,paze_1.buildMaskedCheckoutRequest)(checkoutRequest)});_context2.next=14;return window.DIGITAL_WALLET_SDK.checkout(checkoutRequest);case 14:checkoutResult=_context2.sent;if(!(checkoutResult.result!=="COMPLETE"||!checkoutResult.checkoutResponse)){_context2.next=17;break}return _context2.abrupt("return",this.sharedService.processCallbacks("close_wallet",{source:"paze"}));case 17:decodedCheckoutResult=(0,jwt_decode_1["default"])(checkoutResult.checkoutResponse);completeRequest=(0,paze_1.buildCompleteRequest)(walletRequest,pazeSessionId);this.sharedService.mixpanel.track("gdp.collect.paze.complete_request",{payment_request:(0,paze_1.buildMaskedCompleteRequest)(completeRequest)});_context2.next=22;return window.DIGITAL_WALLET_SDK.complete(completeRequest);case 22:completeResult=_context2.sent;_context2.prev=23;_context2.next=26;return this.sharedService.walletApi.getWalletNonce((0,paze_1.buildWalletNonceRequest)(decodedCheckoutResult,completeResult,pazeSessionId));case 26:nonceResponse=_context2.sent;this.sharedService.mixpanel.track("gdp.collect.paze.payment_authorized");complete=function complete(walletRequestUpdate){_this2.sharedService.updateWalletRequest(walletRequestUpdate||{},"payment_authorized");var error=_this2.sharedService.getWalletRequest().error;_this2.sharedService.mixpanel.track("gdp.collect.paze.payment_completed",{status:error?"FAILURE":"SUCCESS",error:error,raw_error:error})};this.sharedService.processCallbacks("payment_authorized",_extends(_extends({},(0,paze_1.buildPaymentAuthorizedResponse)(decodedCheckoutResult,nonceResponse)),{complete:complete}));_context2.next=35;break;case 32:_context2.prev=32;_context2.t0=_context2["catch"](23);return _context2.abrupt("return",this.handleError("PAZE_NONCE",_context2.t0));case 35:_context2.next=40;break;case 37:_context2.prev=37;_context2.t1=_context2["catch"](7);return _context2.abrupt("return",this.handleError("PAZE",_context2.t1));case 40:case"end":return _context2.stop()}},_callee2,this,[[7,37],[23,32]])}))}}]);return Paze}();exports["default"]=Paze},{"../constants":42,"../helpers/common":45,"../helpers/paze":48,"jwt-decode":11,uuid:23}],55:[function(require,module,exports){"use strict";function _extends(){_extends=Object.assign?Object.assign.bind():function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source){if(Object.prototype.hasOwnProperty.call(source,key)){target[key]=source[key]}}}return target};return _extends.apply(this,arguments)}function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __createBinding=void 0&&(void 0).__createBinding||(Object.create?function(o,m,k,k2){if(k2===undefined)k2=k;var desc=Object.getOwnPropertyDescriptor(m,k);if(!desc||("get"in desc?!m.__esModule:desc.writable||desc.configurable)){desc={enumerable:true,get:function get(){return m[k]}}}Object.defineProperty(o,k2,desc)}:function(o,m,k,k2){if(k2===undefined)k2=k;o[k2]=m[k]});var __setModuleDefault=void 0&&(void 0).__setModuleDefault||(Object.create?function(o,v){Object.defineProperty(o,"default",{enumerable:true,value:v})}:function(o,v){o["default"]=v});var __importStar=void 0&&(void 0).__importStar||function(mod){if(mod&&mod.__esModule)return mod;var result={};if(mod!=null)for(var k in mod)if(k!=="default"&&Object.prototype.hasOwnProperty.call(mod,k))__createBinding(result,mod,k);__setModuleDefault(result,mod);return result};var __importDefault=void 0&&(void 0).__importDefault||function(mod){return mod&&mod.__esModule?mod:{default:mod}};Object.defineProperty(exports,"__esModule",{value:true});var uuid_1=require("uuid");var mixpanel_1=__importDefault(require("../services/mixpanel"));var wallet_api_1=__importDefault(require("../services/wallet-api"));var helpers=__importStar(require("../helpers/common"));var Shared=function(){function Shared(businessId,applicationId){var _this=this;var walletRequest=arguments.length>2&&arguments[2]!==undefined?arguments[2]:helpers.createDefaultWalletRequest();_classCallCheck(this,Shared);this.createMessageChannel=function(){_this.messageChannel=new MessageChannel;_this.messageChannel.port1.onmessage=function(event){var message=helpers.parseMessage(event);if(!message){return}_this.processCallbacks(message.type,message)};_this.postIFrameMessage({type:"init"},_this.messageChannel.port2)};this.businessId=businessId;this.applicationId=applicationId;this.sessionId=(0,uuid_1.v4)();this.listenerCallbacks={};this.iFrame=null;this.messageChannel=null;this.buttonsContainer=null;this.walletRequest=walletRequest;this.mixpanel=new mixpanel_1["default"](this.businessId,this.applicationId,this.sessionId);this.walletApi=new wallet_api_1["default"](this.businessId,this.applicationId,this.sessionId);this.mixpanel.init()}_createClass(Shared,[{key:"on",value:function on(eventName,callback){this.listenerCallbacks[eventName]=callback}},{key:"off",value:function off(eventName){this.listenerCallbacks[eventName]=null}},{key:"parseError",value:function parseError(type,originalError){var error=originalError instanceof Error?{message:originalError.message,name:originalError.name,type:type}:_typeof(originalError)==="object"&&originalError.statusMessage?{message:originalError.statusMessage,name:originalError.statusCode,type:type}:typeof originalError==="string"?{message:originalError,type:type}:_extends(_extends({},originalError),{type:type});return error}},{key:"trackError",value:function trackError(error){console.error(error);this.mixpanel.track("gdp.collect.error",{error:error})}},{key:"handleError",value:function handleError(type,originalError){var error=this.parseError(type,originalError);this.trackError(error)}},{key:"postIFrameMessage",value:function postIFrameMessage(data,port){var _a,_b;var stringifiedData=JSON.stringify(data);(_b=(_a=this.iFrame)===null||_a===void 0?void 0:_a.contentWindow)===null||_b===void 0?void 0:_b.postMessage(stringifiedData,"*",port?[port]:undefined)}},{key:"getWalletRequest",value:function getWalletRequest(){return this.walletRequest}},{key:"updateWalletRequest",value:function updateWalletRequest(update,event){var _a;var request=this.walletRequest;request.error=update.error;if(event==="payment_authorized"){return}if(update.total){request.total=update.total}if(update.lineItems){request.lineItems=update.lineItems}if(event!=="shipping_method_change"&&((_a=update.shippingMethods)===null||_a===void 0?void 0:_a.length)){request.shippingMethods=update.shippingMethods}if((event==="init_wallet"||event==="coupon_code_change")&&update.couponCode){request.couponCode=update.couponCode}}},{key:"processCallbacks",value:function processCallbacks(eventType,data){var _a,_b;if(eventType==="nonce"){this.mixpanel.track("gdp.collect.nonce_response")}(_b=(_a=this.listenerCallbacks)[eventType])===null||_b===void 0?void 0:_b.call(_a,data)}},{key:"mountPaymentForm",value:function mountPaymentForm(domElement,document,options){var _this2=this;var container=document.getElementById(domElement);this.iFrame=helpers.createIFrame(options);this.iFrame.onload=function(){_this2.createMessageChannel()};container===null||container===void 0?void 0:container.appendChild(this.iFrame)}},{key:"mountButtonsContainer",value:function mountButtonsContainer(domElement,document,options){var _a;var container=document.getElementById(domElement);var buttonsContainer=document.createElement("div");buttonsContainer.setAttribute("id","wallet-buttons-container");buttonsContainer.setAttribute("class",((_a=options.buttonsContainerOptions)===null||_a===void 0?void 0:_a.className)||"");helpers.setButtonsContainerProperties(buttonsContainer,options.buttonsContainerOptions);container===null||container===void 0?void 0:container.appendChild(buttonsContainer);this.buttonsContainer=buttonsContainer}},{key:"unmount",value:function unmount(domElement,document){if(this.messageChannel){this.messageChannel.port1.close();this.messageChannel.port2.close();this.messageChannel=null}if(document&&domElement){var form=document.getElementById(domElement);if(this.iFrame){if(form===null||form===void 0?void 0:form.contains(this.iFrame)){form.removeChild(this.iFrame)}this.iFrame=null}if(this.buttonsContainer){if(form===null||form===void 0?void 0:form.contains(this.buttonsContainer)){form.removeChild(this.buttonsContainer)}this.buttonsContainer=null}}this.walletApi.unmount()}}]);return Shared}();exports["default"]=Shared},{"../helpers/common":45,"../services/mixpanel":53,"../services/wallet-api":56,uuid:23}],56:[function(require,module,exports){"use strict";function _typeof(o){"@babel/helpers - typeof";return _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(o){return typeof o}:function(o){return o&&"function"==typeof Symbol&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o},_typeof(o)}function _regeneratorRuntime(){"use strict";_regeneratorRuntime=function _regeneratorRuntime(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},i="function"==typeof Symbol?Symbol:{},a=i.iterator||"@@iterator",c=i.asyncIterator||"@@asyncIterator",u=i.toStringTag||"@@toStringTag";function define(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{define({},"")}catch(t){define=function define(t,e,r){return t[e]=r}}function wrap(t,e,r,n){var i=e&&e.prototype instanceof Generator?e:Generator,a=Object.create(i.prototype),c=new Context(n||[]);return o(a,"_invoke",{value:makeInvokeMethod(t,r,c)}),a}function tryCatch(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=wrap;var h="suspendedStart",l="suspendedYield",f="executing",s="completed",y={};function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}var p={};define(p,a,function(){return this});var d=Object.getPrototypeOf,v=d&&d(d(values([])));v&&v!==r&&n.call(v,a)&&(p=v);var g=GeneratorFunctionPrototype.prototype=Generator.prototype=Object.create(p);function defineIteratorMethods(t){["next","throw","return"].forEach(function(e){define(t,e,function(t){return this._invoke(e,t)})})}function AsyncIterator(t,e){function invoke(r,o,i,a){var c=tryCatch(t[r],t,o);if("throw"!==c.type){var u=c.arg,h=u.value;return h&&"object"==_typeof(h)&&n.call(h,"__await")?e.resolve(h.__await).then(function(t){invoke("next",t,i,a)},function(t){invoke("throw",t,i,a)}):e.resolve(h).then(function(t){u.value=t,i(u)},function(t){return invoke("throw",t,i,a)})}a(c.arg)}var r;o(this,"_invoke",{value:function value(t,n){function callInvokeWithMethodAndArg(){return new e(function(e,r){invoke(t,n,e,r)})}return r=r?r.then(callInvokeWithMethodAndArg,callInvokeWithMethodAndArg):callInvokeWithMethodAndArg()}})}function makeInvokeMethod(e,r,n){var o=h;return function(i,a){if(o===f)throw new Error("Generator is already running");if(o===s){if("throw"===i)throw a;return{value:t,done:!0}}for(n.method=i,n.arg=a;;){var c=n.delegate;if(c){var u=maybeInvokeDelegate(c,n);if(u){if(u===y)continue;return u}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===h)throw o=s,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=f;var p=tryCatch(e,r,n);if("normal"===p.type){if(o=n.done?s:l,p.arg===y)continue;return{value:p.arg,done:n.done}}"throw"===p.type&&(o=s,n.method="throw",n.arg=p.arg)}}}function maybeInvokeDelegate(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator["return"]&&(r.method="return",r.arg=t,maybeInvokeDelegate(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var i=tryCatch(o,e.iterator,r.arg);if("throw"===i.type)return r.method="throw",r.arg=i.arg,r.delegate=null,y;var a=i.arg;return a?a.done?(r[e.resultName]=a.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):a:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function pushTryEntry(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function resetTryEntry(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function Context(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(pushTryEntry,this),this.reset(!0)}function values(e){if(e||""===e){var r=e[a];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,i=function next(){for(;++o<e.length;)if(n.call(e,o))return next.value=e[o],next.done=!1,next;return next.value=t,next.done=!0,next};return i.next=i}}throw new TypeError(_typeof(e)+" is not iterable")}return GeneratorFunction.prototype=GeneratorFunctionPrototype,o(g,"constructor",{value:GeneratorFunctionPrototype,configurable:!0}),o(GeneratorFunctionPrototype,"constructor",{value:GeneratorFunction,configurable:!0}),GeneratorFunction.displayName=define(GeneratorFunctionPrototype,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===GeneratorFunction||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,GeneratorFunctionPrototype):(t.__proto__=GeneratorFunctionPrototype,define(t,u,"GeneratorFunction")),t.prototype=Object.create(g),t},e.awrap=function(t){return{__await:t}},defineIteratorMethods(AsyncIterator.prototype),define(AsyncIterator.prototype,c,function(){return this}),e.AsyncIterator=AsyncIterator,e.async=function(t,r,n,o,i){void 0===i&&(i=Promise);var a=new AsyncIterator(wrap(t,r,n,o),i);return e.isGeneratorFunction(r)?a:a.next().then(function(t){return t.done?t.value:a.next()})},defineIteratorMethods(g),define(g,u,"Generator"),define(g,a,function(){return this}),define(g,"toString",function(){return"[object Generator]"}),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function next(){for(;r.length;){var t=r.pop();if(t in e)return next.value=t,next.done=!1,next}return next.done=!0,next}},e.values=values,Context.prototype={constructor:Context,reset:function reset(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(resetTryEntry),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function stop(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function dispatchException(e){if(this.done)throw e;var r=this;function handle(n,o){return a.type="throw",a.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var o=this.tryEntries.length-1;o>=0;--o){var i=this.tryEntries[o],a=i.completion;if("root"===i.tryLoc)return handle("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0);if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return handle(i.catchLoc,!0)}else{if(!u)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return handle(i.finallyLoc)}}}},abrupt:function abrupt(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var i=o;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=e&&e<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=t,a.arg=e,i?(this.method="next",this.next=i.finallyLoc,y):this.complete(a)},complete:function complete(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function finish(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),resetTryEntry(r),y}},catch:function _catch(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;resetTryEntry(r)}return o}}throw new Error("illegal catch attempt")},delegateYield:function delegateYield(e,r,n){return this.delegate={iterator:values(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function")}}function _defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,_toPropertyKey(descriptor.key),descriptor)}}function _createClass(Constructor,protoProps,staticProps){if(protoProps)_defineProperties(Constructor.prototype,protoProps);if(staticProps)_defineProperties(Constructor,staticProps);Object.defineProperty(Constructor,"prototype",{writable:false});return Constructor}function _toPropertyKey(arg){var key=_toPrimitive(arg,"string");return _typeof(key)==="symbol"?key:String(key)}function _toPrimitive(input,hint){if(_typeof(input)!=="object"||input===null)return input;var prim=input[Symbol.toPrimitive];if(prim!==undefined){var res=prim.call(input,hint||"default");if(_typeof(res)!=="object")return res;throw new TypeError("@@toPrimitive must return a primitive value.")}return(hint==="string"?String:Number)(input)}var __awaiter=void 0&&(void 0).__awaiter||function(thisArg,_arguments,P,generator){function adopt(value){return value instanceof P?value:new P(function(resolve){resolve(value)})}return new(P||(P=Promise))(function(resolve,reject){function fulfilled(value){try{step(generator.next(value))}catch(e){reject(e)}}function rejected(value){try{step(generator["throw"](value))}catch(e){reject(e)}}function step(result){result.done?resolve(result.value):adopt(result.value).then(fulfilled,rejected)}step((generator=generator.apply(thisArg,_arguments||[])).next())})};Object.defineProperty(exports,"__esModule",{value:true});var constants_1=require("../constants");var common_1=require("../helpers/common");var WalletApi=function(){function WalletApi(businessId,applicationId,sessionId){_classCallCheck(this,WalletApi);this.loaded=false;this.loadingPromise=null;this.businessId=businessId;this.applicationId=applicationId;this.sessionId=sessionId;this.iFrame=null;this.messageChannel=null;this.originMessageChannel=null;this.iFrameMessageChannel=null}_createClass(WalletApi,[{key:"isMounted",value:function isMounted(){return!!(this.loaded&&this.iFrame&&document.body.contains(this.iFrame))}},{key:"mount",value:function mount(){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee(){var _this=this;var promise;return _regeneratorRuntime().wrap(function _callee$(_context){while(1)switch(_context.prev=_context.next){case 0:if(!this.loadingPromise){_context.next=2;break}return _context.abrupt("return",this.loadingPromise);case 2:promise=new Promise(function(resolve,reject){var allOptions=(0,common_1.getAllOptions)(_this.businessId,_this.applicationId,_this.sessionId,{paymentMethods:["apple_pay","google_pay","paze"]});_this.iFrame=(0,common_1.createIFrame)(allOptions);_this.messageChannel=new MessageChannel;_this.originMessageChannel=_this.messageChannel.port1;_this.iFrameMessageChannel=_this.messageChannel.port2;_this.originMessageChannel.start();_this.iFrameMessageChannel.start();var onComplete=function onComplete(){var _a;_this.loadingPromise=null;clearTimeout(timeout);(_a=_this.originMessageChannel)===null||_a===void 0?void 0:_a.removeEventListener("message",eventListener)};var timeout=setTimeout(function(){onComplete();_this.unmount();reject(new Error("Timeout mounting wallet API iFrame"))},constants_1.DEFAULT_TIMEOUT);var eventListener=function eventListener(event){var message=(0,common_1.parseMessage)(event);if((message===null||message===void 0?void 0:message.type)==="iframe_ready"){onComplete();_this.loaded=true;resolve()}};_this.originMessageChannel.addEventListener("message",eventListener);_this.iFrame.onload=function(){var _a,_b;if(!_this.iFrameMessageChannel){return}(_b=(_a=_this.iFrame)===null||_a===void 0?void 0:_a.contentWindow)===null||_b===void 0?void 0:_b.postMessage(JSON.stringify({type:"init"}),"*",[_this.iFrameMessageChannel])};document.body.appendChild(_this.iFrame)});return _context.abrupt("return",this.loadingPromise=promise);case 4:case"end":return _context.stop()}},_callee,this)}))}},{key:"postMessage",value:function postMessage(requestEvent,reponseSuccessEvent,responseFailEvent,options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee2(){var _this2=this;return _regeneratorRuntime().wrap(function _callee2$(_context2){while(1)switch(_context2.prev=_context2.next){case 0:return _context2.abrupt("return",new Promise(function(resolve,reject){var _a,_b,_c;var onComplete=function onComplete(){var _a;clearTimeout(timeout);(_a=_this2.originMessageChannel)===null||_a===void 0?void 0:_a.removeEventListener("message",eventListener)};var timeout=setTimeout(function(){onComplete();reject(new Error("Timeout posting message ".concat(requestEvent)))},constants_1.DEFAULT_TIMEOUT);var eventListener=function eventListener(event){var message=(0,common_1.parseMessage)(event);if((message===null||message===void 0?void 0:message.type)===reponseSuccessEvent){onComplete();return resolve(message.data)}if((message===null||message===void 0?void 0:message.type)===responseFailEvent){onComplete();return reject(message.data)}};(_a=_this2.originMessageChannel)===null||_a===void 0?void 0:_a.addEventListener("message",eventListener);(_c=(_b=_this2.iFrame)===null||_b===void 0?void 0:_b.contentWindow)===null||_c===void 0?void 0:_c.postMessage(JSON.stringify({type:requestEvent,options:options}),"*")}));case 1:case"end":return _context2.stop()}},_callee2)}))}},{key:"unmount",value:function unmount(){var _a,_b;if(this.messageChannel){(_a=this.originMessageChannel)===null||_a===void 0?void 0:_a.close();(_b=this.iFrameMessageChannel)===null||_b===void 0?void 0:_b.close();this.originMessageChannel=null;this.iFrameMessageChannel=null;this.messageChannel=null}if(this.iFrame&&document.body.contains(this.iFrame)){document.body.removeChild(this.iFrame)}this.iFrame=null;this.loaded=false}},{key:"mountAndPostMessage",value:function mountAndPostMessage(requestEvent,reponseSuccessEvent,responseFailEvent,options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee3(){return _regeneratorRuntime().wrap(function _callee3$(_context3){while(1)switch(_context3.prev=_context3.next){case 0:if(this.isMounted()){_context3.next=3;break}_context3.next=3;return this.mount();case 3:return _context3.abrupt("return",this.postMessage(requestEvent,reponseSuccessEvent,responseFailEvent,options));case 4:case"end":return _context3.stop()}},_callee3,this)}))}},{key:"validateApplePay",value:function validateApplePay(options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee4(){return _regeneratorRuntime().wrap(function _callee4$(_context4){while(1)switch(_context4.prev=_context4.next){case 0:return _context4.abrupt("return",this.mountAndPostMessage("op_validate_applepay","validate_applepay","validate_applepay_error",options));case 1:case"end":return _context4.stop()}},_callee4,this)}))}},{key:"validateGooglePay",value:function validateGooglePay(options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee5(){return _regeneratorRuntime().wrap(function _callee5$(_context5){while(1)switch(_context5.prev=_context5.next){case 0:return _context5.abrupt("return",this.mountAndPostMessage("op_validate_googlepay","validate_googlepay","validate_googlepay_error",options));case 1:case"end":return _context5.stop()}},_callee5,this)}))}},{key:"getWalletNonce",value:function getWalletNonce(options){return __awaiter(this,void 0,void 0,_regeneratorRuntime().mark(function _callee6(){return _regeneratorRuntime().wrap(function _callee6$(_context6){while(1)switch(_context6.prev=_context6.next){case 0:return _context6.abrupt("return",this.mountAndPostMessage("op_get_wallet_nonce","wallet_nonce","wallet_nonce_error",options));case 1:case"end":return _context6.stop()}},_callee6,this)}))}}]);return WalletApi}();exports["default"]=WalletApi},{"../constants":42,"../helpers/common":45}]},{},[39]);
